map 'https://fhir.dk.swisstph-mis.ch/matchbox/fhir/StructureMap/emcare.b10-14.symptoms.2m.p' = 'emcare.b10-14.symptoms.2m.p'
uses 'http://hl7.org/fhir/uv/sdc/StructureDefinition/sdc-questionnaireresponse' alias 'questionnaireResponse' as source
uses 'http://hl7.org/fhir/StructureDefinition/Bundle' alias 'Bundle' as target
uses 'https://fhir.dk.swisstph-mis.ch/matchbox/fhir/StructureDefinition/observation' alias 'Observation' as target
uses 'https://fhir.dk.swisstph-mis.ch/matchbox/fhir/StructureDefinition/emcareobservation' alias 'EmCare Observation' as produced
group bundletrans(source src : questionnaireResponse,target bundle : Bundle){
    src -> bundle.id = uuid() 'id';
    src -> bundle.type = 'batch' 'type';
    src where src.item.where(linkId='EmCare.B10S1.DE05').exists() then {
        src -> bundle.entry as entry, entry.request as request, request.method = 'POST', entry.resource = create('Observation') as tgt then emcareobservationemcareb10s1de05(src,tgt) 'act-EmCare.B10S1.DE05';
    } 'emcareobservation';
    src where src.item.where(linkId='EmCare.B10S1.DE06').exists() then {
        src -> bundle.entry as entry, entry.request as request, request.method = 'POST', entry.resource = create('Observation') as tgt then emcareobservationemcareb10s1de06(src,tgt) 'act-EmCare.B10S1.DE06';
    } 'emcareobservation';
    src where src.item.where(linkId='EmCare.B10S1.DE01').exists() then {
        src -> bundle.entry as entry, entry.request as request, request.method = 'POST', entry.resource = create('Observation') as tgt then emcareobservationemcareb10s1de01(src,tgt) 'act-EmCare.B10S1.DE01';
    } 'emcareobservation';
    src where src.item.where(linkId='EmCare.B10S1.DE02').exists() then {
        src -> bundle.entry as entry, entry.request as request, request.method = 'POST', entry.resource = create('Observation') as tgt then emcareobservationemcareb10s1de02(src,tgt) 'act-EmCare.B10S1.DE02';
    } 'emcareobservation';
    src where src.item.where(linkId='EmCare.B11S1.DE01').exists() then {
        src -> bundle.entry as entry, entry.request as request, request.method = 'POST', entry.resource = create('Observation') as tgt then emcareobservationemcareb11s1de01(src,tgt) 'act-EmCare.B11S1.DE01';
    } 'emcareobservation';
    src where src.item.where(linkId='EmCare.B11S1.DE02').exists() then {
        src -> bundle.entry as entry, entry.request as request, request.method = 'POST', entry.resource = create('Observation') as tgt then emcareobservationemcareb11s1de02(src,tgt) 'act-EmCare.B11S1.DE02';
    } 'emcareobservation';
    src where src.item.where(linkId='EmCare.B12S1.DE02').exists() then {
        src -> bundle.entry as entry, entry.request as request, request.method = 'POST', entry.resource = create('Observation') as tgt then emcareobservationemcareb12s1de02(src,tgt) 'act-EmCare.B12S1.DE02';
    } 'emcareobservation';
    src where src.item.where(linkId='EmCare.B12S1.DE03').exists() then {
        src -> bundle.entry as entry, entry.request as request, request.method = 'POST', entry.resource = create('Observation') as tgt then emcareobservationemcareb12s1de03(src,tgt) 'act-EmCare.B12S1.DE03';
    } 'emcareobservation';
    src where src.item.where(linkId='EmCare.B13S1.DE03').exists() then {
        src -> bundle.entry as entry, entry.request as request, request.method = 'POST', entry.resource = create('Observation') as tgt then emcareobservationemcareb13s1de03(src,tgt) 'act-EmCare.B13S1.DE03';
    } 'emcareobservation';
    src where src.item.where(linkId='EmCare.B13S1.DE04').exists() then {
        src -> bundle.entry as entry, entry.request as request, request.method = 'POST', entry.resource = create('Observation') as tgt then emcareobservationemcareb13s1de04(src,tgt) 'act-EmCare.B13S1.DE04';
    } 'emcareobservation';
}

group emcareobservationemcareb10s1de05(source src,target tgt){
        src -> tgt.identifier = create('Identifier') as CodeID,
            CodeID.system = 'http://hl7.org/fhir/namingsystem-identifier-type',
            CodeID.use =  'official',
            CodeID.value = 'uuid',
            CodeID.id = uuid()
         'id-emcareb10s1de05';
        src -> tgt.encounter = src.encounter,
            tgt.subject = src.subject,
            tgt.meta = create('Meta') as newMeta, newMeta.profile = 'https://fhir.dk.swisstph-mis.ch/matchbox/fhir/StructureDefinition/emcareobservation',
            tgt.code = create('CodeableConcept') as concept,
                concept.system = 'https://fhir.dk.swisstph-mis.ch/matchbox/fhir/CodeSystem/emcare-custom-codes',
                concept.code = 'EmCare.B10S1.DE05'
         'code-emcareb10s1de05';
    src.item as item where linkId  = 'timestamp', item.answer as a -> tgt.issued = a 'timestamp-emcareb10s1de05';
    src ->   tgt.subject = src.subject  'patient';
    src.item first as item  where linkId =  'EmCare.B10S1.DE05' then {
        item.answer first as a then {
            a  where a.value = 'yes' -> tgt.status = 'final'  'final-emcareb10s1de05';
             a  where a.value = 'no' -> tgt.status = 'cancelled'  'notfound-emcareb10s1de05';
        } 'an-emcareb10s1de05';
    } 'it-emcareb10s1de05';
}

group emcareobservationemcareb10s1de06(source src,target tgt){
        src -> tgt.identifier = create('Identifier') as CodeID,
            CodeID.system = 'http://hl7.org/fhir/namingsystem-identifier-type',
            CodeID.use =  'official',
            CodeID.value = 'uuid',
            CodeID.id = uuid()
         'id-emcareb10s1de06';
        src -> tgt.encounter = src.encounter,
            tgt.subject = src.subject,
            tgt.meta = create('Meta') as newMeta, newMeta.profile = 'https://fhir.dk.swisstph-mis.ch/matchbox/fhir/StructureDefinition/emcareobservation',
            tgt.code = create('CodeableConcept') as concept,
                concept.system = 'https://fhir.dk.swisstph-mis.ch/matchbox/fhir/CodeSystem/emcare-custom-codes',
                concept.code = 'EmCare.B10S1.DE06'
         'code-emcareb10s1de06';
    src.item as item where linkId  = 'timestamp', item.answer as a -> tgt.issued = a 'timestamp-emcareb10s1de06';
    src ->   tgt.subject = src.subject  'patient';
    src.item first as item  where linkId =  'EmCare.B10S1.DE06' then {
        item.answer first as a then {
            a   -> tgt.value = a, tgt.status = 'final' 'val-emcareb10s1de06';
        } 'an-emcareb10s1de06';
    } 'it-emcareb10s1de06';
}

group emcareobservationemcareb10s1de01(source src,target tgt){
        src -> tgt.identifier = create('Identifier') as CodeID,
            CodeID.system = 'http://hl7.org/fhir/namingsystem-identifier-type',
            CodeID.use =  'official',
            CodeID.value = 'uuid',
            CodeID.id = uuid()
         'id-emcareb10s1de01';
        src -> tgt.encounter = src.encounter,
            tgt.subject = src.subject,
            tgt.meta = create('Meta') as newMeta, newMeta.profile = 'https://fhir.dk.swisstph-mis.ch/matchbox/fhir/StructureDefinition/emcareobservation',
            tgt.code = create('CodeableConcept') as concept,
                concept.system = 'https://fhir.dk.swisstph-mis.ch/matchbox/fhir/CodeSystem/emcare-custom-codes',
                concept.code = 'EmCare.B10S1.DE01'
         'code-emcareb10s1de01';
    src.item as item where linkId  = 'timestamp', item.answer as a -> tgt.issued = a 'timestamp-emcareb10s1de01';
    src ->   tgt.subject = src.subject  'patient';
    src.item first as item  where linkId =  'EmCare.B10S1.DE01' then {
        item.answer first as a then {
            a  where a.value = 'yes' -> tgt.status = 'final'  'final-emcareb10s1de01';
             a  where a.value = 'no' -> tgt.status = 'cancelled'  'notfound-emcareb10s1de01';
        } 'an-emcareb10s1de01';
    } 'it-emcareb10s1de01';
}

group emcareobservationemcareb10s1de02(source src,target tgt){
        src -> tgt.identifier = create('Identifier') as CodeID,
            CodeID.system = 'http://hl7.org/fhir/namingsystem-identifier-type',
            CodeID.use =  'official',
            CodeID.value = 'uuid',
            CodeID.id = uuid()
         'id-emcareb10s1de02';
        src -> tgt.encounter = src.encounter,
            tgt.subject = src.subject,
            tgt.meta = create('Meta') as newMeta, newMeta.profile = 'https://fhir.dk.swisstph-mis.ch/matchbox/fhir/StructureDefinition/emcareobservation',
            tgt.code = create('CodeableConcept') as concept,
                concept.system = 'https://fhir.dk.swisstph-mis.ch/matchbox/fhir/CodeSystem/emcare-custom-codes',
                concept.code = 'EmCare.B10S1.DE02'
         'code-emcareb10s1de02';
    src.item as item where linkId  = 'timestamp', item.answer as a -> tgt.issued = a 'timestamp-emcareb10s1de02';
    src ->   tgt.subject = src.subject  'patient';
    src.item first as item  where linkId =  'EmCare.B10S1.DE02' then {
        item.answer first as a then {
            a   -> tgt.value = a, tgt.status = 'final' 'val-emcareb10s1de02';
        } 'an-emcareb10s1de02';
    } 'it-emcareb10s1de02';
}

group emcareobservationemcareb11s1de01(source src,target tgt){
        src -> tgt.identifier = create('Identifier') as CodeID,
            CodeID.system = 'http://hl7.org/fhir/namingsystem-identifier-type',
            CodeID.use =  'official',
            CodeID.value = 'uuid',
            CodeID.id = uuid()
         'id-emcareb11s1de01';
        src -> tgt.encounter = src.encounter,
            tgt.subject = src.subject,
            tgt.meta = create('Meta') as newMeta, newMeta.profile = 'https://fhir.dk.swisstph-mis.ch/matchbox/fhir/StructureDefinition/emcareobservation',
            tgt.code = create('CodeableConcept') as concept,
                concept.system = 'https://fhir.dk.swisstph-mis.ch/matchbox/fhir/CodeSystem/emcare-custom-codes',
                concept.code = 'EmCare.B11S1.DE01'
         'code-emcareb11s1de01';
    src.item as item where linkId  = 'timestamp', item.answer as a -> tgt.issued = a 'timestamp-emcareb11s1de01';
    src ->   tgt.subject = src.subject  'patient';
    src.item first as item  where linkId =  'EmCare.B11S1.DE01' then {
        item.answer first as a then {
            a  where a.value = 'yes' -> tgt.status = 'final'  'final-emcareb11s1de01';
             a  where a.value = 'no' -> tgt.status = 'cancelled'  'notfound-emcareb11s1de01';
        } 'an-emcareb11s1de01';
    } 'it-emcareb11s1de01';
}

group emcareobservationemcareb11s1de02(source src,target tgt){
        src -> tgt.identifier = create('Identifier') as CodeID,
            CodeID.system = 'http://hl7.org/fhir/namingsystem-identifier-type',
            CodeID.use =  'official',
            CodeID.value = 'uuid',
            CodeID.id = uuid()
         'id-emcareb11s1de02';
        src -> tgt.encounter = src.encounter,
            tgt.subject = src.subject,
            tgt.meta = create('Meta') as newMeta, newMeta.profile = 'https://fhir.dk.swisstph-mis.ch/matchbox/fhir/StructureDefinition/emcareobservation',
            tgt.code = create('CodeableConcept') as concept,
                concept.system = 'https://fhir.dk.swisstph-mis.ch/matchbox/fhir/CodeSystem/emcare-custom-codes',
                concept.code = 'EmCare.B11S1.DE02'
         'code-emcareb11s1de02';
    src.item as item where linkId  = 'timestamp', item.answer as a -> tgt.issued = a 'timestamp-emcareb11s1de02';
    src ->   tgt.subject = src.subject  'patient';
    src.item first as item  where linkId =  'EmCare.B11S1.DE02' then {
        item.answer first as a then {
            a   -> tgt.value = a, tgt.status = 'final' 'val-emcareb11s1de02';
        } 'an-emcareb11s1de02';
    } 'it-emcareb11s1de02';
}

group emcareobservationemcareb12s1de02(source src,target tgt){
        src -> tgt.identifier = create('Identifier') as CodeID,
            CodeID.system = 'http://hl7.org/fhir/namingsystem-identifier-type',
            CodeID.use =  'official',
            CodeID.value = 'uuid',
            CodeID.id = uuid()
         'id-emcareb12s1de02';
        src -> tgt.encounter = src.encounter,
            tgt.subject = src.subject,
            tgt.meta = create('Meta') as newMeta, newMeta.profile = 'https://fhir.dk.swisstph-mis.ch/matchbox/fhir/StructureDefinition/emcareobservation',
            tgt.code = create('CodeableConcept') as concept,
                concept.system = 'https://fhir.dk.swisstph-mis.ch/matchbox/fhir/CodeSystem/emcare-custom-codes',
                concept.code = 'EmCare.B12S1.DE02'
         'code-emcareb12s1de02';
    src.item as item where linkId  = 'timestamp', item.answer as a -> tgt.issued = a 'timestamp-emcareb12s1de02';
    src ->   tgt.subject = src.subject  'patient';
    src.item first as item  where linkId =  'EmCare.B12S1.DE02' then {
        item.answer first as a then {
            a  where a.value = 'yes' -> tgt.status = 'final'  'final-emcareb12s1de02';
             a  where a.value = 'no' -> tgt.status = 'cancelled'  'notfound-emcareb12s1de02';
        } 'an-emcareb12s1de02';
    } 'it-emcareb12s1de02';
}

group emcareobservationemcareb12s1de03(source src,target tgt){
        src -> tgt.identifier = create('Identifier') as CodeID,
            CodeID.system = 'http://hl7.org/fhir/namingsystem-identifier-type',
            CodeID.use =  'official',
            CodeID.value = 'uuid',
            CodeID.id = uuid()
         'id-emcareb12s1de03';
        src -> tgt.encounter = src.encounter,
            tgt.subject = src.subject,
            tgt.meta = create('Meta') as newMeta, newMeta.profile = 'https://fhir.dk.swisstph-mis.ch/matchbox/fhir/StructureDefinition/emcareobservation',
            tgt.code = create('CodeableConcept') as concept,
                concept.system = 'https://fhir.dk.swisstph-mis.ch/matchbox/fhir/CodeSystem/emcare-custom-codes',
                concept.code = 'EmCare.B12S1.DE03'
         'code-emcareb12s1de03';
    src.item as item where linkId  = 'timestamp', item.answer as a -> tgt.issued = a 'timestamp-emcareb12s1de03';
    src ->   tgt.subject = src.subject  'patient';
    src.item first as item  where linkId =  'EmCare.B12S1.DE03' then {
        item.answer first as a then {
            a   -> tgt.value = a, tgt.status = 'final' 'val-emcareb12s1de03';
        } 'an-emcareb12s1de03';
    } 'it-emcareb12s1de03';
}

group emcareobservationemcareb13s1de03(source src,target tgt){
        src -> tgt.identifier = create('Identifier') as CodeID,
            CodeID.system = 'http://hl7.org/fhir/namingsystem-identifier-type',
            CodeID.use =  'official',
            CodeID.value = 'uuid',
            CodeID.id = uuid()
         'id-emcareb13s1de03';
        src -> tgt.encounter = src.encounter,
            tgt.subject = src.subject,
            tgt.meta = create('Meta') as newMeta, newMeta.profile = 'https://fhir.dk.swisstph-mis.ch/matchbox/fhir/StructureDefinition/emcareobservation',
            tgt.code = create('CodeableConcept') as concept,
                concept.system = 'https://fhir.dk.swisstph-mis.ch/matchbox/fhir/CodeSystem/emcare-custom-codes',
                concept.code = 'EmCare.B13S1.DE03'
         'code-emcareb13s1de03';
    src.item as item where linkId  = 'timestamp', item.answer as a -> tgt.issued = a 'timestamp-emcareb13s1de03';
    src ->   tgt.subject = src.subject  'patient';
    src.item first as item  where linkId =  'EmCare.B13S1.DE03' then {
        item.answer first as a then {
            a  where a.value = 'yes' -> tgt.status = 'final'  'final-emcareb13s1de03';
             a  where a.value = 'no' -> tgt.status = 'cancelled'  'notfound-emcareb13s1de03';
        } 'an-emcareb13s1de03';
    } 'it-emcareb13s1de03';
}

group emcareobservationemcareb13s1de04(source src,target tgt){
        src -> tgt.identifier = create('Identifier') as CodeID,
            CodeID.system = 'http://hl7.org/fhir/namingsystem-identifier-type',
            CodeID.use =  'official',
            CodeID.value = 'uuid',
            CodeID.id = uuid()
         'id-emcareb13s1de04';
        src -> tgt.encounter = src.encounter,
            tgt.subject = src.subject,
            tgt.meta = create('Meta') as newMeta, newMeta.profile = 'https://fhir.dk.swisstph-mis.ch/matchbox/fhir/StructureDefinition/emcareobservation',
            tgt.code = create('CodeableConcept') as concept,
                concept.system = 'https://fhir.dk.swisstph-mis.ch/matchbox/fhir/CodeSystem/emcare-custom-codes',
                concept.code = 'EmCare.B13S1.DE04'
         'code-emcareb13s1de04';
    src.item as item where linkId  = 'timestamp', item.answer as a -> tgt.issued = a 'timestamp-emcareb13s1de04';
    src ->   tgt.subject = src.subject  'patient';
    src.item first as item  where linkId =  'EmCare.B13S1.DE04' then {
        item.answer first as a then {
            a   -> tgt.value = a, tgt.status = 'final' 'val-emcareb13s1de04';
        } 'an-emcareb13s1de04';
    } 'it-emcareb13s1de04';
}

