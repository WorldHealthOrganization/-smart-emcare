{
    "resourceType": "Library",
    "id": "emcarezscore",
    "url": "https://fhir.dk.swisstph-mis.ch/matchbox/fhir//Library/emcarezscore",
    "identifier": [
        {
            "use": "official",
            "value": "EmCareZScore"
        }
    ],
    "version": "1.0.73+build.216",
    "name": "emcarezscore",
    "title": "EmCare.Z.Score",
    "status": "active",
    "type": {
        "coding": [
            {
                "system": "http://hl7.org/fhir/ValueSet/library-type",
                "code": "logic-library"
            }
        ]
    },
    "relatedArtifact": [
        {
            "type": "depends-on",
            "resource": "http://fhir.org/guides/who/anc-cds/Library/FHIRHelpers"
        },
        {
            "type": "depends-on",
            "resource": "https://fhir.dk.swisstph-mis.ch/matchbox/fhir/Library/emcarebase"
        },
        {
            "type": "depends-on",
            "resource": "https://fhir.dk.swisstph-mis.ch/matchbox/fhir/Library/weightforage"
        },
        {
            "type": "depends-on",
            "resource": "https://fhir.dk.swisstph-mis.ch/matchbox/fhir/Library/anthrobase"
        },
        {
            "type": "depends-on",
            "resource": "https://fhir.dk.swisstph-mis.ch/matchbox/fhir/Library/weightforlength"
        },
        {
            "type": "depends-on",
            "resource": "https://fhir.dk.swisstph-mis.ch/matchbox/fhir/Library/weightforheight"
        }
    ],
    "parameter": [
        {
            "name": "encounter",
            "use": "in",
            "type": "Encounter"
        },
        {
            "name": "pastweight",
            "use": "out",
            "type": "decimal"
        },
        {
            "name": "patientsex",
            "use": "out",
            "type": "string"
        },
        {
            "name": "ageatpastweight",
            "use": "out",
            "type": "integer"
        },
        {
            "name": "pastweightzscore",
            "use": "out",
            "type": "decimal"
        },
        {
            "name": "pastweightactualised",
            "use": "out",
            "type": "decimal"
        },
        {
            "name": "WAZ",
            "use": "out",
            "type": "decimal"
        },
        {
            "name": "WLZ",
            "use": "out",
            "type": "decimal"
        },
        {
            "name": "WHZ",
            "use": "out",
            "type": "decimal"
        }
    ],
    "dataRequirement": [
        {
            "type": "Patient",
            "profile": [
                "http://hl7.org/fhir/StructureDefinition/Patient"
            ]
        },
        {
            "type": "Encounter",
            "profile": [
                "http://hl7.org/fhir/StructureDefinition/Encounter"
            ]
        },
        {
            "type": "Observation",
            "profile": [
                "http://hl7.org/fhir/StructureDefinition/Observation"
            ],
            "mustSupport": [
                "code",
                "encounter.reference",
                "encounter",
                "value",
                "status"
            ],
            "codeFilter": [
                {
                    "path": "code",
                    "code": [
                        {
                            "code": "EmCare.B6.DE06"
                        }
                    ]
                }
            ]
        }
    ],
    "content": [
        {
            "id": "ig-loader-emcarezscore.cql",
            "contentType": "text/cql",
            "data": "LyoKQGF1dGhvcjogUGF0cmljayBEZWxjcm9peApAZGVzY3JpcHRpb246IFRoaXMgbGlicmFyeSBpcyBwYXJ0IG9mIHRoZSBwcm9qZWN0IEVtQ2FyZQoqLwpsaWJyYXJ5IGVtY2FyZXpzY29yZSB2ZXJzaW9uICcxLjAuNzMrYnVpbGQuMjE2Jwp1c2luZyBGSElSIHZlcnNpb24gJzQuMC4xJwppbmNsdWRlIEZISVJIZWxwZXJzIHZlcnNpb24gJzQuMC4xJyBjYWxsZWQgRkhJUkhlbHBlcnMgCmluY2x1ZGUgZW1jYXJlYmFzZSB2ZXJzaW9uICcxLjAuNzMrYnVpbGQuMjE2JyBjYWxsZWQgQmFzZQppbmNsdWRlIFdlaWdodEZvckFnZSB2ZXJzaW9uICcxLjAuNCcgY2FsbGVkIHdmYQppbmNsdWRlIFdlaWdodEZvckxlbmd0aCB2ZXJzaW9uICcxLjAuNCcgY2FsbGVkIHdmbAppbmNsdWRlIFdlaWdodEZvckhlaWdodCB2ZXJzaW9uICcxLjAuNCcgY2FsbGVkIHdmaAoKCgovL2NvZGVzeXN0ZW0gIkVtQ2FyZSIgOiAnaHR0cHM6Ly9maGlyLmRrLnN3aXNzdHBoLW1pcy5jaC9tYXRjaGJveC9maGlyL0NvZGVTeXN0ZW0vZW1jYXJlLWN1c3RvbS1jb2RlcycKCgoKLy9jb2RlICJXZWlnaHQiOiAnRW1DYXJlLkI2LkRFMDYnIGZyb20gIkVtQ2FyZSIgZGlzcGxheSAnV2VpZ2h0JwovL2NvZGUgIkVzdGltYXRlZCBXZWlnaHQiOiAnRW1DYXJlLkI2LkRFMDgnIGZyb20gIkVtQ2FyZSIgZGlzcGxheSAnRXN0aW1hdGVkIFdlaWdodCcKLy9jb2RlICJNVUFDIjogJ0VtQ2FyZS5CNi5ERTE3JyBmcm9tICJFbUNhcmUiIGRpc3BsYXkgJ01VQUMnCi8vY29kZSAiTGVuZ3RoIjogJ0VtQ2FyZS5CNi5ERTEyJyBmcm9tICJFbUNhcmUiIGRpc3BsYXkgJ0xlbmd0aCcKLy9jb2RlICJIZWlnaHQiOiAnRW1DYXJlLkI2LkRFMDknIGZyb20gIkVtQ2FyZSIgZGlzcGxheSAnSGVpZ2h0JwoKcGFyYW1ldGVyICJlbmNvdW50ZXJpZCIgU3RyaW5nCgpjb250ZXh0IFBhdGllbnQKCmRlZmluZSAiV2VpZ2h0IjoKICBCYXNlLmNvZGluZygnRW1DYXJlLkI2LkRFMDYnKQpkZWZpbmUgIkVzdGltYXRlZCBXZWlnaHQiOgogIEJhc2UuY29kaW5nKCdFbUNhcmUuQjYuREUwOCcpCmRlZmluZSAiTVVBQyI6CiAgQmFzZS5jb2RpbmcoJ0VtQ2FyZS5CNi5ERTE3JykKZGVmaW5lICJMZW5ndGgiOgogIEJhc2UuY29kaW5nKCdFbUNhcmUuQjYuREUxMicpCmRlZmluZSAiSGVpZ2h0IjoKICBCYXNlLmNvZGluZygnRW1DYXJlLkI2LkRFMDknKQpkZWZpbmUgIlZpc3VhbGx5IGFzc2VzcyI6CiAgQmFzZS5jb2RpbmcoJ0VtQ2FyZS5CNi5ERTE4JykKZGVmaW5lICJVbmRlcndlaWdodCI6CiAgQmFzZS5jb2RpbmcoJ0VtQ2FyZS5CNi5ERTIwJykgCmRlZmluZSAiU2V2ZXJlbHkgVW5kZXJ3ZWlnaHQiOgogIEJhc2UuY29kaW5nKCdFbUNhcmUuQjYuREUyMScpIAoKLyogcGFzdHdlaWdodCA6IFByZXZpb3VzIFdlaWdodCovCmRlZmluZSAicGFzdHdlaWdodG9icyI6CiAgICBpZiBBZ2VJbk1vbnRocygpPCA0ICB0aGVuCiAgICAgIEJhc2UuR2V0SGlzdG9yaWNPYnNlcnZhdGlvbigiV2VpZ2h0IiwgNjApCiAgICBlbHNlIGlmIEFnZUluTW9udGhzKCk8IDYgIHRoZW4KICAgICAgQmFzZS5HZXRIaXN0b3JpY09ic2VydmF0aW9uKCJXZWlnaHQiLCA5MSkKICAgIGVsc2UgaWYgQWdlSW5Nb250aHMoKTwgMTIgIHRoZW4KICAgICAgQmFzZS5HZXRIaXN0b3JpY09ic2VydmF0aW9uKCJXZWlnaHQiLCAxMjEpCiAgICBlbHNlIAogICAgICBCYXNlLkdldEhpc3RvcmljT2JzZXJ2YXRpb24oIldlaWdodCIsIDE4MCkKCmRlZmluZSAicGFzdHdlaWdodCI6CiAgICBpZiAicGFzdHdlaWdodG9icyIgaXMgbm90IG51bGwgdGhlbgogICAgICAicGFzdHdlaWdodG9icyIudmFsdWUKICAgIGVsc2UgbnVsbAoKLyogcGF0aWVudHNleCA6IFBhdGllbnQgc2V4Ki8KZGVmaW5lICJwYXRpZW50c2V4IjoKICAgIGlmIFBhdGllbnQuZ2VuZGVyID0gJ2ZlbWFsZScgdGhlbiAnZmVtYWxlJyBlbHNlICdtYWxlJwoKLyogYWdlYXRwYXN0d2VpZ2h0IDogQWdlIGF0IFByZXZpb3VzIFdlaWdodCovCmRlZmluZSAiYWdlYXRwYXN0d2VpZ2h0IjoKICAgIGlmICJwYXN0d2VpZ2h0IiBpcyBub3QgbnVsbCAgdGhlbgogICAgICAgIChkaWZmZXJlbmNlIGluIGRheXMgYmV0d2VlbiBQYXRpZW50LmJpcnRoRGF0ZSBhbmQgVG9EYXRlKHBhc3R3ZWlnaHRvYnMuaXNzdWVkKSkgKiAoIDEuMCBhcyBTeXN0ZW0uRGVjaW1hbCApCiAgICBlbHNlCiAgICAgbnVsbAoKLyogcGFzdHdlaWdodHpzY29yZSA6IFotU2NvcmUgYXQgUHJldmlvdXMgV2VpZ2h0Ki8KZGVmaW5lICJwYXN0d2VpZ2h0enNjb3JlIjoKICAgIGlmICJwYXN0d2VpZ2h0IiBpcyBub3QgbnVsbCAgdGhlbgogICAgICB3ZmEuZ2VuZXJhdGVaU2NvcmVXZWlnaHRGb3JBZ2UoInBhdGllbnRzZXgiLCAiYWdlYXRwYXN0d2VpZ2h0IiAsICgicGFzdHdlaWdodCIudmFsdWUgKiAoIDEuMCBhcyBTeXN0ZW0uRGVjaW1hbCkpKQogICAgZWxzZQogICAgICBudWxsCgovKiBwYXN0d2VpZ2h0YWN0dWFsaXNlZCA6IFdlaWdodCBmcm9tICBhdCBQcmV2aW91cyBXZWlnaHQqLwpkZWZpbmUgInBhc3R3ZWlnaHRhY3R1YWxpc2VkIjoKICAgIGlmICJwYXN0d2VpZ2h0enNjb3JlIiBpcyBub3QgbnVsbCB0aGVuCiAgICAgIFN5c3RlbS5RdWFudGl0eSB7IHZhbHVlOiBSb3VuZCh3ZmEuZ2VuZXJhdGVXZWlnaHRGcm9tQWdlKCJwYXRpZW50c2V4IixBZ2VJbkRheXMoKSAqICggMS4wIGFzIFN5c3RlbS5EZWNpbWFsICksICAicGFzdHdlaWdodHpzY29yZSIgKSwyKSwgdW5pdDogJ2tnJ30gCiAgICBlbHNlIAogICAgICAgbnVsbAoKCgpkZWZpbmUgZXhpc3Rpbmd3ZWlnaHQ6CiAgQmFzZS5HZXRPYnNWYWx1ZSgiV2VpZ2h0IikKCmRlZmluZSBleGlzdGluZ2VzdGltbmF0ZWR3ZWlnaHQ6CiAgaWYgZXhpc3Rpbmd3ZWlnaHQgaXMgbnVsbCB0aGVuICAKICAgIEJhc2UuR2V0T2JzVmFsdWUoIkVzdGltYXRlZCBXZWlnaHQiKQogIGVsc2UgCiAgICBudWxsCgpkZWZpbmUgZXhpc3RpbmdoZWlnaHQ6CiAgQmFzZS5HZXRPYnNWYWx1ZSgiSGVpZ2h0IikKCmRlZmluZSBleGlzdGluZ2xlbmd0aDoKICBCYXNlLkdldE9ic1ZhbHVlKCJMZW5ndGgiKQoKZGVmaW5lIGV4aXN0aW5nbXVhYzoKICBCYXNlLkdldE9ic1ZhbHVlKCJNVUFDIikKCmRlZmluZSBleGlzdGluZ3Zpc3VhbDoKICBCYXNlLkdldE9ic1ZhbHVlKCJWaXN1YWxseSBhc3Nlc3MiKQovLwpkZWZpbmUgenNjb3JlZnJvbW11YWM6CiAgaWYgZXhpc3RpbmdtdWFjIGlzIG51bGwgdGhlbiBudWxsCiAgZWxzZSBpZiBleGlzdGluZ211YWMgPCAxMTUgJ21ubScgdGhlbiAtMy4wCiAgZWxzZSBpZiBleGlzdGluZ211YWMgPCAxMjUgJ21ubScgdGhlbiAtMi4wCiAgZWxzZSAwLjAKCmRlZmluZSBlc3RpbWF0ZWR3ZWlnaHQ6CiAgY2FzZSAgCiAgd2hlbiBleGlzdGluZ3dlaWdodCBpcyBub3QgbnVsbCB0aGVuIG51bGwKICB3aGVuIGV4aXN0aW5nZXN0aW1uYXRlZHdlaWdodCBpcyBub3QgbnVsbCB0aGVuIGV4aXN0aW5nZXN0aW1uYXRlZHdlaWdodAogIHdoZW4gcGFzdHdlaWdodGFjdHVhbGlzZWQgaXMgbm90IG51bGwgdGhlbiBwYXN0d2VpZ2h0YWN0dWFsaXNlZAogIHdoZW4gQWdlSW5Nb250aHMoKT4yNCBhbmQgZXhpc3RpbmdoZWlnaHQgdGhlbiB3ZWlnaHRmcm9taGVpZ2h0CiAgd2hlbiBBZ2VJbk1vbnRocygpPD0yNCBhbmQgZXhpc3RpbmdsZW5ndGggdGhlbiB3ZWlnaHRmcm9tbGVuZ3RoCiAgZWxzZSB3ZWlnaHRmcm9tYWdlCiAgZW5kCgpkZWZpbmUgenNjb3JlZnJvbXZpc3VhbDoKICAgIGlmIGV4aXN0aW5ndmlzdWFsIGlzIG5vdCBudWxsIHRoZW4KICAgICAgY2FzZSAgCiAgICAgICAgd2hlbiBleGlzdGluZ3Zpc3VhbCB+ICJTZXZlcmVseSBVbmRlcndlaWdodCIgdGhlbiAtMy4wCiAgICAgICAgd2hlbiBleGlzdGluZ3Zpc3VhbCB+ICJVbmRlcndlaWdodCIgdGhlbiAtMi4wCiAgICAgICAgZWxzZSAwLjAKICAgICAgZW5kCiAgICBlbHNlICBudWxsCgoKZGVmaW5lIHdlaWdodGZyb21sZW5ndGg6CiAgICBTeXN0ZW0uUXVhbnRpdHkgeyB2YWx1ZTogUm91bmQod2ZsLmdlbmVyYXRlV2VpZ2h0RnJvbUxlbmd0aCgicGF0aWVudHNleCIsKGNvbnZlcnQgZXhpc3RpbmdsZW5ndGggdG8gJ2NtJykudmFsdWUgKiAoIDEuMCBhcyBTeXN0ZW0uRGVjaW1hbCApLCB6c2NvcmVmcm9tbXVhYyksMiksIHVuaXQ6ICdrZyd9CgpkZWZpbmUgd2VpZ2h0ZnJvbWhlaWdodDoKICAgIFN5c3RlbS5RdWFudGl0eSB7IHZhbHVlOlJvdW5kKHdmaC5nZW5lcmF0ZVdlaWdodEZyb21IZWlnaHQoInBhdGllbnRzZXgiLChjb252ZXJ0IGV4aXN0aW5naGVpZ2h0IHRvICdjbScpLnZhbHVlICogKCAxLjAgYXMgU3lzdGVtLkRlY2ltYWwgKSwgenNjb3JlZnJvbW11YWMpLDIpLCB1bml0OiAna2cnfQoKZGVmaW5lIHdlaWdodGZyb21hZ2U6CiAgICBTeXN0ZW0uUXVhbnRpdHkgeyB2YWx1ZTpSb3VuZCh3ZmEuZ2VuZXJhdGVXZWlnaHRGcm9tQWdlKCJwYXRpZW50c2V4IixBZ2VJbkRheXMoKSAqICggMS4wIGFzIFN5c3RlbS5EZWNpbWFsICksIHpzY29yZWZyb21tdWFjKSwyKSwgdW5pdDogJ2tnJ30KLyoKKGNvbnZlcnQgQmFzZS5IYXNPYnMoIldlaWdodCIpIHRvICdLZycpIGRvZXMgbm90IHdvcmssIHNvIGxldCdzIGFzc3VtZSB0aGUgd2VpZ2h0IGlzIGluIEtnCiovCmRlZmluZSAiV0FaIjoKICAgIGlmIGV4aXN0aW5nd2VpZ2h0IGlzIG5vdCBudWxsIHRoZW4KICAgICAgICAgd2ZhLmdlbmVyYXRlWlNjb3JlV2VpZ2h0Rm9yQWdlKCJwYXRpZW50c2V4IiwgQWdlSW5EYXlzKCkgLCAoZXhpc3Rpbmd3ZWlnaHQudmFsdWUgKiAoIDEuMCBhcyBTeXN0ZW0uRGVjaW1hbCApKSkKICAgIGVsc2UgaWYgZXhpc3RpbmdtdWFjIGlzIG5vdCBudWxsIHRoZW4KICAgICAgICB6c2NvcmVmcm9tbXVhYwogICAgZWxzZSBpZiBleGlzdGluZ3Zpc3VhbCB0aGVuCiAgICAgICAgenNjb3JlZnJvbXZpc3VhbAogICAgZWxzZSBudWxsCgpkZWZpbmUgIldMWiI6CiAgICBpZiBleGlzdGluZ3dlaWdodCBpcyBub3QgbnVsbCB0aGVuCiAgICAgICAgIHdmbC5nZW5lcmF0ZVpTY29yZVdlaWdodEZvckxlbmd0aCgicGF0aWVudHNleCIsIChleGlzdGluZ2xlbmd0aC52YWx1ZSAqICggMS4wIGFzIFN5c3RlbS5EZWNpbWFsICkpICwgIChleGlzdGluZ3dlaWdodC52YWx1ZSAqICggMS4wIGFzIFN5c3RlbS5EZWNpbWFsICkpKQogICAgZWxzZSBpZiBleGlzdGluZ211YWMgaXMgbm90IG51bGwgdGhlbgogICAgICAgIHpzY29yZWZyb21tdWFjCiAgICBlbHNlIGlmIGV4aXN0aW5ndmlzdWFsIHRoZW4KICAgICAgICB6c2NvcmVmcm9tdmlzdWFsCiAgICBlbHNlIG51bGwKCmRlZmluZSAiV0haIjoKICAgIGlmIGV4aXN0aW5nd2VpZ2h0IGlzIG5vdCBudWxsIHRoZW4KICAgICAgICAgd2ZoLmdlbmVyYXRlWlNjb3JlV2VpZ2h0Rm9ySGVpZ2h0KCJwYXRpZW50c2V4IiwgKGV4aXN0aW5naGVpZ2h0LnZhbHVlICogKCAxLjAgYXMgU3lzdGVtLkRlY2ltYWwgKSkgLCAgKGV4aXN0aW5nd2VpZ2h0LnZhbHVlICogKCAxLjAgYXMgU3lzdGVtLkRlY2ltYWwgKSkpCiAgICBlbHNlIGlmIGV4aXN0aW5nbXVhYyBpcyBub3QgbnVsbCB0aGVuCiAgICAgICAgenNjb3JlZnJvbW11YWMKICAgIGVsc2UgaWYgZXhpc3Rpbmd2aXN1YWwgdGhlbgogICAgICAgIHpzY29yZWZyb212aXN1YWwKICAgIGVsc2UgbnVsbAo="
        }
    ]
}