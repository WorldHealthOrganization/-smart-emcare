map 'https://fhir.dk.swisstph-mis.ch/matchbox/fhir/StructureMap/structuremap-emcare-relatedperson-caregiver-emcarea.registration.p' = 'emcare-relatedperson-caregiver-EmCareA.Registration.P'

uses 'https://fhir.dk.swisstph-mis.ch/matchbox/fhir/Questionnaire/questionnaire-emcarea.registration.p' alias 'emcarea.registration.p' as source
uses 'https://fhir.dk.swisstph-mis.ch/matchbox/fhir/Profile/profile-emcare-relatedperson-caregiver' alias 'emcare-relatedperson-caregiver' as target
group  main(
	source qr : 'emcarea.registration.p',
	target tgt : 'emcare-relatedperson-caregiver'
) {
	qr.item as item then {
		item.answer first as a where item.linkId = 'EmCare.A.DE21'  then { tgt.name as name then {  a -> name.given = create(a) 'set-given-0';} 'EmCare.A.DE21-1'; } 'EmCare.A.DE21';
		item.answer first as a where item.linkId = 'EmCare.A.DE22'  then { tgt.name as name then {  a -> name.given= create(a) 'set-given-1';} 'EmCare.A.DE22-1'; } 'EmCare.A.DE22';
		item.answer first as a where item.linkId = 'EmCare.A.DE23'  then { tgt.name as name then {  a -> name.family = a 'set-family';} 'EmCare.A.DE23-1'; } 'EmCare.A.DE23';
		item.answer first as a where item.linkId = 'EmCare.A.DE35'  then { tgt.telecom as tel then {  a -> tel.system = 'http://hl7.org/fhir/contact-point-system#phone', tel.use = translate('{{cs_concept}}', 'telecom-use', 'http://hl7.org/fhir/contact-point-use'), tel.value = a 'mphone-1';} 'EmCare.A.DE35-1'; } 'EmCare.A.DE35';
		item.answer first as a where item.linkId = 'EmCare.A.DE36'  then { tgt.telecom as tel then {  a -> tel.system = 'http://hl7.org/fhir/contact-point-system#phone', tel.use = translate('{{cs_concept}}', 'telecom-use', 'http://hl7.org/fhir/contact-point-use'), tel.value = a 'hphone-1';} 'EmCare.A.DE36-1'; } 'EmCare.A.DE36';
		item.answer first as a where item.linkId = 'EmCare.A.DE37'  then { tgt.telecom as tel then {  a -> tel.system = 'http://hl7.org/fhir/contact-point-system#phone', tel.use = translate('{{cs_concept}}', 'telecom-use', 'http://hl7.org/fhir/contact-point-use'), tel.value = a 'wphone-1';} 'EmCare.A.DE37-1'; } 'EmCare.A.DE37';
		item.answer first as a where item.linkId = 'EmCare.A.DE24'  then { a where a= 'EmCare.A.DE30'  -> tgt.relationship =  translate(a, 'relationship-to-client', 'http://terminology.hl7.org/CodeSystem/v2-0131')  'caregiver-parent'; a where a != 'EmCare.A.DE30' -> tgt.relationship =  translate(a, 'relationship-to-client', 'http://terminology.hl7.org/CodeSystem/v3-RoleCode') 'EmCare.A.DE24-1'; } 'EmCare.A.DE24';
	} 'itemsemcarea.registration.p-emcare-relatedperson-caregiver';
} 

