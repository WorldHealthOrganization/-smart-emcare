{
    "resourceType": "StructureMap",
    "id": "emcareb.registration.e",
    "text": {
        "status": "generated",
        "div": "<div xmlns=\"http://www.w3.org/1999/xhtml\"><pre>map &quot;https://fhir.dk.swisstph-mis.ch/matchbox/fhir/StructureMap/emcareb.registration.e&quot; = &quot;emcareb.registration.e&quot;\r\n\r\n\r\nuses &quot;http://hl7.org/fhir/uv/sdc/StructureDefinition/sdc-questionnaireresponse&quot; alias 'questionnaireResponse' as source\r\nuses &quot;http://hl7.org/fhir/StructureDefinition/Bundle&quot; alias 'Bundle' as target\r\nuses &quot;https://fhir.dk.swisstph-mis.ch/matchbox/fhir/StructureDefinition/encounter&quot; alias 'Encounter' as target\r\nuses &quot;https://fhir.dk.swisstph-mis.ch/matchbox/fhir/StructureDefinition/relatedperson&quot; alias 'RelatedPerson' as target\r\nuses &quot;https://fhir.dk.swisstph-mis.ch/matchbox/fhir/StructureDefinition/observation&quot; alias 'Observation' as target\r\nuses &quot;https://fhir.dk.swisstph-mis.ch/matchbox/fhir/StructureDefinition/emcareencounter&quot; alias 'EmCare Encounter' as produced\r\nuses &quot;https://fhir.dk.swisstph-mis.ch/matchbox/fhir/StructureDefinition/emcarerelatedpersonaccompanying&quot; alias 'EmCare RelatedPerson Accompanying' as produced\r\nuses &quot;https://fhir.dk.swisstph-mis.ch/matchbox/fhir/StructureDefinition/emcareobservation&quot; alias 'EmCare Observation' as produced\r\n\r\ngroup bundletrans(source src : questionnaireResponse, target bundle : Bundle) {\r\n  src -&gt; bundle.id = uuid() &quot;id&quot;;\r\n  src -&gt; bundle.type = 'batch' &quot;type&quot;;\r\n  src -&gt; bundle.entry as entry then {\r\n    src.encounter as encounter then {\r\n      encounter.id as idval -&gt;  entry.request as request,  request.method = 'PUT',  request.url = append('/Encounter/', idval) &quot;f7ed42d5&quot;;\r\n    } &quot;49f4ed45&quot;;\r\n    src -&gt; entry.resource = create('Encounter') as tgt then {\r\n      src -&gt; tgt then emcareencounter(src, tgt) &quot;fd415ba8&quot;;\r\n      src.subject as sub -&gt; tgt.subject = sub &quot;23252e10&quot;;\r\n    } &quot;aa65c498&quot;;\r\n  } &quot;put-emcareencounter&quot;;\r\n  src where src.item.where(linkId = 'emcarerelatedpersonaccompanyingid').exists() -&gt; bundle.entry as entry then {\r\n    src.item first as item where linkId = 'emcarerelatedpersonaccompanyingid' then {\r\n      src -&gt;  entry.request as request,  request.method = 'PUT' then {\r\n        item.answer first as a -&gt; request then {\r\n          a.value as val -&gt; request.url = append('/RelatedPerson/', val) &quot;11e3b388&quot;;\r\n        } &quot;c5e7331f&quot;;\r\n      } &quot;72bf1ce2&quot;;\r\n    } &quot;1eb27b1c&quot;;\r\n    src -&gt; entry.resource = create('RelatedPerson') as tgt then {\r\n      src -&gt; tgt then emcarerelatedpersonaccompanying(src, tgt) &quot;6ecfb1de&quot;;\r\n    } &quot;9ccbf23c&quot;;\r\n  } &quot;put-emcarerelatedpersonaccompanying&quot;;\r\n  src where src.item.where(linkId = 'EmCare.B3.DE05').exists() then {\r\n    src -&gt;  bundle.entry as entry,  entry.request as request,  request.method = 'POST',  entry.resource = create('Observation') as tgt then emcareobservationemcareb3de05(src, tgt) &quot;DE05&quot;;\r\n  } &quot;emcareobservation&quot;;\r\n}\r\n\r\ngroup emcareencounter(source src : questionnaireResponse, target tgt : Encounter) {\r\n  src.item first as item where linkId = 'EmCare.A.DE07' then {\r\n    item.answer first as a then {\r\n      a.value as val -&gt;  tgt.period as period,  period.start = val &quot;aemcareade07&quot;;\r\n    } &quot;aemcareade07&quot;;\r\n  } &quot;63d9918f&quot;;\r\n  src.item first as item where linkId = 'EmCare.B2.DE01' then {\r\n    item.answer first as a then {\r\n      a.value as val -&gt;  tgt.type = create('CodeableConcept') as CC,  CC.text = 'type of visit',  CC.coding = val &quot;aemcareb2de01&quot;;\r\n    } &quot;aemcareb2de01&quot;;\r\n  } &quot;dd02401f&quot;;\r\n  src.item first as item where linkId = 'EmCare.B3.DE01' then {\r\n    item.answer first as a then {\r\n      a.value as val -&gt;  tgt.reasonCode = create('CodeableConcept') as CC,  CC.text = 'new consultation',  CC.coding = val &quot;aemcareb3de01&quot;;\r\n    } &quot;aemcareb3de01&quot;;\r\n  } &quot;a7d66058&quot;;\r\n  src.item first as item where linkId = 'EmCare.B3.DE06' then {\r\n    item.answer first as a then {\r\n      a.value as val -&gt;  tgt.type = create('CodeableConcept') as CC,  CC.text = 'new consultation',  CC.coding = val &quot;aemcareb3de06&quot;;\r\n    } &quot;aemcareb3de06&quot;;\r\n  } &quot;a4cd660d&quot;;\r\n  src.item first as item where linkId = 'EmCare.B3.DE09' then {\r\n    item.answer first as a then {\r\n      a.value as val -&gt;  tgt.extension = create('Extension') as ext,  ext.url = 'https://fhir.dk.swisstph-mis.ch/matchbox/fhir/StructureDefinition/refered',  ext.value = val &quot;aemcareb3de09&quot;;\r\n    } &quot;aemcareb3de09&quot;;\r\n  } &quot;bfd6d318&quot;;\r\n}\r\n\r\ngroup getIdemcareencounter(source src, target tgt) {\r\n  src.item first as item where linkId = 'emcareencounterid' -&gt; tgt then {\r\n    item.answer first as a -&gt; tgt then {\r\n      a.value as val -&gt; tgt.id = val &quot;8e3eaf71&quot;;\r\n    } &quot;f3550c0d&quot;;\r\n  } &quot;269afe68&quot;;\r\n}\r\n\r\ngroup getFullUrlemcareencounter(source src, target tgt) {\r\n  src.item first as item where linkId = 'emcareencounterid' -&gt; tgt then {\r\n    item.answer first as a -&gt; tgt then {\r\n      a.value as val -&gt; tgt.fullUrl = append('urn:uuid:', val) &quot;a6735326&quot;;\r\n    } &quot;8a0f6df2&quot;;\r\n  } &quot;d383794d&quot;;\r\n}\r\n\r\ngroup getUrlemcareencounter(source src, target tgt) {\r\n  src.item first as item where linkId = 'emcareencounterid' -&gt; tgt then {\r\n    item.answer first as a -&gt; tgt then {\r\n      a.value as val -&gt; ref.reference = append('/Encounter/', val) &quot;e8494603&quot;;\r\n    } &quot;35ea1ad7&quot;;\r\n  } &quot;558d60eb&quot;;\r\n}\r\n\r\ngroup emcarerelatedpersonaccompanying(source src : questionnaireResponse, target tgt : RelatedPerson) {\r\n  src.item first as itm1 where linkId = 'EmCare.A.DE49.1' then {\r\n    itm1.item first as item where (linkId = 'EmCare.A.DE41') or (linkId = 'EmCare.A.DE40') then {\r\n      src -&gt;  tgt as target,  target.name as name then SetOfficalGivenNameemcarerelatedpersonaccompanying(src, name) &quot;3810df8b&quot;;\r\n    } &quot;e7f1578a&quot;;\r\n  } &quot;d100c750&quot;;\r\n  src.item first as itm1 where linkId = 'EmCare.A.DE49.1' then {\r\n    itm1.item first as item where linkId = 'EmCare.A.DE41' then {\r\n      item.answer first as a then {\r\n        a.value as val -&gt;  tgt.telecom as tel,  tel.system = 'phone',  tel.use = 'mobile',  tel.value = val &quot;aemcareade41&quot;;\r\n      } &quot;aemcareade41&quot;;\r\n    } &quot;15fc0694&quot;;\r\n  } &quot;a5efce09&quot;;\r\n  src.item first as itm1 where linkId = 'EmCare.A.DE49.1' then {\r\n    itm1.item first as item where linkId = 'EmCare.A.DE43' then {\r\n      item.answer first as a then MapValueSetExtCodeemcareade43(a, tgt) &quot;0118f802&quot;;\r\n    } &quot;f30fad52&quot;;\r\n  } &quot;47d8f6d5&quot;;\r\n}\r\n\r\ngroup SetOfficalGivenNameemcarerelatedpersonaccompanying(source src, target tgt) {\r\n  src -&gt; tgt.use = 'official' then {\r\n    src.item first as itm1 where linkId = 'EmCare.A.DE49.1' then {\r\n      itm1.item first as item where linkId = 'EmCare.A.DE41' then {\r\n        item.answer first as a then {\r\n          a.value as val -&gt; tgt.family = val &quot;77d1bd4f&quot;;\r\n        } &quot;e0827d5d&quot;;\r\n      } &quot;ff55696b&quot;;\r\n    } &quot;d7e96bf2&quot;;\r\n    src.item first as itm1 where linkId = 'EmCare.A.DE49.1' then {\r\n      itm1.item first as item where linkId = 'EmCare.A.DE40' then {\r\n        item.answer first as a then {\r\n          a.value as val -&gt; tgt.given = val &quot;5d3d44f6&quot;;\r\n        } &quot;18edd234&quot;;\r\n      } &quot;e84a0f31&quot;;\r\n    } &quot;f3fd65b0&quot;;\r\n  } &quot;226010d3&quot;;\r\n}\r\n\r\ngroup MapValueSetExtCodeemcareade43(source src, target tgt) {\r\n  src -&gt; tgt then {\r\n    src -&gt;  tgt.relationship = create('CodeableConcept') as cc,  cc.coding = create('Coding') as coding then {\r\n      src where value.code = 'EmCare.A.DE25' -&gt;  coding.code = 'MTH',  coding.system = 'http://terminology.hl7.org/CodeSystem/v3-RoleCode' &quot;abd34a78&quot;;\r\n      src where value.code = 'EmCare.A.DE26' -&gt;  coding.code = 'FTH',  coding.system = 'http://terminology.hl7.org/CodeSystem/v3-RoleCode' &quot;b53d1d15&quot;;\r\n      src where value.code = 'EmCare.A.DE27' -&gt;  coding.code = 'SIB',  coding.system = 'http://terminology.hl7.org/CodeSystem/v3-RoleCode' &quot;949ee35f&quot;;\r\n      src where value.code = 'EmCare.A.DE28' -&gt;  coding.code = 'EXT',  coding.system = 'http://terminology.hl7.org/CodeSystem/v3-RoleCode' &quot;7c5a4400&quot;;\r\n      src where value.code = 'EmCare.A.DE29' -&gt;  coding.code = 'PRNINLAW',  coding.system = 'http://terminology.hl7.org/CodeSystem/v3-RoleCode' &quot;544df0cc&quot;;\r\n      src where value.code = 'EmCare.A.DE30' -&gt;  coding.code = 'U',  coding.system = 'http://terminology.hl7.org/CodeSystem/v2-0131' &quot;8c2d96fc&quot;;\r\n    } &quot;4a251df5&quot;;\r\n  } &quot;1b7b6d7a&quot;;\r\n}\r\n\r\ngroup getIdemcarerelatedpersonaccompanying(source src, target tgt) {\r\n  src.item first as item where linkId = 'emcarerelatedpersonaccompanyingid' -&gt; tgt then {\r\n    item.answer first as a -&gt; tgt then {\r\n      a.value as val -&gt; tgt.id = val &quot;8e3eaf71&quot;;\r\n    } &quot;f3550c0d&quot;;\r\n  } &quot;c20a932d&quot;;\r\n}\r\n\r\ngroup getFullUrlemcarerelatedpersonaccompanying(source src, target tgt) {\r\n  src.item first as item where linkId = 'emcarerelatedpersonaccompanyingid' -&gt; tgt then {\r\n    item.answer first as a -&gt; tgt then {\r\n      a.value as val -&gt; tgt.fullUrl = append('urn:uuid:', val) &quot;a6735326&quot;;\r\n    } &quot;8a0f6df2&quot;;\r\n  } &quot;c5f52a0f&quot;;\r\n}\r\n\r\ngroup getUrlemcarerelatedpersonaccompanying(source src, target tgt) {\r\n  src.item first as item where linkId = 'emcarerelatedpersonaccompanyingid' -&gt; tgt then {\r\n    item.answer first as a -&gt; tgt then {\r\n      a.value as val -&gt; ref.reference = append('/RelatedPerson/', val) &quot;25b16148&quot;;\r\n    } &quot;00b2016a&quot;;\r\n  } &quot;6aace494&quot;;\r\n}\r\n\r\ngroup emcareobservationemcareb3de05(source src, target tgt) {\r\n  src -&gt;  tgt.identifier = create('Identifier') as CodeID,  CodeID.system = 'http://hl7.org/fhir/namingsystem-identifier-type',  CodeID.use = 'official',  CodeID.value = 'uuid',  CodeID.id = uuid() &quot;id-emcareb3de05&quot;;\r\n  src.encounter as encounter -&gt; tgt.encounter = encounter &quot;35bc6b82&quot;;\r\n  src.subject as subject -&gt;  tgt.subject = subject,  tgt.meta = create('Meta') as newMeta,  newMeta.profile = 'https://fhir.dk.swisstph-mis.ch/matchbox/fhir/StructureDefinition/emcareobservation',  tgt.code = create('CodeableConcept') as concept,  concept.coding = create('Coding') as coding,  coding.system = 'https://fhir.dk.swisstph-mis.ch/matchbox/fhir/CodeSystem/emcare-custom-codes',  coding.code = 'EmCare.B3.DE05' &quot;code-emcareb3de05&quot;;\r\n  src.item as item where linkId = 'timestamp' then {\r\n    item.answer first as a then {\r\n      a.value as val -&gt; tgt.issued = val &quot;8945c96b&quot;;\r\n    } &quot;4272fc8b&quot;;\r\n  } &quot;f4472f32&quot;;\r\n  src.subject as subject -&gt; tgt.subject = subject &quot;patient&quot;;\r\n  src.item first as item where linkId = 'EmCare.B3.DE05' then {\r\n    item.answer first as a then {\r\n      a where a.value = true -&gt;  tgt.status = 'final',  tgt.value = true &quot;final-emcareb3de05&quot;;\r\n      a where a.value = false -&gt;  tgt.status = 'cancelled',  tgt.value = false &quot;notfound-emcareb3de05&quot;;\r\n    } &quot;bdab9370&quot;;\r\n  } &quot;8bf2988b&quot;;\r\n}\r\n\r\n</pre></div>"
    },
    "url": "https://fhir.dk.swisstph-mis.ch/matchbox/fhir/StructureMap/emcareb.registration.e",
    "name": "emcareb.registration.e",
    "status": "active",
    "structure": [
        {
            "url": "http://hl7.org/fhir/uv/sdc/StructureDefinition/sdc-questionnaireresponse",
            "mode": "source",
            "alias": "'questionnaireResponse'"
        },
        {
            "url": "http://hl7.org/fhir/StructureDefinition/Bundle",
            "mode": "target",
            "alias": "'Bundle'"
        },
        {
            "url": "https://fhir.dk.swisstph-mis.ch/matchbox/fhir/StructureDefinition/encounter",
            "mode": "target",
            "alias": "'Encounter'"
        },
        {
            "url": "https://fhir.dk.swisstph-mis.ch/matchbox/fhir/StructureDefinition/relatedperson",
            "mode": "target",
            "alias": "'RelatedPerson'"
        },
        {
            "url": "https://fhir.dk.swisstph-mis.ch/matchbox/fhir/StructureDefinition/observation",
            "mode": "target",
            "alias": "'Observation'"
        },
        {
            "url": "https://fhir.dk.swisstph-mis.ch/matchbox/fhir/StructureDefinition/emcareencounter",
            "mode": "produced",
            "alias": "'EmCare Encounter'"
        },
        {
            "url": "https://fhir.dk.swisstph-mis.ch/matchbox/fhir/StructureDefinition/emcarerelatedpersonaccompanying",
            "mode": "produced",
            "alias": "'EmCare RelatedPerson Accompanying'"
        },
        {
            "url": "https://fhir.dk.swisstph-mis.ch/matchbox/fhir/StructureDefinition/emcareobservation",
            "mode": "produced",
            "alias": "'EmCare Observation'"
        }
    ],
    "group": [
        {
            "name": "bundletrans",
            "typeMode": "none",
            "input": [
                {
                    "name": "src",
                    "type": "questionnaireResponse",
                    "mode": "source"
                },
                {
                    "name": "bundle",
                    "type": "Bundle",
                    "mode": "target"
                }
            ],
            "rule": [
                {
                    "name": "id",
                    "source": [
                        {
                            "context": "src"
                        }
                    ],
                    "target": [
                        {
                            "context": "bundle",
                            "contextType": "variable",
                            "element": "id",
                            "transform": "uuid"
                        }
                    ]
                },
                {
                    "name": "type",
                    "source": [
                        {
                            "context": "src"
                        }
                    ],
                    "target": [
                        {
                            "context": "bundle",
                            "contextType": "variable",
                            "element": "type",
                            "transform": "copy",
                            "parameter": [
                                {
                                    "valueString": "batch"
                                }
                            ]
                        }
                    ]
                },
                {
                    "name": "put-emcareencounter",
                    "source": [
                        {
                            "context": "src"
                        }
                    ],
                    "target": [
                        {
                            "context": "bundle",
                            "contextType": "variable",
                            "element": "entry",
                            "variable": "entry"
                        }
                    ],
                    "rule": [
                        {
                            "name": "49f4ed45",
                            "source": [
                                {
                                    "context": "src",
                                    "element": "encounter",
                                    "variable": "encounter"
                                }
                            ],
                            "rule": [
                                {
                                    "name": "f7ed42d5",
                                    "source": [
                                        {
                                            "context": "encounter",
                                            "element": "id",
                                            "variable": "idval"
                                        }
                                    ],
                                    "target": [
                                        {
                                            "context": "entry",
                                            "contextType": "variable",
                                            "element": "request",
                                            "variable": "request"
                                        },
                                        {
                                            "context": "request",
                                            "contextType": "variable",
                                            "element": "method",
                                            "transform": "copy",
                                            "parameter": [
                                                {
                                                    "valueString": "PUT"
                                                }
                                            ]
                                        },
                                        {
                                            "context": "request",
                                            "contextType": "variable",
                                            "element": "url",
                                            "transform": "append",
                                            "parameter": [
                                                {
                                                    "valueString": "/Encounter/"
                                                },
                                                {
                                                    "valueId": "idval"
                                                }
                                            ]
                                        }
                                    ]
                                }
                            ]
                        },
                        {
                            "name": "aa65c498",
                            "source": [
                                {
                                    "context": "src"
                                }
                            ],
                            "target": [
                                {
                                    "context": "entry",
                                    "contextType": "variable",
                                    "element": "resource",
                                    "variable": "tgt",
                                    "transform": "create",
                                    "parameter": [
                                        {
                                            "valueString": "Encounter"
                                        }
                                    ]
                                }
                            ],
                            "rule": [
                                {
                                    "name": "fd415ba8",
                                    "source": [
                                        {
                                            "context": "src"
                                        }
                                    ],
                                    "target": [
                                        {
                                            "contextType": "variable",
                                            "transform": "copy",
                                            "parameter": [
                                                {
                                                    "valueId": "tgt"
                                                }
                                            ]
                                        }
                                    ],
                                    "dependent": [
                                        {
                                            "name": "emcareencounter",
                                            "variable": [
                                                "src",
                                                "tgt"
                                            ]
                                        }
                                    ]
                                },
                                {
                                    "name": "23252e10",
                                    "source": [
                                        {
                                            "context": "src",
                                            "element": "subject",
                                            "variable": "sub"
                                        }
                                    ],
                                    "target": [
                                        {
                                            "context": "tgt",
                                            "contextType": "variable",
                                            "element": "subject",
                                            "transform": "copy",
                                            "parameter": [
                                                {
                                                    "valueId": "sub"
                                                }
                                            ]
                                        }
                                    ]
                                }
                            ]
                        }
                    ]
                },
                {
                    "name": "put-emcarerelatedpersonaccompanying",
                    "source": [
                        {
                            "context": "src",
                            "condition": "src.item.where(linkId = 'emcarerelatedpersonaccompanyingid').exists()"
                        }
                    ],
                    "target": [
                        {
                            "context": "bundle",
                            "contextType": "variable",
                            "element": "entry",
                            "variable": "entry"
                        }
                    ],
                    "rule": [
                        {
                            "name": "1eb27b1c",
                            "source": [
                                {
                                    "context": "src",
                                    "element": "item",
                                    "listMode": "first",
                                    "variable": "item",
                                    "condition": "linkId = 'emcarerelatedpersonaccompanyingid'"
                                }
                            ],
                            "rule": [
                                {
                                    "name": "72bf1ce2",
                                    "source": [
                                        {
                                            "context": "src"
                                        }
                                    ],
                                    "target": [
                                        {
                                            "context": "entry",
                                            "contextType": "variable",
                                            "element": "request",
                                            "variable": "request"
                                        },
                                        {
                                            "context": "request",
                                            "contextType": "variable",
                                            "element": "method",
                                            "transform": "copy",
                                            "parameter": [
                                                {
                                                    "valueString": "PUT"
                                                }
                                            ]
                                        }
                                    ],
                                    "rule": [
                                        {
                                            "name": "c5e7331f",
                                            "source": [
                                                {
                                                    "context": "item",
                                                    "element": "answer",
                                                    "listMode": "first",
                                                    "variable": "a"
                                                }
                                            ],
                                            "target": [
                                                {
                                                    "contextType": "variable",
                                                    "transform": "copy",
                                                    "parameter": [
                                                        {
                                                            "valueId": "request"
                                                        }
                                                    ]
                                                }
                                            ],
                                            "rule": [
                                                {
                                                    "name": "11e3b388",
                                                    "source": [
                                                        {
                                                            "context": "a",
                                                            "element": "value",
                                                            "variable": "val"
                                                        }
                                                    ],
                                                    "target": [
                                                        {
                                                            "context": "request",
                                                            "contextType": "variable",
                                                            "element": "url",
                                                            "transform": "append",
                                                            "parameter": [
                                                                {
                                                                    "valueString": "/RelatedPerson/"
                                                                },
                                                                {
                                                                    "valueId": "val"
                                                                }
                                                            ]
                                                        }
                                                    ]
                                                }
                                            ]
                                        }
                                    ]
                                }
                            ]
                        },
                        {
                            "name": "9ccbf23c",
                            "source": [
                                {
                                    "context": "src"
                                }
                            ],
                            "target": [
                                {
                                    "context": "entry",
                                    "contextType": "variable",
                                    "element": "resource",
                                    "variable": "tgt",
                                    "transform": "create",
                                    "parameter": [
                                        {
                                            "valueString": "RelatedPerson"
                                        }
                                    ]
                                }
                            ],
                            "rule": [
                                {
                                    "name": "6ecfb1de",
                                    "source": [
                                        {
                                            "context": "src"
                                        }
                                    ],
                                    "target": [
                                        {
                                            "contextType": "variable",
                                            "transform": "copy",
                                            "parameter": [
                                                {
                                                    "valueId": "tgt"
                                                }
                                            ]
                                        }
                                    ],
                                    "dependent": [
                                        {
                                            "name": "emcarerelatedpersonaccompanying",
                                            "variable": [
                                                "src",
                                                "tgt"
                                            ]
                                        }
                                    ]
                                }
                            ]
                        }
                    ]
                },
                {
                    "name": "emcareobservation",
                    "source": [
                        {
                            "context": "src",
                            "condition": "src.item.where(linkId = 'EmCare.B3.DE05').exists()"
                        }
                    ],
                    "rule": [
                        {
                            "name": "act-EmCare.B3.DE05",
                            "source": [
                                {
                                    "context": "src"
                                }
                            ],
                            "target": [
                                {
                                    "context": "bundle",
                                    "contextType": "variable",
                                    "element": "entry",
                                    "variable": "entry"
                                },
                                {
                                    "context": "entry",
                                    "contextType": "variable",
                                    "element": "request",
                                    "variable": "request"
                                },
                                {
                                    "context": "request",
                                    "contextType": "variable",
                                    "element": "method",
                                    "transform": "copy",
                                    "parameter": [
                                        {
                                            "valueString": "POST"
                                        }
                                    ]
                                },
                                {
                                    "context": "entry",
                                    "contextType": "variable",
                                    "element": "resource",
                                    "variable": "tgt",
                                    "transform": "create",
                                    "parameter": [
                                        {
                                            "valueString": "Observation"
                                        }
                                    ]
                                }
                            ],
                            "dependent": [
                                {
                                    "name": "emcareobservationemcareb3de05",
                                    "variable": [
                                        "src",
                                        "tgt"
                                    ]
                                }
                            ]
                        }
                    ]
                }
            ]
        },
        {
            "name": "emcareencounter",
            "typeMode": "none",
            "input": [
                {
                    "name": "src",
                    "type": "questionnaireResponse",
                    "mode": "source"
                },
                {
                    "name": "tgt",
                    "type": "Encounter",
                    "mode": "target"
                }
            ],
            "rule": [
                {
                    "name": "63d9918f",
                    "source": [
                        {
                            "context": "src",
                            "element": "item",
                            "listMode": "first",
                            "variable": "item",
                            "condition": "linkId = 'EmCare.A.DE07'"
                        }
                    ],
                    "rule": [
                        {
                            "name": "aemcareade07",
                            "source": [
                                {
                                    "context": "item",
                                    "element": "answer",
                                    "listMode": "first",
                                    "variable": "a"
                                }
                            ],
                            "rule": [
                                {
                                    "name": "aemcareade07",
                                    "source": [
                                        {
                                            "context": "a",
                                            "element": "value",
                                            "variable": "val"
                                        }
                                    ],
                                    "target": [
                                        {
                                            "context": "tgt",
                                            "contextType": "variable",
                                            "element": "period",
                                            "variable": "period"
                                        },
                                        {
                                            "context": "period",
                                            "contextType": "variable",
                                            "element": "start",
                                            "transform": "copy",
                                            "parameter": [
                                                {
                                                    "valueId": "val"
                                                }
                                            ]
                                        }
                                    ]
                                }
                            ]
                        }
                    ]
                },
                {
                    "name": "dd02401f",
                    "source": [
                        {
                            "context": "src",
                            "element": "item",
                            "listMode": "first",
                            "variable": "item",
                            "condition": "linkId = 'EmCare.B2.DE01'"
                        }
                    ],
                    "rule": [
                        {
                            "name": "aemcareb2de01",
                            "source": [
                                {
                                    "context": "item",
                                    "element": "answer",
                                    "listMode": "first",
                                    "variable": "a"
                                }
                            ],
                            "rule": [
                                {
                                    "name": "aemcareb2de01",
                                    "source": [
                                        {
                                            "context": "a",
                                            "element": "value",
                                            "variable": "val"
                                        }
                                    ],
                                    "target": [
                                        {
                                            "context": "tgt",
                                            "contextType": "variable",
                                            "element": "type",
                                            "variable": "CC",
                                            "transform": "create",
                                            "parameter": [
                                                {
                                                    "valueString": "CodeableConcept"
                                                }
                                            ]
                                        },
                                        {
                                            "context": "CC",
                                            "contextType": "variable",
                                            "element": "text",
                                            "transform": "copy",
                                            "parameter": [
                                                {
                                                    "valueString": "type of visit"
                                                }
                                            ]
                                        },
                                        {
                                            "context": "CC",
                                            "contextType": "variable",
                                            "element": "coding",
                                            "transform": "copy",
                                            "parameter": [
                                                {
                                                    "valueId": "val"
                                                }
                                            ]
                                        }
                                    ]
                                }
                            ]
                        }
                    ]
                },
                {
                    "name": "a7d66058",
                    "source": [
                        {
                            "context": "src",
                            "element": "item",
                            "listMode": "first",
                            "variable": "item",
                            "condition": "linkId = 'EmCare.B3.DE01'"
                        }
                    ],
                    "rule": [
                        {
                            "name": "aemcareb3de01",
                            "source": [
                                {
                                    "context": "item",
                                    "element": "answer",
                                    "listMode": "first",
                                    "variable": "a"
                                }
                            ],
                            "rule": [
                                {
                                    "name": "aemcareb3de01",
                                    "source": [
                                        {
                                            "context": "a",
                                            "element": "value",
                                            "variable": "val"
                                        }
                                    ],
                                    "target": [
                                        {
                                            "context": "tgt",
                                            "contextType": "variable",
                                            "element": "reasonCode",
                                            "variable": "CC",
                                            "transform": "create",
                                            "parameter": [
                                                {
                                                    "valueString": "CodeableConcept"
                                                }
                                            ]
                                        },
                                        {
                                            "context": "CC",
                                            "contextType": "variable",
                                            "element": "text",
                                            "transform": "copy",
                                            "parameter": [
                                                {
                                                    "valueString": "new consultation"
                                                }
                                            ]
                                        },
                                        {
                                            "context": "CC",
                                            "contextType": "variable",
                                            "element": "coding",
                                            "transform": "copy",
                                            "parameter": [
                                                {
                                                    "valueId": "val"
                                                }
                                            ]
                                        }
                                    ]
                                }
                            ]
                        }
                    ]
                },
                {
                    "name": "a4cd660d",
                    "source": [
                        {
                            "context": "src",
                            "element": "item",
                            "listMode": "first",
                            "variable": "item",
                            "condition": "linkId = 'EmCare.B3.DE06'"
                        }
                    ],
                    "rule": [
                        {
                            "name": "aemcareb3de06",
                            "source": [
                                {
                                    "context": "item",
                                    "element": "answer",
                                    "listMode": "first",
                                    "variable": "a"
                                }
                            ],
                            "rule": [
                                {
                                    "name": "aemcareb3de06",
                                    "source": [
                                        {
                                            "context": "a",
                                            "element": "value",
                                            "variable": "val"
                                        }
                                    ],
                                    "target": [
                                        {
                                            "context": "tgt",
                                            "contextType": "variable",
                                            "element": "type",
                                            "variable": "CC",
                                            "transform": "create",
                                            "parameter": [
                                                {
                                                    "valueString": "CodeableConcept"
                                                }
                                            ]
                                        },
                                        {
                                            "context": "CC",
                                            "contextType": "variable",
                                            "element": "text",
                                            "transform": "copy",
                                            "parameter": [
                                                {
                                                    "valueString": "new consultation"
                                                }
                                            ]
                                        },
                                        {
                                            "context": "CC",
                                            "contextType": "variable",
                                            "element": "coding",
                                            "transform": "copy",
                                            "parameter": [
                                                {
                                                    "valueId": "val"
                                                }
                                            ]
                                        }
                                    ]
                                }
                            ]
                        }
                    ]
                },
                {
                    "name": "bfd6d318",
                    "source": [
                        {
                            "context": "src",
                            "element": "item",
                            "listMode": "first",
                            "variable": "item",
                            "condition": "linkId = 'EmCare.B3.DE09'"
                        }
                    ],
                    "rule": [
                        {
                            "name": "aemcareb3de09",
                            "source": [
                                {
                                    "context": "item",
                                    "element": "answer",
                                    "listMode": "first",
                                    "variable": "a"
                                }
                            ],
                            "rule": [
                                {
                                    "name": "aemcareb3de09",
                                    "source": [
                                        {
                                            "context": "a",
                                            "element": "value",
                                            "variable": "val"
                                        }
                                    ],
                                    "target": [
                                        {
                                            "context": "tgt",
                                            "contextType": "variable",
                                            "element": "extension",
                                            "variable": "ext",
                                            "transform": "create",
                                            "parameter": [
                                                {
                                                    "valueString": "Extension"
                                                }
                                            ]
                                        },
                                        {
                                            "context": "ext",
                                            "contextType": "variable",
                                            "element": "url",
                                            "transform": "copy",
                                            "parameter": [
                                                {
                                                    "valueString": "https://fhir.dk.swisstph-mis.ch/matchbox/fhir/StructureDefinition/refered"
                                                }
                                            ]
                                        },
                                        {
                                            "context": "ext",
                                            "contextType": "variable",
                                            "element": "value",
                                            "transform": "copy",
                                            "parameter": [
                                                {
                                                    "valueId": "val"
                                                }
                                            ]
                                        }
                                    ]
                                }
                            ]
                        }
                    ]
                }
            ]
        },
        {
            "name": "getIdemcareencounter",
            "typeMode": "none",
            "input": [
                {
                    "name": "src",
                    "mode": "source"
                },
                {
                    "name": "tgt",
                    "mode": "target"
                }
            ],
            "rule": [
                {
                    "name": "269afe68",
                    "source": [
                        {
                            "context": "src",
                            "element": "item",
                            "listMode": "first",
                            "variable": "item",
                            "condition": "linkId = 'emcareencounterid'"
                        }
                    ],
                    "target": [
                        {
                            "contextType": "variable",
                            "transform": "copy",
                            "parameter": [
                                {
                                    "valueId": "tgt"
                                }
                            ]
                        }
                    ],
                    "rule": [
                        {
                            "name": "f3550c0d",
                            "source": [
                                {
                                    "context": "item",
                                    "element": "answer",
                                    "listMode": "first",
                                    "variable": "a"
                                }
                            ],
                            "target": [
                                {
                                    "contextType": "variable",
                                    "transform": "copy",
                                    "parameter": [
                                        {
                                            "valueId": "tgt"
                                        }
                                    ]
                                }
                            ],
                            "rule": [
                                {
                                    "name": "8e3eaf71",
                                    "source": [
                                        {
                                            "context": "a",
                                            "element": "value",
                                            "variable": "val"
                                        }
                                    ],
                                    "target": [
                                        {
                                            "context": "tgt",
                                            "contextType": "variable",
                                            "element": "id",
                                            "transform": "copy",
                                            "parameter": [
                                                {
                                                    "valueId": "val"
                                                }
                                            ]
                                        }
                                    ]
                                }
                            ]
                        }
                    ]
                }
            ]
        },
        {
            "name": "getFullUrlemcareencounter",
            "typeMode": "none",
            "input": [
                {
                    "name": "src",
                    "mode": "source"
                },
                {
                    "name": "tgt",
                    "mode": "target"
                }
            ],
            "rule": [
                {
                    "name": "d383794d",
                    "source": [
                        {
                            "context": "src",
                            "element": "item",
                            "listMode": "first",
                            "variable": "item",
                            "condition": "linkId = 'emcareencounterid'"
                        }
                    ],
                    "target": [
                        {
                            "contextType": "variable",
                            "transform": "copy",
                            "parameter": [
                                {
                                    "valueId": "tgt"
                                }
                            ]
                        }
                    ],
                    "rule": [
                        {
                            "name": "8a0f6df2",
                            "source": [
                                {
                                    "context": "item",
                                    "element": "answer",
                                    "listMode": "first",
                                    "variable": "a"
                                }
                            ],
                            "target": [
                                {
                                    "contextType": "variable",
                                    "transform": "copy",
                                    "parameter": [
                                        {
                                            "valueId": "tgt"
                                        }
                                    ]
                                }
                            ],
                            "rule": [
                                {
                                    "name": "a6735326",
                                    "source": [
                                        {
                                            "context": "a",
                                            "element": "value",
                                            "variable": "val"
                                        }
                                    ],
                                    "target": [
                                        {
                                            "context": "tgt",
                                            "contextType": "variable",
                                            "element": "fullUrl",
                                            "transform": "append",
                                            "parameter": [
                                                {
                                                    "valueString": "urn:uuid:"
                                                },
                                                {
                                                    "valueId": "val"
                                                }
                                            ]
                                        }
                                    ]
                                }
                            ]
                        }
                    ]
                }
            ]
        },
        {
            "name": "getUrlemcareencounter",
            "typeMode": "none",
            "input": [
                {
                    "name": "src",
                    "mode": "source"
                },
                {
                    "name": "tgt",
                    "mode": "target"
                }
            ],
            "rule": [
                {
                    "name": "558d60eb",
                    "source": [
                        {
                            "context": "src",
                            "element": "item",
                            "listMode": "first",
                            "variable": "item",
                            "condition": "linkId = 'emcareencounterid'"
                        }
                    ],
                    "target": [
                        {
                            "contextType": "variable",
                            "transform": "copy",
                            "parameter": [
                                {
                                    "valueId": "tgt"
                                }
                            ]
                        }
                    ],
                    "rule": [
                        {
                            "name": "35ea1ad7",
                            "source": [
                                {
                                    "context": "item",
                                    "element": "answer",
                                    "listMode": "first",
                                    "variable": "a"
                                }
                            ],
                            "target": [
                                {
                                    "contextType": "variable",
                                    "transform": "copy",
                                    "parameter": [
                                        {
                                            "valueId": "tgt"
                                        }
                                    ]
                                }
                            ],
                            "rule": [
                                {
                                    "name": "e8494603",
                                    "source": [
                                        {
                                            "context": "a",
                                            "element": "value",
                                            "variable": "val"
                                        }
                                    ],
                                    "target": [
                                        {
                                            "context": "ref",
                                            "contextType": "variable",
                                            "element": "reference",
                                            "transform": "append",
                                            "parameter": [
                                                {
                                                    "valueString": "/Encounter/"
                                                },
                                                {
                                                    "valueId": "val"
                                                }
                                            ]
                                        }
                                    ]
                                }
                            ]
                        }
                    ]
                }
            ]
        },
        {
            "name": "emcarerelatedpersonaccompanying",
            "typeMode": "none",
            "input": [
                {
                    "name": "src",
                    "type": "questionnaireResponse",
                    "mode": "source"
                },
                {
                    "name": "tgt",
                    "type": "RelatedPerson",
                    "mode": "target"
                }
            ],
            "rule": [
                {
                    "name": "d100c750",
                    "source": [
                        {
                            "context": "src",
                            "element": "item",
                            "listMode": "first",
                            "variable": "itm1",
                            "condition": "linkId = 'EmCare.A.DE49.1'"
                        }
                    ],
                    "rule": [
                        {
                            "name": "e7f1578a",
                            "source": [
                                {
                                    "context": "itm1",
                                    "element": "item",
                                    "listMode": "first",
                                    "variable": "item",
                                    "condition": "(linkId = 'EmCare.A.DE41') or (linkId = 'EmCare.A.DE40')"
                                }
                            ],
                            "rule": [
                                {
                                    "name": "3810df8b",
                                    "source": [
                                        {
                                            "context": "src"
                                        }
                                    ],
                                    "target": [
                                        {
                                            "contextType": "variable",
                                            "variable": "target",
                                            "transform": "copy",
                                            "parameter": [
                                                {
                                                    "valueId": "tgt"
                                                }
                                            ]
                                        },
                                        {
                                            "context": "target",
                                            "contextType": "variable",
                                            "element": "name",
                                            "variable": "name"
                                        }
                                    ],
                                    "dependent": [
                                        {
                                            "name": "SetOfficalGivenNameemcarerelatedpersonaccompanying",
                                            "variable": [
                                                "src",
                                                "name"
                                            ]
                                        }
                                    ]
                                }
                            ]
                        }
                    ]
                },
                {
                    "name": "a5efce09",
                    "source": [
                        {
                            "context": "src",
                            "element": "item",
                            "listMode": "first",
                            "variable": "itm1",
                            "condition": "linkId = 'EmCare.A.DE49.1'"
                        }
                    ],
                    "rule": [
                        {
                            "name": "15fc0694",
                            "source": [
                                {
                                    "context": "itm1",
                                    "element": "item",
                                    "listMode": "first",
                                    "variable": "item",
                                    "condition": "linkId = 'EmCare.A.DE41'"
                                }
                            ],
                            "rule": [
                                {
                                    "name": "aemcareade41",
                                    "source": [
                                        {
                                            "context": "item",
                                            "element": "answer",
                                            "listMode": "first",
                                            "variable": "a"
                                        }
                                    ],
                                    "rule": [
                                        {
                                            "name": "aemcareade41",
                                            "source": [
                                                {
                                                    "context": "a",
                                                    "element": "value",
                                                    "variable": "val"
                                                }
                                            ],
                                            "target": [
                                                {
                                                    "context": "tgt",
                                                    "contextType": "variable",
                                                    "element": "telecom",
                                                    "variable": "tel"
                                                },
                                                {
                                                    "context": "tel",
                                                    "contextType": "variable",
                                                    "element": "system",
                                                    "transform": "copy",
                                                    "parameter": [
                                                        {
                                                            "valueString": "phone"
                                                        }
                                                    ]
                                                },
                                                {
                                                    "context": "tel",
                                                    "contextType": "variable",
                                                    "element": "use",
                                                    "transform": "copy",
                                                    "parameter": [
                                                        {
                                                            "valueString": "mobile"
                                                        }
                                                    ]
                                                },
                                                {
                                                    "context": "tel",
                                                    "contextType": "variable",
                                                    "element": "value",
                                                    "transform": "copy",
                                                    "parameter": [
                                                        {
                                                            "valueId": "val"
                                                        }
                                                    ]
                                                }
                                            ]
                                        }
                                    ]
                                }
                            ]
                        }
                    ]
                },
                {
                    "name": "47d8f6d5",
                    "source": [
                        {
                            "context": "src",
                            "element": "item",
                            "listMode": "first",
                            "variable": "itm1",
                            "condition": "linkId = 'EmCare.A.DE49.1'"
                        }
                    ],
                    "rule": [
                        {
                            "name": "f30fad52",
                            "source": [
                                {
                                    "context": "itm1",
                                    "element": "item",
                                    "listMode": "first",
                                    "variable": "item",
                                    "condition": "linkId = 'EmCare.A.DE43'"
                                }
                            ],
                            "rule": [
                                {
                                    "name": "0118f802",
                                    "source": [
                                        {
                                            "context": "item",
                                            "element": "answer",
                                            "listMode": "first",
                                            "variable": "a"
                                        }
                                    ],
                                    "dependent": [
                                        {
                                            "name": "MapValueSetExtCodeemcareade43",
                                            "variable": [
                                                "a",
                                                "tgt"
                                            ]
                                        }
                                    ]
                                }
                            ]
                        }
                    ]
                }
            ]
        },
        {
            "name": "SetOfficalGivenNameemcarerelatedpersonaccompanying",
            "typeMode": "none",
            "input": [
                {
                    "name": "src",
                    "mode": "source"
                },
                {
                    "name": "tgt",
                    "mode": "target"
                }
            ],
            "rule": [
                {
                    "name": "226010d3",
                    "source": [
                        {
                            "context": "src"
                        }
                    ],
                    "target": [
                        {
                            "context": "tgt",
                            "contextType": "variable",
                            "element": "use",
                            "transform": "copy",
                            "parameter": [
                                {
                                    "valueString": "official"
                                }
                            ]
                        }
                    ],
                    "rule": [
                        {
                            "name": "d7e96bf2",
                            "source": [
                                {
                                    "context": "src",
                                    "element": "item",
                                    "listMode": "first",
                                    "variable": "itm1",
                                    "condition": "linkId = 'EmCare.A.DE49.1'"
                                }
                            ],
                            "rule": [
                                {
                                    "name": "ff55696b",
                                    "source": [
                                        {
                                            "context": "itm1",
                                            "element": "item",
                                            "listMode": "first",
                                            "variable": "item",
                                            "condition": "linkId = 'EmCare.A.DE41'"
                                        }
                                    ],
                                    "rule": [
                                        {
                                            "name": "e0827d5d",
                                            "source": [
                                                {
                                                    "context": "item",
                                                    "element": "answer",
                                                    "listMode": "first",
                                                    "variable": "a"
                                                }
                                            ],
                                            "rule": [
                                                {
                                                    "name": "77d1bd4f",
                                                    "source": [
                                                        {
                                                            "context": "a",
                                                            "element": "value",
                                                            "variable": "val"
                                                        }
                                                    ],
                                                    "target": [
                                                        {
                                                            "context": "tgt",
                                                            "contextType": "variable",
                                                            "element": "family",
                                                            "transform": "copy",
                                                            "parameter": [
                                                                {
                                                                    "valueId": "val"
                                                                }
                                                            ]
                                                        }
                                                    ]
                                                }
                                            ]
                                        }
                                    ]
                                }
                            ]
                        },
                        {
                            "name": "f3fd65b0",
                            "source": [
                                {
                                    "context": "src",
                                    "element": "item",
                                    "listMode": "first",
                                    "variable": "itm1",
                                    "condition": "linkId = 'EmCare.A.DE49.1'"
                                }
                            ],
                            "rule": [
                                {
                                    "name": "e84a0f31",
                                    "source": [
                                        {
                                            "context": "itm1",
                                            "element": "item",
                                            "listMode": "first",
                                            "variable": "item",
                                            "condition": "linkId = 'EmCare.A.DE40'"
                                        }
                                    ],
                                    "rule": [
                                        {
                                            "name": "18edd234",
                                            "source": [
                                                {
                                                    "context": "item",
                                                    "element": "answer",
                                                    "listMode": "first",
                                                    "variable": "a"
                                                }
                                            ],
                                            "rule": [
                                                {
                                                    "name": "5d3d44f6",
                                                    "source": [
                                                        {
                                                            "context": "a",
                                                            "element": "value",
                                                            "variable": "val"
                                                        }
                                                    ],
                                                    "target": [
                                                        {
                                                            "context": "tgt",
                                                            "contextType": "variable",
                                                            "element": "given",
                                                            "transform": "copy",
                                                            "parameter": [
                                                                {
                                                                    "valueId": "val"
                                                                }
                                                            ]
                                                        }
                                                    ]
                                                }
                                            ]
                                        }
                                    ]
                                }
                            ]
                        }
                    ]
                }
            ]
        },
        {
            "name": "MapValueSetExtCodeemcareade43",
            "typeMode": "none",
            "input": [
                {
                    "name": "src",
                    "mode": "source"
                },
                {
                    "name": "tgt",
                    "mode": "target"
                }
            ],
            "rule": [
                {
                    "name": "1b7b6d7a",
                    "source": [
                        {
                            "context": "src"
                        }
                    ],
                    "target": [
                        {
                            "contextType": "variable",
                            "transform": "copy",
                            "parameter": [
                                {
                                    "valueId": "tgt"
                                }
                            ]
                        }
                    ],
                    "rule": [
                        {
                            "name": "4a251df5",
                            "source": [
                                {
                                    "context": "src"
                                }
                            ],
                            "target": [
                                {
                                    "context": "tgt",
                                    "contextType": "variable",
                                    "element": "relationship",
                                    "variable": "cc",
                                    "transform": "create",
                                    "parameter": [
                                        {
                                            "valueString": "CodeableConcept"
                                        }
                                    ]
                                },
                                {
                                    "context": "cc",
                                    "contextType": "variable",
                                    "element": "coding",
                                    "variable": "coding",
                                    "transform": "create",
                                    "parameter": [
                                        {
                                            "valueString": "Coding"
                                        }
                                    ]
                                }
                            ],
                            "rule": [
                                {
                                    "name": "abd34a78",
                                    "source": [
                                        {
                                            "context": "src",
                                            "condition": "value.code = 'EmCare.A.DE25'"
                                        }
                                    ],
                                    "target": [
                                        {
                                            "context": "coding",
                                            "contextType": "variable",
                                            "element": "code",
                                            "transform": "copy",
                                            "parameter": [
                                                {
                                                    "valueString": "MTH"
                                                }
                                            ]
                                        },
                                        {
                                            "context": "coding",
                                            "contextType": "variable",
                                            "element": "system",
                                            "transform": "copy",
                                            "parameter": [
                                                {
                                                    "valueString": "http://terminology.hl7.org/CodeSystem/v3-RoleCode"
                                                }
                                            ]
                                        }
                                    ]
                                },
                                {
                                    "name": "b53d1d15",
                                    "source": [
                                        {
                                            "context": "src",
                                            "condition": "value.code = 'EmCare.A.DE26'"
                                        }
                                    ],
                                    "target": [
                                        {
                                            "context": "coding",
                                            "contextType": "variable",
                                            "element": "code",
                                            "transform": "copy",
                                            "parameter": [
                                                {
                                                    "valueString": "FTH"
                                                }
                                            ]
                                        },
                                        {
                                            "context": "coding",
                                            "contextType": "variable",
                                            "element": "system",
                                            "transform": "copy",
                                            "parameter": [
                                                {
                                                    "valueString": "http://terminology.hl7.org/CodeSystem/v3-RoleCode"
                                                }
                                            ]
                                        }
                                    ]
                                },
                                {
                                    "name": "949ee35f",
                                    "source": [
                                        {
                                            "context": "src",
                                            "condition": "value.code = 'EmCare.A.DE27'"
                                        }
                                    ],
                                    "target": [
                                        {
                                            "context": "coding",
                                            "contextType": "variable",
                                            "element": "code",
                                            "transform": "copy",
                                            "parameter": [
                                                {
                                                    "valueString": "SIB"
                                                }
                                            ]
                                        },
                                        {
                                            "context": "coding",
                                            "contextType": "variable",
                                            "element": "system",
                                            "transform": "copy",
                                            "parameter": [
                                                {
                                                    "valueString": "http://terminology.hl7.org/CodeSystem/v3-RoleCode"
                                                }
                                            ]
                                        }
                                    ]
                                },
                                {
                                    "name": "7c5a4400",
                                    "source": [
                                        {
                                            "context": "src",
                                            "condition": "value.code = 'EmCare.A.DE28'"
                                        }
                                    ],
                                    "target": [
                                        {
                                            "context": "coding",
                                            "contextType": "variable",
                                            "element": "code",
                                            "transform": "copy",
                                            "parameter": [
                                                {
                                                    "valueString": "EXT"
                                                }
                                            ]
                                        },
                                        {
                                            "context": "coding",
                                            "contextType": "variable",
                                            "element": "system",
                                            "transform": "copy",
                                            "parameter": [
                                                {
                                                    "valueString": "http://terminology.hl7.org/CodeSystem/v3-RoleCode"
                                                }
                                            ]
                                        }
                                    ]
                                },
                                {
                                    "name": "544df0cc",
                                    "source": [
                                        {
                                            "context": "src",
                                            "condition": "value.code = 'EmCare.A.DE29'"
                                        }
                                    ],
                                    "target": [
                                        {
                                            "context": "coding",
                                            "contextType": "variable",
                                            "element": "code",
                                            "transform": "copy",
                                            "parameter": [
                                                {
                                                    "valueString": "PRNINLAW"
                                                }
                                            ]
                                        },
                                        {
                                            "context": "coding",
                                            "contextType": "variable",
                                            "element": "system",
                                            "transform": "copy",
                                            "parameter": [
                                                {
                                                    "valueString": "http://terminology.hl7.org/CodeSystem/v3-RoleCode"
                                                }
                                            ]
                                        }
                                    ]
                                },
                                {
                                    "name": "8c2d96fc",
                                    "source": [
                                        {
                                            "context": "src",
                                            "condition": "value.code = 'EmCare.A.DE30'"
                                        }
                                    ],
                                    "target": [
                                        {
                                            "context": "coding",
                                            "contextType": "variable",
                                            "element": "code",
                                            "transform": "copy",
                                            "parameter": [
                                                {
                                                    "valueString": "U"
                                                }
                                            ]
                                        },
                                        {
                                            "context": "coding",
                                            "contextType": "variable",
                                            "element": "system",
                                            "transform": "copy",
                                            "parameter": [
                                                {
                                                    "valueString": "http://terminology.hl7.org/CodeSystem/v2-0131"
                                                }
                                            ]
                                        }
                                    ]
                                }
                            ]
                        }
                    ]
                }
            ]
        },
        {
            "name": "getIdemcarerelatedpersonaccompanying",
            "typeMode": "none",
            "input": [
                {
                    "name": "src",
                    "mode": "source"
                },
                {
                    "name": "tgt",
                    "mode": "target"
                }
            ],
            "rule": [
                {
                    "name": "c20a932d",
                    "source": [
                        {
                            "context": "src",
                            "element": "item",
                            "listMode": "first",
                            "variable": "item",
                            "condition": "linkId = 'emcarerelatedpersonaccompanyingid'"
                        }
                    ],
                    "target": [
                        {
                            "contextType": "variable",
                            "transform": "copy",
                            "parameter": [
                                {
                                    "valueId": "tgt"
                                }
                            ]
                        }
                    ],
                    "rule": [
                        {
                            "name": "f3550c0d",
                            "source": [
                                {
                                    "context": "item",
                                    "element": "answer",
                                    "listMode": "first",
                                    "variable": "a"
                                }
                            ],
                            "target": [
                                {
                                    "contextType": "variable",
                                    "transform": "copy",
                                    "parameter": [
                                        {
                                            "valueId": "tgt"
                                        }
                                    ]
                                }
                            ],
                            "rule": [
                                {
                                    "name": "8e3eaf71",
                                    "source": [
                                        {
                                            "context": "a",
                                            "element": "value",
                                            "variable": "val"
                                        }
                                    ],
                                    "target": [
                                        {
                                            "context": "tgt",
                                            "contextType": "variable",
                                            "element": "id",
                                            "transform": "copy",
                                            "parameter": [
                                                {
                                                    "valueId": "val"
                                                }
                                            ]
                                        }
                                    ]
                                }
                            ]
                        }
                    ]
                }
            ]
        },
        {
            "name": "getFullUrlemcarerelatedpersonaccompanying",
            "typeMode": "none",
            "input": [
                {
                    "name": "src",
                    "mode": "source"
                },
                {
                    "name": "tgt",
                    "mode": "target"
                }
            ],
            "rule": [
                {
                    "name": "c5f52a0f",
                    "source": [
                        {
                            "context": "src",
                            "element": "item",
                            "listMode": "first",
                            "variable": "item",
                            "condition": "linkId = 'emcarerelatedpersonaccompanyingid'"
                        }
                    ],
                    "target": [
                        {
                            "contextType": "variable",
                            "transform": "copy",
                            "parameter": [
                                {
                                    "valueId": "tgt"
                                }
                            ]
                        }
                    ],
                    "rule": [
                        {
                            "name": "8a0f6df2",
                            "source": [
                                {
                                    "context": "item",
                                    "element": "answer",
                                    "listMode": "first",
                                    "variable": "a"
                                }
                            ],
                            "target": [
                                {
                                    "contextType": "variable",
                                    "transform": "copy",
                                    "parameter": [
                                        {
                                            "valueId": "tgt"
                                        }
                                    ]
                                }
                            ],
                            "rule": [
                                {
                                    "name": "a6735326",
                                    "source": [
                                        {
                                            "context": "a",
                                            "element": "value",
                                            "variable": "val"
                                        }
                                    ],
                                    "target": [
                                        {
                                            "context": "tgt",
                                            "contextType": "variable",
                                            "element": "fullUrl",
                                            "transform": "append",
                                            "parameter": [
                                                {
                                                    "valueString": "urn:uuid:"
                                                },
                                                {
                                                    "valueId": "val"
                                                }
                                            ]
                                        }
                                    ]
                                }
                            ]
                        }
                    ]
                }
            ]
        },
        {
            "name": "getUrlemcarerelatedpersonaccompanying",
            "typeMode": "none",
            "input": [
                {
                    "name": "src",
                    "mode": "source"
                },
                {
                    "name": "tgt",
                    "mode": "target"
                }
            ],
            "rule": [
                {
                    "name": "6aace494",
                    "source": [
                        {
                            "context": "src",
                            "element": "item",
                            "listMode": "first",
                            "variable": "item",
                            "condition": "linkId = 'emcarerelatedpersonaccompanyingid'"
                        }
                    ],
                    "target": [
                        {
                            "contextType": "variable",
                            "transform": "copy",
                            "parameter": [
                                {
                                    "valueId": "tgt"
                                }
                            ]
                        }
                    ],
                    "rule": [
                        {
                            "name": "00b2016a",
                            "source": [
                                {
                                    "context": "item",
                                    "element": "answer",
                                    "listMode": "first",
                                    "variable": "a"
                                }
                            ],
                            "target": [
                                {
                                    "contextType": "variable",
                                    "transform": "copy",
                                    "parameter": [
                                        {
                                            "valueId": "tgt"
                                        }
                                    ]
                                }
                            ],
                            "rule": [
                                {
                                    "name": "25b16148",
                                    "source": [
                                        {
                                            "context": "a",
                                            "element": "value",
                                            "variable": "val"
                                        }
                                    ],
                                    "target": [
                                        {
                                            "context": "ref",
                                            "contextType": "variable",
                                            "element": "reference",
                                            "transform": "append",
                                            "parameter": [
                                                {
                                                    "valueString": "/RelatedPerson/"
                                                },
                                                {
                                                    "valueId": "val"
                                                }
                                            ]
                                        }
                                    ]
                                }
                            ]
                        }
                    ]
                }
            ]
        },
        {
            "name": "emcareobservationemcareb3de05",
            "typeMode": "none",
            "input": [
                {
                    "name": "src",
                    "mode": "source"
                },
                {
                    "name": "tgt",
                    "mode": "target"
                }
            ],
            "rule": [
                {
                    "name": "id-emcareb3de05",
                    "source": [
                        {
                            "context": "src"
                        }
                    ],
                    "target": [
                        {
                            "context": "tgt",
                            "contextType": "variable",
                            "element": "identifier",
                            "variable": "CodeID",
                            "transform": "create",
                            "parameter": [
                                {
                                    "valueString": "Identifier"
                                }
                            ]
                        },
                        {
                            "context": "CodeID",
                            "contextType": "variable",
                            "element": "system",
                            "transform": "copy",
                            "parameter": [
                                {
                                    "valueString": "http://hl7.org/fhir/namingsystem-identifier-type"
                                }
                            ]
                        },
                        {
                            "context": "CodeID",
                            "contextType": "variable",
                            "element": "use",
                            "transform": "copy",
                            "parameter": [
                                {
                                    "valueString": "official"
                                }
                            ]
                        },
                        {
                            "context": "CodeID",
                            "contextType": "variable",
                            "element": "value",
                            "transform": "copy",
                            "parameter": [
                                {
                                    "valueString": "uuid"
                                }
                            ]
                        },
                        {
                            "context": "CodeID",
                            "contextType": "variable",
                            "element": "id",
                            "transform": "uuid"
                        }
                    ]
                },
                {
                    "name": "35bc6b82",
                    "source": [
                        {
                            "context": "src",
                            "element": "encounter",
                            "variable": "encounter"
                        }
                    ],
                    "target": [
                        {
                            "context": "tgt",
                            "contextType": "variable",
                            "element": "encounter",
                            "transform": "copy",
                            "parameter": [
                                {
                                    "valueId": "encounter"
                                }
                            ]
                        }
                    ]
                },
                {
                    "name": "code-emcareb3de05",
                    "source": [
                        {
                            "context": "src",
                            "element": "subject",
                            "variable": "subject"
                        }
                    ],
                    "target": [
                        {
                            "context": "tgt",
                            "contextType": "variable",
                            "element": "subject",
                            "transform": "copy",
                            "parameter": [
                                {
                                    "valueId": "subject"
                                }
                            ]
                        },
                        {
                            "context": "tgt",
                            "contextType": "variable",
                            "element": "meta",
                            "variable": "newMeta",
                            "transform": "create",
                            "parameter": [
                                {
                                    "valueString": "Meta"
                                }
                            ]
                        },
                        {
                            "context": "newMeta",
                            "contextType": "variable",
                            "element": "profile",
                            "transform": "copy",
                            "parameter": [
                                {
                                    "valueString": "https://fhir.dk.swisstph-mis.ch/matchbox/fhir/StructureDefinition/emcareobservation"
                                }
                            ]
                        },
                        {
                            "context": "tgt",
                            "contextType": "variable",
                            "element": "code",
                            "variable": "concept",
                            "transform": "create",
                            "parameter": [
                                {
                                    "valueString": "CodeableConcept"
                                }
                            ]
                        },
                        {
                            "context": "concept",
                            "contextType": "variable",
                            "element": "coding",
                            "variable": "coding",
                            "transform": "create",
                            "parameter": [
                                {
                                    "valueString": "Coding"
                                }
                            ]
                        },
                        {
                            "context": "coding",
                            "contextType": "variable",
                            "element": "system",
                            "transform": "copy",
                            "parameter": [
                                {
                                    "valueString": "https://fhir.dk.swisstph-mis.ch/matchbox/fhir/CodeSystem/emcare-custom-codes"
                                }
                            ]
                        },
                        {
                            "context": "coding",
                            "contextType": "variable",
                            "element": "code",
                            "transform": "copy",
                            "parameter": [
                                {
                                    "valueString": "EmCare.B3.DE05"
                                }
                            ]
                        }
                    ]
                },
                {
                    "name": "f4472f32",
                    "source": [
                        {
                            "context": "src",
                            "element": "item",
                            "variable": "item",
                            "condition": "linkId = 'timestamp'"
                        }
                    ],
                    "rule": [
                        {
                            "name": "4272fc8b",
                            "source": [
                                {
                                    "context": "item",
                                    "element": "answer",
                                    "listMode": "first",
                                    "variable": "a"
                                }
                            ],
                            "rule": [
                                {
                                    "name": "8945c96b",
                                    "source": [
                                        {
                                            "context": "a",
                                            "element": "value",
                                            "variable": "val"
                                        }
                                    ],
                                    "target": [
                                        {
                                            "context": "tgt",
                                            "contextType": "variable",
                                            "element": "issued",
                                            "transform": "copy",
                                            "parameter": [
                                                {
                                                    "valueId": "val"
                                                }
                                            ]
                                        }
                                    ]
                                }
                            ]
                        }
                    ]
                },
                {
                    "name": "patient",
                    "source": [
                        {
                            "context": "src",
                            "element": "subject",
                            "variable": "subject"
                        }
                    ],
                    "target": [
                        {
                            "context": "tgt",
                            "contextType": "variable",
                            "element": "subject",
                            "transform": "copy",
                            "parameter": [
                                {
                                    "valueId": "subject"
                                }
                            ]
                        }
                    ]
                },
                {
                    "name": "8bf2988b",
                    "source": [
                        {
                            "context": "src",
                            "element": "item",
                            "listMode": "first",
                            "variable": "item",
                            "condition": "linkId = 'EmCare.B3.DE05'"
                        }
                    ],
                    "rule": [
                        {
                            "name": "bdab9370",
                            "source": [
                                {
                                    "context": "item",
                                    "element": "answer",
                                    "listMode": "first",
                                    "variable": "a"
                                }
                            ],
                            "rule": [
                                {
                                    "name": "final-emcareb3de05",
                                    "source": [
                                        {
                                            "context": "a",
                                            "condition": "a.value = true"
                                        }
                                    ],
                                    "target": [
                                        {
                                            "context": "tgt",
                                            "contextType": "variable",
                                            "element": "status",
                                            "transform": "copy",
                                            "parameter": [
                                                {
                                                    "valueString": "final"
                                                }
                                            ]
                                        },
                                        {
                                            "context": "tgt",
                                            "contextType": "variable",
                                            "element": "value",
                                            "transform": "copy",
                                            "parameter": [
                                                {
                                                    "valueBoolean": true
                                                }
                                            ]
                                        }
                                    ]
                                },
                                {
                                    "name": "notfound-emcareb3de05",
                                    "source": [
                                        {
                                            "context": "a",
                                            "condition": "a.value = false"
                                        }
                                    ],
                                    "target": [
                                        {
                                            "context": "tgt",
                                            "contextType": "variable",
                                            "element": "status",
                                            "transform": "copy",
                                            "parameter": [
                                                {
                                                    "valueString": "cancelled"
                                                }
                                            ]
                                        },
                                        {
                                            "context": "tgt",
                                            "contextType": "variable",
                                            "element": "value",
                                            "transform": "copy",
                                            "parameter": [
                                                {
                                                    "valueBoolean": false
                                                }
                                            ]
                                        }
                                    ]
                                }
                            ]
                        }
                    ]
                }
            ]
        }
    ]
}