map 'https://fhir.dk.swisstph-mis.ch/matchbox/fhir//StructureMap/structuremap-emcare-relatedperson--emcareb.registration.e' = 'emcare-relatedperson--EmCareB.Registration.E'

uses 'https://fhir.dk.swisstph-mis.ch/matchbox/fhir//Questionnaire/questionnaire-emcareb.registration.e' alias 'emcareb.registration.e' as source
uses 'https://fhir.dk.swisstph-mis.ch/matchbox/fhir//Profile/profile-emcare-relatedperson-' alias 'emcare-relatedperson-' as target
group  main(
	source qr : 'emcareb.registration.e',
	target tgt : 'emcare-relatedperson-'
) {
	qr.item as item then {
		item.answer first where item.linkId = 'EmCare.A.DE40' as a then { a -> tgt.name.given[0] = a 'EmCare.A.DE40-1'; } 'EmCare.A.DE40';
		item.answer first where item.linkId = 'EmCare.A.DE41' as a then { a -> tgt.name.family = a 'EmCare.A.DE41-1'; } 'EmCare.A.DE41';
		item.answer first where item.linkId = 'EmCare.A.DE42' as a then { tgt.telecom as tel then {  a -> tel.system = 'http://hl7.org/fhir/contact-point-system#phone', tel.use = translate('{{cs_url}}', 'telecom-use', 'http://hl7.org/fhir/contact-point-use'), tel.value = a 'phone-1';}  'EmCare.A.DE42-1'; } 'EmCare.A.DE42';
		item.answer first where item.linkId = 'EmCare.A.DE43' as a then { a where a= 'EmCare.A.DE30' then {a-> tgt.relationship =  translate(a, 'relationship-to-client', 'http://terminology.hl7.org/CodeSystem/v2-0131') 'person accomp' ;} 'intenal code';
a where a != 'EmCare.A.DE30' then {a-> tgt.relationship =  translate(a, 'relationship-to-client', 'http://terminology.hl7.org/CodeSystem/v3-RoleCode')  'person accomp unkown' ;} 'EmCare.A.DE43-1'; } 'EmCare.A.DE43';
	} 'itemsemcareb.registration.e-emcare-relatedperson-';
} 

