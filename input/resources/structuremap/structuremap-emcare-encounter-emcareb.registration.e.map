map 'https://test.ahdis.ch/matchbox/fhir/StructureMap/structuremap-emcare-encounter-emcareb.registration.e' = 'emcare-encounter-EmCareB.Registration.E'

uses 'https://test.ahdis.ch/matchbox/fhir/Questionnaire/questionnaire-emcareb.registration.e' alias 'emcareb.registration.e' as source
uses 'https://test.ahdis.ch/matchbox/fhir/Profile/profile-emcare-encounter' alias 'emcare-encounter' as target
group  main(
	source qr : 'emcareb.registration.e',
	target tgt : 'emcare-encounter'
) {
	qr.item as item then {
		item.answer first as a where item.linkId = 'EmCare.A.DE44'  then { tgt.participant as participant then { a -> participant.individual = a "set-participant";} 'EmCare.A.DE44-1'; } 'EmCare.A.DE44';
		item.answer first as a where item.linkId = 'EmCare.B2.DE01'  then { a -> tgt.type = a 'EmCare.B2.DE01-1'; } 'EmCare.B2.DE01';
		item.answer first as a where item.linkId = 'EmCare.B3.DE01'  then { a -> tgt.reasonCode = a 'EmCare.B3.DE01-1'; } 'EmCare.B3.DE01';
		item.answer first as a where item.linkId = 'EmCare.B3.DE06'  then { a -> tgt.type = a 'EmCare.B3.DE06-1'; } 'EmCare.B3.DE06';
		item.answer first as a where item.linkId = 'EmCare.B3.DE09'  then { tgt.extension as ext where ext.url ='https://test.ahdis.ch/matchbox/fhir/Extension/refered'  then {a -> ext.valueBoolean = a 'set-bool';} 'EmCare.B3.DE09-1'; } 'EmCare.B3.DE09';
	} 'itemsemcareb.registration.e-emcare-encounter';
} 

