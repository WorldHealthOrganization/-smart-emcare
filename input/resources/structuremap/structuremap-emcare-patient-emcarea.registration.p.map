map 'https://fhir.dk.swisstph-mis.ch/matchbox/fhir//StructureMap/structuremap-emcare-patient-emcarea.registration.p' = 'emcare-patient-EmCareA.Registration.P'

uses 'https://fhir.dk.swisstph-mis.ch/matchbox/fhir//Questionnaire/questionnaire-emcarea.registration.p' alias 'emcarea.registration.p' as source
uses 'https://fhir.dk.swisstph-mis.ch/matchbox/fhir//Profile/profile-emcare-patient' alias 'emcare-patient' as target
group  main(
	source qr : 'emcarea.registration.p',
	target tgt : 'emcare-patient'
) {
	qr.item as item then {
		item.answer first where item.linkId = 'EmCare.A.DE01' as a then { tgt.identifier as id then {  a -> id.type = '{{cs_url}}', id.value = a 'uid-1';}  'EmCare.A.DE01-1'; } 'EmCare.A.DE01';
		item.answer first where item.linkId = 'EmCare.A.DE02' as a then { tgt.identifier as id then {  a -> id.type = '{{cs_url}}', id.value = a 'uid-1';}  'EmCare.A.DE02-1'; } 'EmCare.A.DE02';
		item.answer first where item.linkId = 'EmCare.A.DE03' as a then { tgt.identifier as id then {  a -> id.type = '{{cs_url}}' 'noid';}  'EmCare.A.DE03-1'; } 'EmCare.A.DE03';
		item.answer first where item.linkId = 'EmCare.A.DE04' as a then { a -> tgt.name.given[0] = a 'EmCare.A.DE04-1'; } 'EmCare.A.DE04';
		item.answer first where item.linkId = 'EmCare.A.DE05' as a then { a -> tgt.name.given[1] = a 'EmCare.A.DE05-1'; } 'EmCare.A.DE05';
		item.answer first where item.linkId = 'EmCare.A.DE06' as a then { a -> tgt.name.family = a 'EmCare.A.DE06-1'; } 'EmCare.A.DE06';
		item.answer first where item.linkId = 'EmCare.A.DE08' as a then { a -> tgt.birthDate = a 'EmCare.A.DE08-1'; } 'EmCare.A.DE08';
		item.answer first where item.linkId = 'EmCare.A.DE09' as a then { a -> tgt.extension.birthTime = a 'EmCare.A.DE09-1'; } 'EmCare.A.DE09';
		item.answer first where item.linkId = 'EmCare.A.DE12' as a then { a -> tgt.extension.birthDateEstimator = a 'EmCare.A.DE12-1'; } 'EmCare.A.DE12';
		item.answer first where item.linkId = 'EmCare.A.DE16' as a then { a -> tgt.gender = translate(a, 'sex-of-the-client', 'http://hl7.org/fhir/administrative-gender') 'EmCare.A.DE16-1'; } 'EmCare.A.DE16';
		item.answer first where item.linkId = 'EmCare.A.DE20' as a then { a -> tgt.address.text = a 'EmCare.A.DE20-1'; } 'EmCare.A.DE20';
		item.answer first where item.linkId = 'EmCare.A.DE47' as a then { a -> tgt.contact.extension.caregiver = a 'EmCare.A.DE47-1'; } 'EmCare.A.DE47';
		item.answer first where item.linkId = 'EmCare.A.DE31' as a then { a -> tgt.extention.motherVitalStatus = a 'EmCare.A.DE31-1'; } 'EmCare.A.DE31';
		item.answer first where item.linkId = 'EmCare.A.DE32' as a then { a -> tgt.extention.fatherVitalStatus = a 'EmCare.A.DE32-1'; } 'EmCare.A.DE32';
	} 'itemsemcarea.registration.p-emcare-patient';
} 

