map 'https://fhir.dk.swisstph-mis.ch/matchbox/fhir/StructureMap/structuremap-emcare-patient-emcarea.registration.p' = 'emcare-patient-EmCareA.Registration.P'

uses 'https://fhir.dk.swisstph-mis.ch/matchbox/fhir/Questionnaire/questionnaire-emcarea.registration.p' alias 'emcarea.registration.p' as source
uses 'https://fhir.dk.swisstph-mis.ch/matchbox/fhir/Profile/profile-emcare-patient' alias 'emcare-patient' as target
group  main(
	source qr : 'emcarea.registration.p',
	target tgt : 'emcare-patient'
) {
	qr.item as item then {
		item.answer first as a where item.linkId = 'EmCare.A.DE01'  then { tgt.identifier as id then {  a -> id.type = 'https://fhir.dk.swisstph-mis.ch/matchbox/fhir/CodeSystem/codesystem-emcare-custom-codes', id.value = a 'uid-1';} 'EmCare.A.DE01-1'; } 'EmCare.A.DE01';
		item.answer first as a where item.linkId = 'EmCare.A.DE02'  then { tgt.identifier as id then {  a -> id.type = 'https://fhir.dk.swisstph-mis.ch/matchbox/fhir/CodeSystem/codesystem-emcare-custom-codes', id.value = a 'uid-1';} 'EmCare.A.DE02-1'; } 'EmCare.A.DE02';
		item.answer first as a where item.linkId = 'EmCare.A.DE03'  then { tgt.identifier as id then {  a -> id.type = 'https://fhir.dk.swisstph-mis.ch/matchbox/fhir/CodeSystem/codesystem-emcare-custom-codes' 'noid';} 'EmCare.A.DE03-1'; } 'EmCare.A.DE03';
		item.answer first as a where item.linkId = 'EmCare.A.DE04'  then { tgt.name as name then {  a -> name.given = create(a) 'set-given-0';} 'EmCare.A.DE04-1'; } 'EmCare.A.DE04';
		item.answer first as a where item.linkId = 'EmCare.A.DE05'  then { tgt.name as name then {  a -> name.given= create(a) 'set-given-1';} 'EmCare.A.DE05-1'; } 'EmCare.A.DE05';
		item.answer first as a where item.linkId = 'EmCare.A.DE06'  then { tgt.name as name then {  a -> name.family = a 'set-family';} 'EmCare.A.DE06-1'; } 'EmCare.A.DE06';
		item.answer first as a where item.linkId = 'EmCare.A.DE08'  then { a -> tgt.birthDate = a 'EmCare.A.DE08-1'; } 'EmCare.A.DE08';
		item.answer first as a where item.linkId = 'EmCare.A.DE09'  then { tgt.extension as ext where ext.url ='https://fhir.dk.swisstph-mis.ch/matchbox/fhir/Extension/birthTime' as ext then {a -> ext.valueTime = a 'set-time';} 'EmCare.A.DE09-1'; } 'EmCare.A.DE09';
		item.answer first as a where item.linkId = 'EmCare.A.DE12'  then { tgt.extension as ext where ext.url ='https://fhir.dk.swisstph-mis.ch/matchbox/fhir/Extension/birthDateEstimator' as ext then {a -> ext.valueCode = a 'set-code';} 'EmCare.A.DE12-1'; } 'EmCare.A.DE12';
		item.answer first as a where item.linkId = 'EmCare.A.DE16'  then { a -> tgt.gender = translate(a, 'sex-of-the-client', 'http://hl7.org/fhir/administrative-gender') 'EmCare.A.DE16-1'; } 'EmCare.A.DE16';
		item.answer first as a where item.linkId = 'EmCare.A.DE20'  then { tgt.address as address then { a -> address.text = a "set-address";} 'EmCare.A.DE20-1'; } 'EmCare.A.DE20';
		item.answer first as a where item.linkId = 'EmCare.A.DE47'  then { tgt.extension as ext where ext.url ='https://fhir.dk.swisstph-mis.ch/matchbox/fhir/Extension/caregiver' as ext then {a -> ext.valueReference= a 'set-ref';} 'EmCare.A.DE47-1'; } 'EmCare.A.DE47';
		item.answer first as a where item.linkId = 'EmCare.A.DE31'  then { tgt.extension as ext where ext.url ='https://fhir.dk.swisstph-mis.ch/matchbox/fhir/Extension/motherVitalStatus' as ext then {a -> ext.valueCode = a 'set-code';} 'EmCare.A.DE31-1'; } 'EmCare.A.DE31';
		item.answer first as a where item.linkId = 'EmCare.A.DE32'  then { tgt.extension as ext where ext.url ='https://fhir.dk.swisstph-mis.ch/matchbox/fhir/Extension/fatherVitalStatus' as ext then {a -> ext.valueCode = a 'set-code';} 'EmCare.A.DE32-1'; } 'EmCare.A.DE32';
	} 'itemsemcarea.registration.p-emcare-patient';
} 

