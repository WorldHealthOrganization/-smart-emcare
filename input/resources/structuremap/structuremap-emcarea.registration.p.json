{
    "resourceType": "StructureMap",
    "id": "emcarea.registration.p",
    "meta": {
        "versionId": "6",
        "lastUpdated": "2022-05-24T14:30:32.083000+00:00"
    },
    "text": {
        "status": "generated",
        "div": "<div xmlns=\"http://www.w3.org/1999/xhtml\"><pre>map &quot;https://fhir.dk.swisstph-mis.ch/matchbox/fhir/StructureMap/emcarea.registration.p&quot; = &quot;emcarea.registration.p&quot;\r\n\r\n\r\nuses &quot;https://fhir.dk.swisstph-mis.ch/matchbox/fhir/Questionnaire/emcarea.registration.p&quot; alias 'emcarearegistrationp' as source\r\nuses &quot;https://fhir.dk.swisstph-mis.ch/matchbox/fhir/StructureDefinition/emcare-patient&quot; alias 'emcarepatient' as target\r\nuses &quot;https://fhir.dk.swisstph-mis.ch/matchbox/fhir/StructureDefinition/emcare-relatedperson-caregiver&quot; alias 'emcarerelatedpersoncaregiver' as target\r\nuses &quot;https://fhir.dk.swisstph-mis.ch/matchbox/fhir/StructureDefinition/emcare-communicationrequest&quot; alias 'emcarecommunicationrequest' as target\r\n\r\ngroup emcarepatient(source qr : 'emcarearegistrationp', target tgt : 'emcarepatient') {\r\n  qr.item as item then {\r\n    item.answer first as a where item.linkId = 'EmCare.A.DE01' then {\r\n      tgt.identifier as id then {\r\n        a -&gt;  id.type = 'https://fhir.dk.swisstph-mis.ch/matchbox/fhir/CodeSystem/emcare-custom-codes',  id.value = a &quot;uid-1&quot;;\r\n      } &quot;DE01-1&quot;;\r\n    } &quot;DE01&quot;;\r\n    item.answer first as a where item.linkId = 'EmCare.A.DE02' then {\r\n      tgt.identifier as id then {\r\n        a -&gt;  id.type = 'https://fhir.dk.swisstph-mis.ch/matchbox/fhir/CodeSystem/emcare-custom-codes',  id.value = a &quot;uid-1&quot;;\r\n      } &quot;DE02-1&quot;;\r\n    } &quot;DE02&quot;;\r\n    item.answer first as a where item.linkId = 'EmCare.A.DE03' then {\r\n      tgt.identifier as id then {\r\n        a -&gt; id.type = 'https://fhir.dk.swisstph-mis.ch/matchbox/fhir/CodeSystem/emcare-custom-codes' &quot;noid&quot;;\r\n      } &quot;DE03-1&quot;;\r\n    } &quot;DE03&quot;;\r\n    item.answer first as a where item.linkId = 'EmCare.A.DE04' then {\r\n      tgt.name as name then {\r\n        a -&gt; name.given = create(a) &quot;set-given-0&quot;;\r\n      } &quot;DE04-1&quot;;\r\n    } &quot;DE04&quot;;\r\n    item.answer first as a where item.linkId = 'EmCare.A.DE05' then {\r\n      tgt.name as name then {\r\n        a -&gt; name.given = create(a) &quot;set-given-1&quot;;\r\n      } &quot;DE05-1&quot;;\r\n    } &quot;DE05&quot;;\r\n    item.answer first as a where item.linkId = 'EmCare.A.DE06' then {\r\n      tgt.name as name then {\r\n        a -&gt; name.family = a &quot;set-family&quot;;\r\n      } &quot;DE06-1&quot;;\r\n    } &quot;DE06&quot;;\r\n    item.answer first as a where item.linkId = 'EmCare.A.DE08' then {\r\n      a -&gt; tgt.birthDate = a &quot;DE08-1&quot;;\r\n    } &quot;DE08&quot;;\r\n    item.answer first as a where item.linkId = 'EmCare.A.DE09' then {\r\n      tgt.extension as ext where (ext.url = 'https://fhir.dk.swisstph-mis.ch/matchbox/fhir/Extension/birthTime') as ext then {\r\n        a -&gt; ext.valueTime = a &quot;set-time&quot;;\r\n      } &quot;DE09-1&quot;;\r\n    } &quot;DE09&quot;;\r\n    item.answer first as a where item.linkId = 'EmCare.A.DE12' then {\r\n      tgt.extension as ext where (ext.url = 'https://fhir.dk.swisstph-mis.ch/matchbox/fhir/Extension/birthDateEstimator') as ext then {\r\n        a -&gt; ext.valueCode = a &quot;set-code&quot;;\r\n      } &quot;DE12-1&quot;;\r\n    } &quot;DE12&quot;;\r\n    item.answer first as a where item.linkId = 'EmCare.A.DE16' then {\r\n      a -&gt; tgt.gender = translate(a, 'sex-of-the-client', 'http://hl7.org/fhir/administrative-gender') &quot;DE16-1&quot;;\r\n    } &quot;DE16&quot;;\r\n    item.answer first as a where item.linkId = 'EmCare.A.DE20' then {\r\n      tgt.address as address then {\r\n        a -&gt; address.text = a &quot;set-address&quot;;\r\n      } &quot;DE20-1&quot;;\r\n    } &quot;DE20&quot;;\r\n    item.answer first as a where item.linkId = 'EmCare.A.DE47' then {\r\n      tgt.extension as ext where (ext.url = 'https://fhir.dk.swisstph-mis.ch/matchbox/fhir/Extension/caregiver') as ext then {\r\n        a -&gt; ext.valueReference = a &quot;set-ref&quot;;\r\n      } &quot;DE47-1&quot;;\r\n    } &quot;DE47&quot;;\r\n    item.answer first as a where item.linkId = 'EmCare.A.DE31' then {\r\n      tgt.extension as ext where (ext.url = 'https://fhir.dk.swisstph-mis.ch/matchbox/fhir/Extension/motherVitalStatus') as ext then {\r\n        a -&gt; ext.valueCode = a &quot;set-code&quot;;\r\n      } &quot;DE31-1&quot;;\r\n    } &quot;DE31&quot;;\r\n    item.answer first as a where item.linkId = 'EmCare.A.DE32' then {\r\n      tgt.extension as ext where (ext.url = 'https://fhir.dk.swisstph-mis.ch/matchbox/fhir/Extension/fatherVitalStatus') as ext then {\r\n        a -&gt; ext.valueCode = a &quot;set-code&quot;;\r\n      } &quot;DE32-1&quot;;\r\n    } &quot;DE32&quot;;\r\n  } &quot;itemsemcarearegistrationp-emcarepatient&quot;;\r\n}\r\n\r\ngroup emcarerelatedpersoncaregiver(source qr : 'emcarearegistrationp', target tgt : 'emcarerelatedpersoncaregiver') {\r\n  qr.item as item then {\r\n    item.answer first as a where item.linkId = 'EmCare.A.DE21' then {\r\n      tgt.name as name then {\r\n        a -&gt; name.given = create(a) &quot;set-given-0&quot;;\r\n      } &quot;DE21-1&quot;;\r\n    } &quot;DE21&quot;;\r\n    item.answer first as a where item.linkId = 'EmCare.A.DE22' then {\r\n      tgt.name as name then {\r\n        a -&gt; name.given = create(a) &quot;set-given-1&quot;;\r\n      } &quot;DE22-1&quot;;\r\n    } &quot;DE22&quot;;\r\n    item.answer first as a where item.linkId = 'EmCare.A.DE23' then {\r\n      tgt.name as name then {\r\n        a -&gt; name.family = a &quot;set-family&quot;;\r\n      } &quot;DE23-1&quot;;\r\n    } &quot;DE23&quot;;\r\n    item.answer first as a where item.linkId = 'EmCare.A.DE35' then {\r\n      tgt.telecom as tel then {\r\n        a -&gt;  tel.system = 'phone',  tel.use = 'mobile',  tel.value = a &quot;mphone-1&quot;;\r\n      } &quot;DE35-1&quot;;\r\n    } &quot;DE35&quot;;\r\n    item.answer first as a where item.linkId = 'EmCare.A.DE36' then {\r\n      tgt.telecom as tel then {\r\n        a -&gt;  tel.system = 'phone',  tel.use = 'home',  tel.value = a &quot;hphone-1&quot;;\r\n      } &quot;DE36-1&quot;;\r\n    } &quot;DE36&quot;;\r\n    item.answer first as a where item.linkId = 'EmCare.A.DE37' then {\r\n      tgt.telecom as tel then {\r\n        a -&gt;  tel.system = 'phone',  tel.use = 'work',  tel.value = a &quot;wphone-1&quot;;\r\n      } &quot;DE37-1&quot;;\r\n    } &quot;DE37&quot;;\r\n    item.answer first as a where item.linkId = 'EmCare.A.DE24' then {\r\n      a where a = 'EmCare.A.DE30' -&gt; tgt.relationship = translate(a, 'relationship-to-client', 'http://terminology.hl7.org/CodeSystem/v2-0131') &quot;caregiver-parent&quot;;\r\n      a where a != 'EmCare.A.DE30' -&gt; tgt.relationship = translate(a, 'relationship-to-client', 'http://terminology.hl7.org/CodeSystem/v3-RoleCode') &quot;DE24-1&quot;;\r\n    } &quot;DE24&quot;;\r\n  } &quot;itemsemcarearegistrationp-emcarerelatedpersoncaregiver&quot;;\r\n}\r\n\r\ngroup emcarecommunicationrequest(source qr : 'emcarearegistrationp', target tgt : 'emcarecommunicationrequest') {\r\n  qr.item as item then {\r\n    item.answer first as a where item.linkId = 'EmCare.A.DE38' then {\r\n      a -&gt; tgt.medium = 'https://fhir.dk.swisstph-mis.ch/matchbox/fhir/CodeSystem/emcare-custom-codes' &quot;DE38-1&quot;;\r\n    } &quot;DE38&quot;;\r\n    item.answer first as a where item.linkId = 'EmCare.A.DE46' then {\r\n      a -&gt; tgt.recipient = a &quot;DE46-1&quot;;\r\n    } &quot;DE46&quot;;\r\n  } &quot;itemsemcarearegistrationp-emcarecommunicationrequest&quot;;\r\n}\r\n\r\n</pre></div>"
    },
    "url": "https://fhir.dk.swisstph-mis.ch/matchbox/fhir/StructureMap/emcarea.registration.p",
    "name": "emcarea.registration.p",
    "status": "draft",
    "structure": [
        {
            "url": "https://fhir.dk.swisstph-mis.ch/matchbox/fhir/Questionnaire/emcarea.registration.p",
            "mode": "source",
            "alias": "'emcarearegistrationp'"
        },
        {
            "url": "https://fhir.dk.swisstph-mis.ch/matchbox/fhir/StructureDefinition/emcare-patient",
            "mode": "target",
            "alias": "'emcarepatient'"
        },
        {
            "url": "https://fhir.dk.swisstph-mis.ch/matchbox/fhir/StructureDefinition/emcare-relatedperson-caregiver",
            "mode": "target",
            "alias": "'emcarerelatedpersoncaregiver'"
        },
        {
            "url": "https://fhir.dk.swisstph-mis.ch/matchbox/fhir/StructureDefinition/emcare-communicationrequest",
            "mode": "target",
            "alias": "'emcarecommunicationrequest'"
        }
    ],
    "group": [
        {
            "name": "emcarepatient",
            "typeMode": "none",
            "input": [
                {
                    "name": "qr",
                    "type": "'emcarearegistrationp'",
                    "mode": "source"
                },
                {
                    "name": "tgt",
                    "type": "'emcarepatient'",
                    "mode": "target"
                }
            ],
            "rule": [
                {
                    "name": "itemsemcarearegistrationp-emcarepatient",
                    "source": [
                        {
                            "context": "qr",
                            "element": "item",
                            "variable": "item"
                        }
                    ],
                    "rule": [
                        {
                            "name": "EmCare.A.DE01",
                            "source": [
                                {
                                    "context": "item",
                                    "element": "answer",
                                    "listMode": "first",
                                    "variable": "a",
                                    "condition": "item.linkId = 'EmCare.A.DE01'"
                                }
                            ],
                            "rule": [
                                {
                                    "name": "EmCare.A.DE01-1",
                                    "source": [
                                        {
                                            "context": "tgt",
                                            "element": "identifier",
                                            "variable": "id"
                                        }
                                    ],
                                    "rule": [
                                        {
                                            "name": "uid-1",
                                            "source": [
                                                {
                                                    "context": "a"
                                                }
                                            ],
                                            "target": [
                                                {
                                                    "context": "id",
                                                    "contextType": "variable",
                                                    "element": "type",
                                                    "transform": "copy",
                                                    "parameter": [
                                                        {
                                                            "valueString": "https://fhir.dk.swisstph-mis.ch/matchbox/fhir/CodeSystem/emcare-custom-codes"
                                                        }
                                                    ]
                                                },
                                                {
                                                    "context": "id",
                                                    "contextType": "variable",
                                                    "element": "value",
                                                    "transform": "copy",
                                                    "parameter": [
                                                        {
                                                            "valueId": "a"
                                                        }
                                                    ]
                                                }
                                            ]
                                        }
                                    ]
                                }
                            ]
                        },
                        {
                            "name": "EmCare.A.DE02",
                            "source": [
                                {
                                    "context": "item",
                                    "element": "answer",
                                    "listMode": "first",
                                    "variable": "a",
                                    "condition": "item.linkId = 'EmCare.A.DE02'"
                                }
                            ],
                            "rule": [
                                {
                                    "name": "EmCare.A.DE02-1",
                                    "source": [
                                        {
                                            "context": "tgt",
                                            "element": "identifier",
                                            "variable": "id"
                                        }
                                    ],
                                    "rule": [
                                        {
                                            "name": "uid-1",
                                            "source": [
                                                {
                                                    "context": "a"
                                                }
                                            ],
                                            "target": [
                                                {
                                                    "context": "id",
                                                    "contextType": "variable",
                                                    "element": "type",
                                                    "transform": "copy",
                                                    "parameter": [
                                                        {
                                                            "valueString": "https://fhir.dk.swisstph-mis.ch/matchbox/fhir/CodeSystem/emcare-custom-codes"
                                                        }
                                                    ]
                                                },
                                                {
                                                    "context": "id",
                                                    "contextType": "variable",
                                                    "element": "value",
                                                    "transform": "copy",
                                                    "parameter": [
                                                        {
                                                            "valueId": "a"
                                                        }
                                                    ]
                                                }
                                            ]
                                        }
                                    ]
                                }
                            ]
                        },
                        {
                            "name": "EmCare.A.DE03",
                            "source": [
                                {
                                    "context": "item",
                                    "element": "answer",
                                    "listMode": "first",
                                    "variable": "a",
                                    "condition": "item.linkId = 'EmCare.A.DE03'"
                                }
                            ],
                            "rule": [
                                {
                                    "name": "EmCare.A.DE03-1",
                                    "source": [
                                        {
                                            "context": "tgt",
                                            "element": "identifier",
                                            "variable": "id"
                                        }
                                    ],
                                    "rule": [
                                        {
                                            "name": "noid",
                                            "source": [
                                                {
                                                    "context": "a"
                                                }
                                            ],
                                            "target": [
                                                {
                                                    "context": "id",
                                                    "contextType": "variable",
                                                    "element": "type",
                                                    "transform": "copy",
                                                    "parameter": [
                                                        {
                                                            "valueString": "https://fhir.dk.swisstph-mis.ch/matchbox/fhir/CodeSystem/emcare-custom-codes"
                                                        }
                                                    ]
                                                }
                                            ]
                                        }
                                    ]
                                }
                            ]
                        },
                        {
                            "name": "EmCare.A.DE04",
                            "source": [
                                {
                                    "context": "item",
                                    "element": "answer",
                                    "listMode": "first",
                                    "variable": "a",
                                    "condition": "item.linkId = 'EmCare.A.DE04'"
                                }
                            ],
                            "rule": [
                                {
                                    "name": "EmCare.A.DE04-1",
                                    "source": [
                                        {
                                            "context": "tgt",
                                            "element": "name",
                                            "variable": "name"
                                        }
                                    ],
                                    "rule": [
                                        {
                                            "name": "set-given-0",
                                            "source": [
                                                {
                                                    "context": "a"
                                                }
                                            ],
                                            "target": [
                                                {
                                                    "context": "name",
                                                    "contextType": "variable",
                                                    "element": "given",
                                                    "transform": "create",
                                                    "parameter": [
                                                        {
                                                            "valueId": "a"
                                                        }
                                                    ]
                                                }
                                            ]
                                        }
                                    ]
                                }
                            ]
                        },
                        {
                            "name": "EmCare.A.DE05",
                            "source": [
                                {
                                    "context": "item",
                                    "element": "answer",
                                    "listMode": "first",
                                    "variable": "a",
                                    "condition": "item.linkId = 'EmCare.A.DE05'"
                                }
                            ],
                            "rule": [
                                {
                                    "name": "EmCare.A.DE05-1",
                                    "source": [
                                        {
                                            "context": "tgt",
                                            "element": "name",
                                            "variable": "name"
                                        }
                                    ],
                                    "rule": [
                                        {
                                            "name": "set-given-1",
                                            "source": [
                                                {
                                                    "context": "a"
                                                }
                                            ],
                                            "target": [
                                                {
                                                    "context": "name",
                                                    "contextType": "variable",
                                                    "element": "given",
                                                    "transform": "create",
                                                    "parameter": [
                                                        {
                                                            "valueId": "a"
                                                        }
                                                    ]
                                                }
                                            ]
                                        }
                                    ]
                                }
                            ]
                        },
                        {
                            "name": "EmCare.A.DE06",
                            "source": [
                                {
                                    "context": "item",
                                    "element": "answer",
                                    "listMode": "first",
                                    "variable": "a",
                                    "condition": "item.linkId = 'EmCare.A.DE06'"
                                }
                            ],
                            "rule": [
                                {
                                    "name": "EmCare.A.DE06-1",
                                    "source": [
                                        {
                                            "context": "tgt",
                                            "element": "name",
                                            "variable": "name"
                                        }
                                    ],
                                    "rule": [
                                        {
                                            "name": "set-family",
                                            "source": [
                                                {
                                                    "context": "a"
                                                }
                                            ],
                                            "target": [
                                                {
                                                    "context": "name",
                                                    "contextType": "variable",
                                                    "element": "family",
                                                    "transform": "copy",
                                                    "parameter": [
                                                        {
                                                            "valueId": "a"
                                                        }
                                                    ]
                                                }
                                            ]
                                        }
                                    ]
                                }
                            ]
                        },
                        {
                            "name": "EmCare.A.DE08",
                            "source": [
                                {
                                    "context": "item",
                                    "element": "answer",
                                    "listMode": "first",
                                    "variable": "a",
                                    "condition": "item.linkId = 'EmCare.A.DE08'"
                                }
                            ],
                            "rule": [
                                {
                                    "name": "EmCare.A.DE08-1",
                                    "source": [
                                        {
                                            "context": "a"
                                        }
                                    ],
                                    "target": [
                                        {
                                            "context": "tgt",
                                            "contextType": "variable",
                                            "element": "birthDate",
                                            "transform": "copy",
                                            "parameter": [
                                                {
                                                    "valueId": "a"
                                                }
                                            ]
                                        }
                                    ]
                                }
                            ]
                        },
                        {
                            "name": "EmCare.A.DE09",
                            "source": [
                                {
                                    "context": "item",
                                    "element": "answer",
                                    "listMode": "first",
                                    "variable": "a",
                                    "condition": "item.linkId = 'EmCare.A.DE09'"
                                }
                            ],
                            "rule": [
                                {
                                    "name": "EmCare.A.DE09-1",
                                    "source": [
                                        {
                                            "context": "tgt",
                                            "element": "extension",
                                            "variable": "ext",
                                            "condition": "(ext.url = 'https://fhir.dk.swisstph-mis.ch/matchbox/fhir/Extension/birthTime') as ext"
                                        }
                                    ],
                                    "rule": [
                                        {
                                            "name": "set-time",
                                            "source": [
                                                {
                                                    "context": "a"
                                                }
                                            ],
                                            "target": [
                                                {
                                                    "context": "ext",
                                                    "contextType": "variable",
                                                    "element": "valueTime",
                                                    "transform": "copy",
                                                    "parameter": [
                                                        {
                                                            "valueId": "a"
                                                        }
                                                    ]
                                                }
                                            ]
                                        }
                                    ]
                                }
                            ]
                        },
                        {
                            "name": "EmCare.A.DE12",
                            "source": [
                                {
                                    "context": "item",
                                    "element": "answer",
                                    "listMode": "first",
                                    "variable": "a",
                                    "condition": "item.linkId = 'EmCare.A.DE12'"
                                }
                            ],
                            "rule": [
                                {
                                    "name": "EmCare.A.DE12-1",
                                    "source": [
                                        {
                                            "context": "tgt",
                                            "element": "extension",
                                            "variable": "ext",
                                            "condition": "(ext.url = 'https://fhir.dk.swisstph-mis.ch/matchbox/fhir/Extension/birthDateEstimator') as ext"
                                        }
                                    ],
                                    "rule": [
                                        {
                                            "name": "set-code",
                                            "source": [
                                                {
                                                    "context": "a"
                                                }
                                            ],
                                            "target": [
                                                {
                                                    "context": "ext",
                                                    "contextType": "variable",
                                                    "element": "valueCode",
                                                    "transform": "copy",
                                                    "parameter": [
                                                        {
                                                            "valueId": "a"
                                                        }
                                                    ]
                                                }
                                            ]
                                        }
                                    ]
                                }
                            ]
                        },
                        {
                            "name": "EmCare.A.DE16",
                            "source": [
                                {
                                    "context": "item",
                                    "element": "answer",
                                    "listMode": "first",
                                    "variable": "a",
                                    "condition": "item.linkId = 'EmCare.A.DE16'"
                                }
                            ],
                            "rule": [
                                {
                                    "name": "EmCare.A.DE16-1",
                                    "source": [
                                        {
                                            "context": "a"
                                        }
                                    ],
                                    "target": [
                                        {
                                            "context": "tgt",
                                            "contextType": "variable",
                                            "element": "gender",
                                            "transform": "translate",
                                            "parameter": [
                                                {
                                                    "valueId": "a"
                                                },
                                                {
                                                    "valueString": "sex-of-the-client"
                                                },
                                                {
                                                    "valueString": "http://hl7.org/fhir/administrative-gender"
                                                }
                                            ]
                                        }
                                    ]
                                }
                            ]
                        },
                        {
                            "name": "EmCare.A.DE20",
                            "source": [
                                {
                                    "context": "item",
                                    "element": "answer",
                                    "listMode": "first",
                                    "variable": "a",
                                    "condition": "item.linkId = 'EmCare.A.DE20'"
                                }
                            ],
                            "rule": [
                                {
                                    "name": "EmCare.A.DE20-1",
                                    "source": [
                                        {
                                            "context": "tgt",
                                            "element": "address",
                                            "variable": "address"
                                        }
                                    ],
                                    "rule": [
                                        {
                                            "name": "set-address",
                                            "source": [
                                                {
                                                    "context": "a"
                                                }
                                            ],
                                            "target": [
                                                {
                                                    "context": "address",
                                                    "contextType": "variable",
                                                    "element": "text",
                                                    "transform": "copy",
                                                    "parameter": [
                                                        {
                                                            "valueId": "a"
                                                        }
                                                    ]
                                                }
                                            ]
                                        }
                                    ]
                                }
                            ]
                        },
                        {
                            "name": "EmCare.A.DE47",
                            "source": [
                                {
                                    "context": "item",
                                    "element": "answer",
                                    "listMode": "first",
                                    "variable": "a",
                                    "condition": "item.linkId = 'EmCare.A.DE47'"
                                }
                            ],
                            "rule": [
                                {
                                    "name": "EmCare.A.DE47-1",
                                    "source": [
                                        {
                                            "context": "tgt",
                                            "element": "extension",
                                            "variable": "ext",
                                            "condition": "(ext.url = 'https://fhir.dk.swisstph-mis.ch/matchbox/fhir/Extension/caregiver') as ext"
                                        }
                                    ],
                                    "rule": [
                                        {
                                            "name": "set-ref",
                                            "source": [
                                                {
                                                    "context": "a"
                                                }
                                            ],
                                            "target": [
                                                {
                                                    "context": "ext",
                                                    "contextType": "variable",
                                                    "element": "valueReference",
                                                    "transform": "copy",
                                                    "parameter": [
                                                        {
                                                            "valueId": "a"
                                                        }
                                                    ]
                                                }
                                            ]
                                        }
                                    ]
                                }
                            ]
                        },
                        {
                            "name": "EmCare.A.DE31",
                            "source": [
                                {
                                    "context": "item",
                                    "element": "answer",
                                    "listMode": "first",
                                    "variable": "a",
                                    "condition": "item.linkId = 'EmCare.A.DE31'"
                                }
                            ],
                            "rule": [
                                {
                                    "name": "EmCare.A.DE31-1",
                                    "source": [
                                        {
                                            "context": "tgt",
                                            "element": "extension",
                                            "variable": "ext",
                                            "condition": "(ext.url = 'https://fhir.dk.swisstph-mis.ch/matchbox/fhir/Extension/motherVitalStatus') as ext"
                                        }
                                    ],
                                    "rule": [
                                        {
                                            "name": "set-code",
                                            "source": [
                                                {
                                                    "context": "a"
                                                }
                                            ],
                                            "target": [
                                                {
                                                    "context": "ext",
                                                    "contextType": "variable",
                                                    "element": "valueCode",
                                                    "transform": "copy",
                                                    "parameter": [
                                                        {
                                                            "valueId": "a"
                                                        }
                                                    ]
                                                }
                                            ]
                                        }
                                    ]
                                }
                            ]
                        },
                        {
                            "name": "EmCare.A.DE32",
                            "source": [
                                {
                                    "context": "item",
                                    "element": "answer",
                                    "listMode": "first",
                                    "variable": "a",
                                    "condition": "item.linkId = 'EmCare.A.DE32'"
                                }
                            ],
                            "rule": [
                                {
                                    "name": "EmCare.A.DE32-1",
                                    "source": [
                                        {
                                            "context": "tgt",
                                            "element": "extension",
                                            "variable": "ext",
                                            "condition": "(ext.url = 'https://fhir.dk.swisstph-mis.ch/matchbox/fhir/Extension/fatherVitalStatus') as ext"
                                        }
                                    ],
                                    "rule": [
                                        {
                                            "name": "set-code",
                                            "source": [
                                                {
                                                    "context": "a"
                                                }
                                            ],
                                            "target": [
                                                {
                                                    "context": "ext",
                                                    "contextType": "variable",
                                                    "element": "valueCode",
                                                    "transform": "copy",
                                                    "parameter": [
                                                        {
                                                            "valueId": "a"
                                                        }
                                                    ]
                                                }
                                            ]
                                        }
                                    ]
                                }
                            ]
                        }
                    ]
                }
            ]
        },
        {
            "name": "emcarerelatedpersoncaregiver",
            "typeMode": "none",
            "input": [
                {
                    "name": "qr",
                    "type": "'emcarearegistrationp'",
                    "mode": "source"
                },
                {
                    "name": "tgt",
                    "type": "'emcarerelatedpersoncaregiver'",
                    "mode": "target"
                }
            ],
            "rule": [
                {
                    "name": "itemsemcarearegistrationp-emcarerelatedpersoncaregiver",
                    "source": [
                        {
                            "context": "qr",
                            "element": "item",
                            "variable": "item"
                        }
                    ],
                    "rule": [
                        {
                            "name": "EmCare.A.DE21",
                            "source": [
                                {
                                    "context": "item",
                                    "element": "answer",
                                    "listMode": "first",
                                    "variable": "a",
                                    "condition": "item.linkId = 'EmCare.A.DE21'"
                                }
                            ],
                            "rule": [
                                {
                                    "name": "EmCare.A.DE21-1",
                                    "source": [
                                        {
                                            "context": "tgt",
                                            "element": "name",
                                            "variable": "name"
                                        }
                                    ],
                                    "rule": [
                                        {
                                            "name": "set-given-0",
                                            "source": [
                                                {
                                                    "context": "a"
                                                }
                                            ],
                                            "target": [
                                                {
                                                    "context": "name",
                                                    "contextType": "variable",
                                                    "element": "given",
                                                    "transform": "create",
                                                    "parameter": [
                                                        {
                                                            "valueId": "a"
                                                        }
                                                    ]
                                                }
                                            ]
                                        }
                                    ]
                                }
                            ]
                        },
                        {
                            "name": "EmCare.A.DE22",
                            "source": [
                                {
                                    "context": "item",
                                    "element": "answer",
                                    "listMode": "first",
                                    "variable": "a",
                                    "condition": "item.linkId = 'EmCare.A.DE22'"
                                }
                            ],
                            "rule": [
                                {
                                    "name": "EmCare.A.DE22-1",
                                    "source": [
                                        {
                                            "context": "tgt",
                                            "element": "name",
                                            "variable": "name"
                                        }
                                    ],
                                    "rule": [
                                        {
                                            "name": "set-given-1",
                                            "source": [
                                                {
                                                    "context": "a"
                                                }
                                            ],
                                            "target": [
                                                {
                                                    "context": "name",
                                                    "contextType": "variable",
                                                    "element": "given",
                                                    "transform": "create",
                                                    "parameter": [
                                                        {
                                                            "valueId": "a"
                                                        }
                                                    ]
                                                }
                                            ]
                                        }
                                    ]
                                }
                            ]
                        },
                        {
                            "name": "EmCare.A.DE23",
                            "source": [
                                {
                                    "context": "item",
                                    "element": "answer",
                                    "listMode": "first",
                                    "variable": "a",
                                    "condition": "item.linkId = 'EmCare.A.DE23'"
                                }
                            ],
                            "rule": [
                                {
                                    "name": "EmCare.A.DE23-1",
                                    "source": [
                                        {
                                            "context": "tgt",
                                            "element": "name",
                                            "variable": "name"
                                        }
                                    ],
                                    "rule": [
                                        {
                                            "name": "set-family",
                                            "source": [
                                                {
                                                    "context": "a"
                                                }
                                            ],
                                            "target": [
                                                {
                                                    "context": "name",
                                                    "contextType": "variable",
                                                    "element": "family",
                                                    "transform": "copy",
                                                    "parameter": [
                                                        {
                                                            "valueId": "a"
                                                        }
                                                    ]
                                                }
                                            ]
                                        }
                                    ]
                                }
                            ]
                        },
                        {
                            "name": "EmCare.A.DE35",
                            "source": [
                                {
                                    "context": "item",
                                    "element": "answer",
                                    "listMode": "first",
                                    "variable": "a",
                                    "condition": "item.linkId = 'EmCare.A.DE35'"
                                }
                            ],
                            "rule": [
                                {
                                    "name": "EmCare.A.DE35-1",
                                    "source": [
                                        {
                                            "context": "tgt",
                                            "element": "telecom",
                                            "variable": "tel"
                                        }
                                    ],
                                    "rule": [
                                        {
                                            "name": "mphone-1",
                                            "source": [
                                                {
                                                    "context": "a"
                                                }
                                            ],
                                            "target": [
                                                {
                                                    "context": "tel",
                                                    "contextType": "variable",
                                                    "element": "system",
                                                    "transform": "copy",
                                                    "parameter": [
                                                        {
                                                            "valueString": "phone"
                                                        }
                                                    ]
                                                },
                                                {
                                                    "context": "tel",
                                                    "contextType": "variable",
                                                    "element": "use",
                                                    "transform": "copy",
                                                    "parameter": [
                                                        {
                                                            "valueString": "mobile"
                                                        }
                                                    ]
                                                },
                                                {
                                                    "context": "tel",
                                                    "contextType": "variable",
                                                    "element": "value",
                                                    "transform": "copy",
                                                    "parameter": [
                                                        {
                                                            "valueId": "a"
                                                        }
                                                    ]
                                                }
                                            ]
                                        }
                                    ]
                                }
                            ]
                        },
                        {
                            "name": "EmCare.A.DE36",
                            "source": [
                                {
                                    "context": "item",
                                    "element": "answer",
                                    "listMode": "first",
                                    "variable": "a",
                                    "condition": "item.linkId = 'EmCare.A.DE36'"
                                }
                            ],
                            "rule": [
                                {
                                    "name": "EmCare.A.DE36-1",
                                    "source": [
                                        {
                                            "context": "tgt",
                                            "element": "telecom",
                                            "variable": "tel"
                                        }
                                    ],
                                    "rule": [
                                        {
                                            "name": "hphone-1",
                                            "source": [
                                                {
                                                    "context": "a"
                                                }
                                            ],
                                            "target": [
                                                {
                                                    "context": "tel",
                                                    "contextType": "variable",
                                                    "element": "system",
                                                    "transform": "copy",
                                                    "parameter": [
                                                        {
                                                            "valueString": "phone"
                                                        }
                                                    ]
                                                },
                                                {
                                                    "context": "tel",
                                                    "contextType": "variable",
                                                    "element": "use",
                                                    "transform": "copy",
                                                    "parameter": [
                                                        {
                                                            "valueString": "home"
                                                        }
                                                    ]
                                                },
                                                {
                                                    "context": "tel",
                                                    "contextType": "variable",
                                                    "element": "value",
                                                    "transform": "copy",
                                                    "parameter": [
                                                        {
                                                            "valueId": "a"
                                                        }
                                                    ]
                                                }
                                            ]
                                        }
                                    ]
                                }
                            ]
                        },
                        {
                            "name": "EmCare.A.DE37",
                            "source": [
                                {
                                    "context": "item",
                                    "element": "answer",
                                    "listMode": "first",
                                    "variable": "a",
                                    "condition": "item.linkId = 'EmCare.A.DE37'"
                                }
                            ],
                            "rule": [
                                {
                                    "name": "EmCare.A.DE37-1",
                                    "source": [
                                        {
                                            "context": "tgt",
                                            "element": "telecom",
                                            "variable": "tel"
                                        }
                                    ],
                                    "rule": [
                                        {
                                            "name": "wphone-1",
                                            "source": [
                                                {
                                                    "context": "a"
                                                }
                                            ],
                                            "target": [
                                                {
                                                    "context": "tel",
                                                    "contextType": "variable",
                                                    "element": "system",
                                                    "transform": "copy",
                                                    "parameter": [
                                                        {
                                                            "valueString": "phone"
                                                        }
                                                    ]
                                                },
                                                {
                                                    "context": "tel",
                                                    "contextType": "variable",
                                                    "element": "use",
                                                    "transform": "copy",
                                                    "parameter": [
                                                        {
                                                            "valueString": "work"
                                                        }
                                                    ]
                                                },
                                                {
                                                    "context": "tel",
                                                    "contextType": "variable",
                                                    "element": "value",
                                                    "transform": "copy",
                                                    "parameter": [
                                                        {
                                                            "valueId": "a"
                                                        }
                                                    ]
                                                }
                                            ]
                                        }
                                    ]
                                }
                            ]
                        },
                        {
                            "name": "EmCare.A.DE24",
                            "source": [
                                {
                                    "context": "item",
                                    "element": "answer",
                                    "listMode": "first",
                                    "variable": "a",
                                    "condition": "item.linkId = 'EmCare.A.DE24'"
                                }
                            ],
                            "rule": [
                                {
                                    "name": "caregiver-parent",
                                    "source": [
                                        {
                                            "context": "a",
                                            "condition": "a = 'EmCare.A.DE30'"
                                        }
                                    ],
                                    "target": [
                                        {
                                            "context": "tgt",
                                            "contextType": "variable",
                                            "element": "relationship",
                                            "transform": "translate",
                                            "parameter": [
                                                {
                                                    "valueId": "a"
                                                },
                                                {
                                                    "valueString": "relationship-to-client"
                                                },
                                                {
                                                    "valueString": "http://terminology.hl7.org/CodeSystem/v2-0131"
                                                }
                                            ]
                                        }
                                    ]
                                },
                                {
                                    "name": "EmCare.A.DE24-1",
                                    "source": [
                                        {
                                            "context": "a",
                                            "condition": "a != 'EmCare.A.DE30'"
                                        }
                                    ],
                                    "target": [
                                        {
                                            "context": "tgt",
                                            "contextType": "variable",
                                            "element": "relationship",
                                            "transform": "translate",
                                            "parameter": [
                                                {
                                                    "valueId": "a"
                                                },
                                                {
                                                    "valueString": "relationship-to-client"
                                                },
                                                {
                                                    "valueString": "http://terminology.hl7.org/CodeSystem/v3-RoleCode"
                                                }
                                            ]
                                        }
                                    ]
                                }
                            ]
                        }
                    ]
                }
            ]
        },
        {
            "name": "emcarecommunicationrequest",
            "typeMode": "none",
            "input": [
                {
                    "name": "qr",
                    "type": "'emcarearegistrationp'",
                    "mode": "source"
                },
                {
                    "name": "tgt",
                    "type": "'emcarecommunicationrequest'",
                    "mode": "target"
                }
            ],
            "rule": [
                {
                    "name": "itemsemcarearegistrationp-emcarecommunicationrequest",
                    "source": [
                        {
                            "context": "qr",
                            "element": "item",
                            "variable": "item"
                        }
                    ],
                    "rule": [
                        {
                            "name": "EmCare.A.DE38",
                            "source": [
                                {
                                    "context": "item",
                                    "element": "answer",
                                    "listMode": "first",
                                    "variable": "a",
                                    "condition": "item.linkId = 'EmCare.A.DE38'"
                                }
                            ],
                            "rule": [
                                {
                                    "name": "EmCare.A.DE38-1",
                                    "source": [
                                        {
                                            "context": "a"
                                        }
                                    ],
                                    "target": [
                                        {
                                            "context": "tgt",
                                            "contextType": "variable",
                                            "element": "medium",
                                            "transform": "copy",
                                            "parameter": [
                                                {
                                                    "valueString": "https://fhir.dk.swisstph-mis.ch/matchbox/fhir/CodeSystem/emcare-custom-codes"
                                                }
                                            ]
                                        }
                                    ]
                                }
                            ]
                        },
                        {
                            "name": "EmCare.A.DE46",
                            "source": [
                                {
                                    "context": "item",
                                    "element": "answer",
                                    "listMode": "first",
                                    "variable": "a",
                                    "condition": "item.linkId = 'EmCare.A.DE46'"
                                }
                            ],
                            "rule": [
                                {
                                    "name": "EmCare.A.DE46-1",
                                    "source": [
                                        {
                                            "context": "a"
                                        }
                                    ],
                                    "target": [
                                        {
                                            "context": "tgt",
                                            "contextType": "variable",
                                            "element": "recipient",
                                            "transform": "copy",
                                            "parameter": [
                                                {
                                                    "valueId": "a"
                                                }
                                            ]
                                        }
                                    ]
                                }
                            ]
                        }
                    ]
                }
            ]
        }
    ]
}