{
    "resourceType": "StructureMap",
    "id": "emcarea.registration.p",
    "meta": {
        "versionId": "312",
        "lastUpdated": "2022-09-13T09:13:00.498000+00:00"
    },
    "text": {
        "status": "generated",
        "div": "<div xmlns=\"http://www.w3.org/1999/xhtml\"><pre>map &quot;https://fhir.dk.swisstph-mis.ch/matchbox/fhir/StructureMap/emcarea.registration.p&quot; = &quot;emcarea.registration.p&quot;\r\n\r\n\r\nuses &quot;http://hl7.org/fhir/uv/sdc/StructureDefinition/sdc-questionnaireresponse&quot; alias 'questionnaireResponse' as source\r\nuses &quot;http://hl7.org/fhir/StructureDefinition/Bundle&quot; alias 'Bundle' as target\r\nuses &quot;https://fhir.dk.swisstph-mis.ch/matchbox/fhir/StructureDefinition/patient&quot; alias 'Patient' as target\r\nuses &quot;https://fhir.dk.swisstph-mis.ch/matchbox/fhir/StructureDefinition/relatedperson&quot; alias 'RelatedPerson' as target\r\nuses &quot;https://fhir.dk.swisstph-mis.ch/matchbox/fhir/StructureDefinition/communicationrequest&quot; alias 'CommunicationRequest' as target\r\nuses &quot;https://fhir.dk.swisstph-mis.ch/matchbox/fhir/StructureDefinition/emcarepatient&quot; alias 'EmCare Patient' as produced\r\nuses &quot;https://fhir.dk.swisstph-mis.ch/matchbox/fhir/StructureDefinition/emcarerelatedpersoncaregiver&quot; alias 'EmCare RelatedPerson Caregiver' as produced\r\nuses &quot;https://fhir.dk.swisstph-mis.ch/matchbox/fhir/StructureDefinition/emcarecommunicationrequest&quot; alias 'EmCare CommunicationRequest' as produced\r\n\r\ngroup bundletrans(source src : questionnaireResponse, target bundle : Bundle) {\r\n  src -&gt; bundle.id = uuid() &quot;id&quot;;\r\n  src -&gt; bundle.type = 'batch' &quot;type&quot;;\r\n  src -&gt; bundle.entry as entry then {\r\n    src.subject as subject then {\r\n      subject.id as idval -&gt;  entry.request as request,  request.method = 'PUT',  request.url = append('/Patient/', idval) &quot;kuwwh&quot;;\r\n    } &quot;fmxog&quot;;\r\n    src -&gt; entry.resource = create('Patient') as tgt then {\r\n      src -&gt; tgt then emcarepatient(src, tgt) &quot;dprxm&quot;;\r\n      src.subject as subject then {\r\n        subject.id as idval -&gt; tgt.id = idval &quot;mnbux&quot;;\r\n      } &quot;uaktq&quot;;\r\n    } &quot;vrtdu&quot;;\r\n  } &quot;put-emcarepatient&quot;;\r\n  src where src.item.where(linkId = 'emcarerelatedpersoncaregiverid').answer.exists() -&gt; bundle.entry as entry then {\r\n    src.item first as item where linkId = 'emcarerelatedpersoncaregiverid' -&gt;  entry.request as request,  request.method = 'PUT' then {\r\n      item.answer first as a -&gt; request then {\r\n        a.value as val -&gt; request.url = append('/RelatedPerson/', val) &quot;bycgp&quot;;\r\n      } &quot;sgetz&quot;;\r\n    } &quot;shoyc&quot;;\r\n    src -&gt; entry.resource = create('RelatedPerson') as tgt then {\r\n      src -&gt; tgt then emcarerelatedpersoncaregiver(src, tgt) &quot;lrwmm&quot;;\r\n      src -&gt; entry then getIdemcarerelatedpersoncaregiver(src, tgt) &quot;uafdx&quot;;\r\n    } &quot;zuhsz&quot;;\r\n  } &quot;put-emcarerelatedpersoncaregiver&quot;;\r\n  src where src.item.where(linkId = 'EmCare.A.DE38').exists() and src.item.where(linkId = 'emcarecommunicationrequestid').first().answer.exists() then {\r\n    src -&gt;  bundle.entry as entry,  entry.request as request,  request.method = 'POST',  entry.resource = create('CommunicationRequest') as tgt then emcarecommunicationrequestemcareade38(src, tgt) &quot;DE38&quot;;\r\n  } &quot;emcarecommunicationrequest&quot;;\r\n}\r\n\r\ngroup emcarepatient(source src : questionnaireResponse, target tgt : Patient) {\r\n  src.item as item where linkId = 'EmCare.A.DE01' then {\r\n    item.answer first as a then {\r\n      a.value as val -&gt; tgt.identifier = create('Identifier') as identifier then {\r\n        val -&gt;  identifier.value = val,  identifier.use = 'official' &quot;id&quot;;\r\n      } &quot;aemcareade01&quot;;\r\n    } &quot;aemcareade01&quot;;\r\n  } &quot;emcareade01&quot;;\r\n  src.item as item where linkId = 'EmCare.A.DE03' then {\r\n    item.answer first as a -&gt; tgt.identifier = create('Identifier') as identifier then {\r\n      a -&gt;  identifier.value = 'EmCare.A.DE03',  identifier.system = 'https://fhir.dk.swisstph-mis.ch/matchbox/fhir/CodeSystem/emcare-custom-codes' &quot;noid&quot;;\r\n    } &quot;aemcareade03&quot;;\r\n  } &quot;emcareade03&quot;;\r\n  src.item first as item where (linkId = 'EmCare.A.DE04') or (linkId = 'EmCare.A.DE05') or (linkId = 'EmCare.A.DE06') -&gt;  tgt as target,  target.name as name then SetOfficalGivenNameemcarepatient(src, name) &quot;emcareade04&quot;;\r\n  src.item as item where linkId = 'EmCare.A.DE12' then {\r\n    item.answer first as a then {\r\n      a.value as val -&gt;  tgt.extension = create('Extension') as ext,  ext.url = 'https://fhir.dk.swisstph-mis.ch/matchbox/fhir/StructureDefinition/birthDateEstimator',  ext.value = val &quot;aemcareade12&quot;;\r\n    } &quot;aemcareade12&quot;;\r\n  } &quot;emcareade12&quot;;\r\n  src.item as item where linkId = 'EmCare.A.DE08' then {\r\n    item.answer first as a then {\r\n      a.value as val -&gt; tgt.birthDate = val &quot;aemcareade08&quot;;\r\n    } &quot;aemcareade08&quot;;\r\n  } &quot;emcareade08&quot;;\r\n  src.item as item where linkId = 'EmCare.A.DE16' then {\r\n    item.answer first as a then MapValueSetExtCodeemcareade16(a, tgt) &quot;emcareade16d&quot;;\r\n  } &quot;emcareade16&quot;;\r\n  src.item as item where linkId = 'EmCare.A.DE20' then {\r\n    item.answer first as a then {\r\n      a.value as val -&gt;  tgt.address as address,  address.text = val &quot;aemcareade20&quot;;\r\n    } &quot;aemcareade20&quot;;\r\n  } &quot;emcareade20&quot;;\r\n  src.item as item where linkId = 'EmCare.A.DE47' then {\r\n    item.answer first as a then {\r\n      a.value as val -&gt;  tgt.extension = create('Extension') as ext,  ext.url = 'https://fhir.dk.swisstph-mis.ch/matchbox/fhir/StructureDefinition/caregiver',  ext.value = val &quot;aemcareade47&quot;;\r\n    } &quot;aemcareade47&quot;;\r\n  } &quot;emcareade47&quot;;\r\n  src.item as item where linkId = 'EmCare.A.DE31' then {\r\n    item.answer first as a then {\r\n      a.value as val -&gt;  tgt.extension = create('Extension') as ext,  ext.url = 'https://fhir.dk.swisstph-mis.ch/matchbox/fhir/Extension/motherVitalStatus',  ext.value = val &quot;aemcareade31&quot;;\r\n    } &quot;aemcareade31&quot;;\r\n  } &quot;emcareade31&quot;;\r\n  src.item as item where linkId = 'EmCare.A.DE32' then {\r\n    item.answer first as a then {\r\n      a.value as val -&gt;  tgt.extension = create('Extension') as ext,  ext.url = 'https://fhir.dk.swisstph-mis.ch/matchbox/fhir/Extension/fatherVitalStatus',  ext.value = val &quot;aemcareade32&quot;;\r\n    } &quot;aemcareade32&quot;;\r\n  } &quot;emcareade32&quot;;\r\n}\r\n\r\ngroup SetOfficalGivenNameemcarepatient(source src, target tgt) {\r\n  src -&gt; tgt.use = 'official' then {\r\n    src.item as item where linkId = 'EmCare.A.DE04' -&gt; tgt then {\r\n      item.answer as a -&gt; tgt.given = a &quot;f&quot;;\r\n    } &quot;ugaqc&quot;;\r\n    src.item as item where linkId = 'EmCare.A.DE05' -&gt; tgt then {\r\n      item.answer as a -&gt; tgt.given = a &quot;f&quot;;\r\n    } &quot;jasqq&quot;;\r\n    src.item as item where linkId = 'EmCare.A.DE06' -&gt; tgt then {\r\n      item.answer as a -&gt; tgt.family = a &quot;f&quot;;\r\n    } &quot;awfpx&quot;;\r\n  } &quot;uxgid&quot;;\r\n}\r\n\r\ngroup MapValueSetExtCodeemcareade16(source src, target tgt) {\r\n  src -&gt; tgt then {\r\n    src -&gt; tgt then {\r\n      src where value.code = 'EmCare.A.DE17' -&gt; tgt.gender = 'female' &quot;ngigi&quot;;\r\n      src where value.code = 'EmCare.A.DE18' -&gt; tgt.gender = 'male' &quot;ltogs&quot;;\r\n      src where value.code = 'EmCare.A.DE19' -&gt; tgt.gender = 'unknown' &quot;qjlgw&quot;;\r\n    } &quot;mapbase&quot;;\r\n  } &quot;njupl&quot;;\r\n}\r\n\r\ngroup getIdemcarepatient(source src, target tgt) {\r\n  src.item first as item where linkId = 'emcarepatientid' -&gt; tgt then {\r\n    item.answer first as a -&gt; tgt then {\r\n      a.value as val -&gt; tgt.id = val &quot;rzbmr&quot;;\r\n    } &quot;cbqcj&quot;;\r\n  } &quot;ftjcj&quot;;\r\n}\r\n\r\ngroup getFullUrlemcarepatient(source src, target tgt) {\r\n  src.item first as item where linkId = 'emcarepatientid' -&gt; tgt then {\r\n    item.answer first as a -&gt; tgt then {\r\n      a.value as val -&gt; tgt.fullUrl = append('urn:uuid:', val) &quot;lghyd&quot;;\r\n    } &quot;acxap&quot;;\r\n  } &quot;dtbzk&quot;;\r\n}\r\n\r\ngroup getUrlemcarepatient(source src, target tgt) {\r\n  src.item first as item where linkId = 'emcarepatientid' -&gt; tgt then {\r\n    item.answer first as a -&gt; tgt then {\r\n      a.value as val -&gt; ref.reference = append('/Patient/', val) &quot;tujvi&quot;;\r\n    } &quot;ajmew&quot;;\r\n  } &quot;fmheg&quot;;\r\n}\r\n\r\ngroup emcarerelatedpersoncaregiver(source src : questionnaireResponse, target tgt : RelatedPerson) {\r\n  src.item first as item where (linkId = 'EmCare.A.DE21') or (linkId = 'EmCare.A.DE22') or (linkId = 'EmCare.A.DE23') -&gt;  tgt as target,  target.name as name then SetOfficalGivenNameemcarerelatedpersoncaregiver(src, name) &quot;emcareade21&quot;;\r\n  src.item as item where linkId = 'EmCare.A.DE35' then {\r\n    item.answer first as a then {\r\n      a.value as val -&gt;  tgt.telecom as tel,  tel.system = 'phone',  tel.use = 'mobile',  tel.value = val &quot;aemcareade35&quot;;\r\n    } &quot;aemcareade35&quot;;\r\n  } &quot;emcareade35&quot;;\r\n  src.item as item where linkId = 'EmCare.A.DE36' then {\r\n    item.answer first as a then {\r\n      a.value as val -&gt;  tgt.telecom as tel,  tel.system = 'phone',  tel.use = 'home',  tel.value = val &quot;aemcareade36&quot;;\r\n    } &quot;aemcareade36&quot;;\r\n  } &quot;emcareade36&quot;;\r\n  src.item as item where linkId = 'EmCare.A.DE37' then {\r\n    item.answer first as a then {\r\n      a.value as val -&gt;  tgt.telecom as tel,  tel.system = 'phone',  tel.use = 'work',  tel.value = val &quot;aemcareade37&quot;;\r\n    } &quot;aemcareade37&quot;;\r\n  } &quot;emcareade37&quot;;\r\n}\r\n\r\ngroup SetOfficalGivenNameemcarerelatedpersoncaregiver(source src, target tgt) {\r\n  src -&gt; tgt.use = 'official' then {\r\n    src.item as item where linkId = 'EmCare.A.DE21' -&gt; tgt then {\r\n      item.answer as a -&gt; tgt.given = a &quot;f&quot;;\r\n    } &quot;bnznk&quot;;\r\n    src.item as item where linkId = 'EmCare.A.DE22' -&gt; tgt then {\r\n      item.answer as a -&gt; tgt.given = a &quot;f&quot;;\r\n    } &quot;wjnzu&quot;;\r\n    src.item as item where linkId = 'EmCare.A.DE23' -&gt; tgt then {\r\n      item.answer as a -&gt; tgt.family = a &quot;f&quot;;\r\n    } &quot;bkskm&quot;;\r\n  } &quot;wglfi&quot;;\r\n}\r\n\r\ngroup getIdemcarerelatedpersoncaregiver(source src, target tgt) {\r\n  src.item first as item where linkId = 'emcarerelatedpersoncaregiverid' -&gt; tgt then {\r\n    item.answer first as a -&gt; tgt then {\r\n      a.value as val -&gt; tgt.id = val &quot;tngnb&quot;;\r\n    } &quot;xizvd&quot;;\r\n  } &quot;eyasl&quot;;\r\n}\r\n\r\ngroup getFullUrlemcarerelatedpersoncaregiver(source src, target tgt) {\r\n  src.item first as item where linkId = 'emcarerelatedpersoncaregiverid' -&gt; tgt then {\r\n    item.answer first as a -&gt; tgt then {\r\n      a.value as val -&gt; tgt.fullUrl = append('urn:uuid:', val) &quot;cuwnz&quot;;\r\n    } &quot;iggbx&quot;;\r\n  } &quot;mosdk&quot;;\r\n}\r\n\r\ngroup getUrlemcarerelatedpersoncaregiver(source src, target tgt) {\r\n  src.item first as item where linkId = 'emcarerelatedpersoncaregiverid' -&gt; tgt then {\r\n    item.answer first as a -&gt; tgt then {\r\n      a.value as val -&gt; ref.reference = append('/RelatedPerson/', val) &quot;aojir&quot;;\r\n    } &quot;zgdca&quot;;\r\n  } &quot;nwgrv&quot;;\r\n}\r\n\r\ngroup emcarecommunicationrequestemcareade38(source src, target tgt) {\r\n  src -&gt;  tgt.category = create('CodeableConcept') as cc,  cc.coding = create('Coding') as c,  c.system = 'http://hl7.org/fhir/ValueSet/communication-category',  c.code = 'notification' &quot;qypbh&quot;;\r\n  src.questionnaire as q -&gt;  tgt.about = create('Reference') as ref,  ref.type = 'Questionnaire',  ref.reference = q &quot;quest&quot;;\r\n  src.subject as subject -&gt; tgt.subject = subject &quot;ziugh&quot;;\r\n  src -&gt; tgt.recipient = create('Reference') as ref then {\r\n    src -&gt; ref.type = 'RelatedPerson' &quot;iemvu&quot;;\r\n    src.item first as item where linkId = 'emcarerelatedpersoncaregiverid' -&gt; tgt then {\r\n      item.answer first as a -&gt; tgt then {\r\n        a.value as val -&gt; ref.reference = append('/RelatedPerson/', val) &quot;ndjsd&quot;;\r\n      } &quot;tjwsm&quot;;\r\n    } &quot;ojtfv&quot;;\r\n  } &quot;weelh&quot;;\r\n}\r\n\r\n</pre></div>"
    },
    "url": "https://fhir.dk.swisstph-mis.ch/matchbox/fhir/StructureMap/emcarea.registration.p",
    "name": "emcarea.registration.p",
    "status": "active",
    "structure": [
        {
            "url": "http://hl7.org/fhir/uv/sdc/StructureDefinition/sdc-questionnaireresponse",
            "mode": "source",
            "alias": "'questionnaireResponse'"
        },
        {
            "url": "http://hl7.org/fhir/StructureDefinition/Bundle",
            "mode": "target",
            "alias": "'Bundle'"
        },
        {
            "url": "https://fhir.dk.swisstph-mis.ch/matchbox/fhir/StructureDefinition/patient",
            "mode": "target",
            "alias": "'Patient'"
        },
        {
            "url": "https://fhir.dk.swisstph-mis.ch/matchbox/fhir/StructureDefinition/relatedperson",
            "mode": "target",
            "alias": "'RelatedPerson'"
        },
        {
            "url": "https://fhir.dk.swisstph-mis.ch/matchbox/fhir/StructureDefinition/communicationrequest",
            "mode": "target",
            "alias": "'CommunicationRequest'"
        },
        {
            "url": "https://fhir.dk.swisstph-mis.ch/matchbox/fhir/StructureDefinition/emcarepatient",
            "mode": "produced",
            "alias": "'EmCare Patient'"
        },
        {
            "url": "https://fhir.dk.swisstph-mis.ch/matchbox/fhir/StructureDefinition/emcarerelatedpersoncaregiver",
            "mode": "produced",
            "alias": "'EmCare RelatedPerson Caregiver'"
        },
        {
            "url": "https://fhir.dk.swisstph-mis.ch/matchbox/fhir/StructureDefinition/emcarecommunicationrequest",
            "mode": "produced",
            "alias": "'EmCare CommunicationRequest'"
        }
    ],
    "group": [
        {
            "name": "bundletrans",
            "typeMode": "none",
            "input": [
                {
                    "name": "src",
                    "type": "questionnaireResponse",
                    "mode": "source"
                },
                {
                    "name": "bundle",
                    "type": "Bundle",
                    "mode": "target"
                }
            ],
            "rule": [
                {
                    "name": "id",
                    "source": [
                        {
                            "context": "src"
                        }
                    ],
                    "target": [
                        {
                            "context": "bundle",
                            "contextType": "variable",
                            "element": "id",
                            "transform": "uuid"
                        }
                    ]
                },
                {
                    "name": "type",
                    "source": [
                        {
                            "context": "src"
                        }
                    ],
                    "target": [
                        {
                            "context": "bundle",
                            "contextType": "variable",
                            "element": "type",
                            "transform": "copy",
                            "parameter": [
                                {
                                    "valueString": "batch"
                                }
                            ]
                        }
                    ]
                },
                {
                    "name": "put-emcarepatient",
                    "source": [
                        {
                            "context": "src"
                        }
                    ],
                    "target": [
                        {
                            "context": "bundle",
                            "contextType": "variable",
                            "element": "entry",
                            "variable": "entry"
                        }
                    ],
                    "rule": [
                        {
                            "name": "fmxog",
                            "source": [
                                {
                                    "context": "src",
                                    "element": "subject",
                                    "variable": "subject"
                                }
                            ],
                            "rule": [
                                {
                                    "name": "kuwwh",
                                    "source": [
                                        {
                                            "context": "subject",
                                            "element": "id",
                                            "variable": "idval"
                                        }
                                    ],
                                    "target": [
                                        {
                                            "context": "entry",
                                            "contextType": "variable",
                                            "element": "request",
                                            "variable": "request"
                                        },
                                        {
                                            "context": "request",
                                            "contextType": "variable",
                                            "element": "method",
                                            "transform": "copy",
                                            "parameter": [
                                                {
                                                    "valueString": "PUT"
                                                }
                                            ]
                                        },
                                        {
                                            "context": "request",
                                            "contextType": "variable",
                                            "element": "url",
                                            "transform": "append",
                                            "parameter": [
                                                {
                                                    "valueString": "/Patient/"
                                                },
                                                {
                                                    "valueId": "idval"
                                                }
                                            ]
                                        }
                                    ]
                                }
                            ]
                        },
                        {
                            "name": "vrtdu",
                            "source": [
                                {
                                    "context": "src"
                                }
                            ],
                            "target": [
                                {
                                    "context": "entry",
                                    "contextType": "variable",
                                    "element": "resource",
                                    "variable": "tgt",
                                    "transform": "create",
                                    "parameter": [
                                        {
                                            "valueString": "Patient"
                                        }
                                    ]
                                }
                            ],
                            "rule": [
                                {
                                    "name": "dprxm",
                                    "source": [
                                        {
                                            "context": "src"
                                        }
                                    ],
                                    "target": [
                                        {
                                            "contextType": "variable",
                                            "transform": "copy",
                                            "parameter": [
                                                {
                                                    "valueId": "tgt"
                                                }
                                            ]
                                        }
                                    ],
                                    "dependent": [
                                        {
                                            "name": "emcarepatient",
                                            "variable": [
                                                "src",
                                                "tgt"
                                            ]
                                        }
                                    ]
                                },
                                {
                                    "name": "uaktq",
                                    "source": [
                                        {
                                            "context": "src",
                                            "element": "subject",
                                            "variable": "subject"
                                        }
                                    ],
                                    "rule": [
                                        {
                                            "name": "mnbux",
                                            "source": [
                                                {
                                                    "context": "subject",
                                                    "element": "id",
                                                    "variable": "idval"
                                                }
                                            ],
                                            "target": [
                                                {
                                                    "context": "tgt",
                                                    "contextType": "variable",
                                                    "element": "id",
                                                    "transform": "copy",
                                                    "parameter": [
                                                        {
                                                            "valueId": "idval"
                                                        }
                                                    ]
                                                }
                                            ]
                                        }
                                    ]
                                }
                            ]
                        }
                    ]
                },
                {
                    "name": "put-emcarerelatedpersoncaregiver",
                    "source": [
                        {
                            "context": "src",
                            "condition": "src.item.where(linkId = 'emcarerelatedpersoncaregiverid').answer.exists()"
                        }
                    ],
                    "target": [
                        {
                            "context": "bundle",
                            "contextType": "variable",
                            "element": "entry",
                            "variable": "entry"
                        }
                    ],
                    "rule": [
                        {
                            "name": "shoyc",
                            "source": [
                                {
                                    "context": "src",
                                    "element": "item",
                                    "listMode": "first",
                                    "variable": "item",
                                    "condition": "linkId = 'emcarerelatedpersoncaregiverid'"
                                }
                            ],
                            "target": [
                                {
                                    "context": "entry",
                                    "contextType": "variable",
                                    "element": "request",
                                    "variable": "request"
                                },
                                {
                                    "context": "request",
                                    "contextType": "variable",
                                    "element": "method",
                                    "transform": "copy",
                                    "parameter": [
                                        {
                                            "valueString": "PUT"
                                        }
                                    ]
                                }
                            ],
                            "rule": [
                                {
                                    "name": "sgetz",
                                    "source": [
                                        {
                                            "context": "item",
                                            "element": "answer",
                                            "listMode": "first",
                                            "variable": "a"
                                        }
                                    ],
                                    "target": [
                                        {
                                            "contextType": "variable",
                                            "transform": "copy",
                                            "parameter": [
                                                {
                                                    "valueId": "request"
                                                }
                                            ]
                                        }
                                    ],
                                    "rule": [
                                        {
                                            "name": "bycgp",
                                            "source": [
                                                {
                                                    "context": "a",
                                                    "element": "value",
                                                    "variable": "val"
                                                }
                                            ],
                                            "target": [
                                                {
                                                    "context": "request",
                                                    "contextType": "variable",
                                                    "element": "url",
                                                    "transform": "append",
                                                    "parameter": [
                                                        {
                                                            "valueString": "/RelatedPerson/"
                                                        },
                                                        {
                                                            "valueId": "val"
                                                        }
                                                    ]
                                                }
                                            ]
                                        }
                                    ]
                                }
                            ]
                        },
                        {
                            "name": "zuhsz",
                            "source": [
                                {
                                    "context": "src"
                                }
                            ],
                            "target": [
                                {
                                    "context": "entry",
                                    "contextType": "variable",
                                    "element": "resource",
                                    "variable": "tgt",
                                    "transform": "create",
                                    "parameter": [
                                        {
                                            "valueString": "RelatedPerson"
                                        }
                                    ]
                                }
                            ],
                            "rule": [
                                {
                                    "name": "lrwmm",
                                    "source": [
                                        {
                                            "context": "src"
                                        }
                                    ],
                                    "target": [
                                        {
                                            "contextType": "variable",
                                            "transform": "copy",
                                            "parameter": [
                                                {
                                                    "valueId": "tgt"
                                                }
                                            ]
                                        }
                                    ],
                                    "dependent": [
                                        {
                                            "name": "emcarerelatedpersoncaregiver",
                                            "variable": [
                                                "src",
                                                "tgt"
                                            ]
                                        }
                                    ]
                                },
                                {
                                    "name": "uafdx",
                                    "source": [
                                        {
                                            "context": "src"
                                        }
                                    ],
                                    "target": [
                                        {
                                            "contextType": "variable",
                                            "transform": "copy",
                                            "parameter": [
                                                {
                                                    "valueId": "entry"
                                                }
                                            ]
                                        }
                                    ],
                                    "dependent": [
                                        {
                                            "name": "getIdemcarerelatedpersoncaregiver",
                                            "variable": [
                                                "src",
                                                "tgt"
                                            ]
                                        }
                                    ]
                                }
                            ]
                        }
                    ]
                },
                {
                    "name": "emcarecommunicationrequest",
                    "source": [
                        {
                            "context": "src",
                            "condition": "src.item.where(linkId = 'EmCare.A.DE38').exists() and src.item.where(linkId = 'emcarecommunicationrequestid').first().answer.exists()"
                        }
                    ],
                    "rule": [
                        {
                            "name": "act-EmCare.A.DE38",
                            "source": [
                                {
                                    "context": "src"
                                }
                            ],
                            "target": [
                                {
                                    "context": "bundle",
                                    "contextType": "variable",
                                    "element": "entry",
                                    "variable": "entry"
                                },
                                {
                                    "context": "entry",
                                    "contextType": "variable",
                                    "element": "request",
                                    "variable": "request"
                                },
                                {
                                    "context": "request",
                                    "contextType": "variable",
                                    "element": "method",
                                    "transform": "copy",
                                    "parameter": [
                                        {
                                            "valueString": "POST"
                                        }
                                    ]
                                },
                                {
                                    "context": "entry",
                                    "contextType": "variable",
                                    "element": "resource",
                                    "variable": "tgt",
                                    "transform": "create",
                                    "parameter": [
                                        {
                                            "valueString": "CommunicationRequest"
                                        }
                                    ]
                                }
                            ],
                            "dependent": [
                                {
                                    "name": "emcarecommunicationrequestemcareade38",
                                    "variable": [
                                        "src",
                                        "tgt"
                                    ]
                                }
                            ]
                        }
                    ]
                }
            ]
        },
        {
            "name": "emcarepatient",
            "typeMode": "none",
            "input": [
                {
                    "name": "src",
                    "type": "questionnaireResponse",
                    "mode": "source"
                },
                {
                    "name": "tgt",
                    "type": "Patient",
                    "mode": "target"
                }
            ],
            "rule": [
                {
                    "name": "emcareade01",
                    "source": [
                        {
                            "context": "src",
                            "element": "item",
                            "variable": "item",
                            "condition": "linkId = 'EmCare.A.DE01'"
                        }
                    ],
                    "rule": [
                        {
                            "name": "aemcareade01",
                            "source": [
                                {
                                    "context": "item",
                                    "element": "answer",
                                    "listMode": "first",
                                    "variable": "a"
                                }
                            ],
                            "rule": [
                                {
                                    "name": "aemcareade01",
                                    "source": [
                                        {
                                            "context": "a",
                                            "element": "value",
                                            "variable": "val"
                                        }
                                    ],
                                    "target": [
                                        {
                                            "context": "tgt",
                                            "contextType": "variable",
                                            "element": "identifier",
                                            "variable": "identifier",
                                            "transform": "create",
                                            "parameter": [
                                                {
                                                    "valueString": "Identifier"
                                                }
                                            ]
                                        }
                                    ],
                                    "rule": [
                                        {
                                            "name": "id",
                                            "source": [
                                                {
                                                    "context": "val"
                                                }
                                            ],
                                            "target": [
                                                {
                                                    "context": "identifier",
                                                    "contextType": "variable",
                                                    "element": "value",
                                                    "transform": "copy",
                                                    "parameter": [
                                                        {
                                                            "valueId": "val"
                                                        }
                                                    ]
                                                },
                                                {
                                                    "context": "identifier",
                                                    "contextType": "variable",
                                                    "element": "use",
                                                    "transform": "copy",
                                                    "parameter": [
                                                        {
                                                            "valueString": "official"
                                                        }
                                                    ]
                                                }
                                            ]
                                        }
                                    ]
                                }
                            ]
                        }
                    ]
                },
                {
                    "name": "emcareade03",
                    "source": [
                        {
                            "context": "src",
                            "element": "item",
                            "variable": "item",
                            "condition": "linkId = 'EmCare.A.DE03'"
                        }
                    ],
                    "rule": [
                        {
                            "name": "aemcareade03",
                            "source": [
                                {
                                    "context": "item",
                                    "element": "answer",
                                    "listMode": "first",
                                    "variable": "a"
                                }
                            ],
                            "target": [
                                {
                                    "context": "tgt",
                                    "contextType": "variable",
                                    "element": "identifier",
                                    "variable": "identifier",
                                    "transform": "create",
                                    "parameter": [
                                        {
                                            "valueString": "Identifier"
                                        }
                                    ]
                                }
                            ],
                            "rule": [
                                {
                                    "name": "noid",
                                    "source": [
                                        {
                                            "context": "a"
                                        }
                                    ],
                                    "target": [
                                        {
                                            "context": "identifier",
                                            "contextType": "variable",
                                            "element": "value",
                                            "transform": "copy",
                                            "parameter": [
                                                {
                                                    "valueString": "EmCare.A.DE03"
                                                }
                                            ]
                                        },
                                        {
                                            "context": "identifier",
                                            "contextType": "variable",
                                            "element": "system",
                                            "transform": "copy",
                                            "parameter": [
                                                {
                                                    "valueString": "https://fhir.dk.swisstph-mis.ch/matchbox/fhir/CodeSystem/emcare-custom-codes"
                                                }
                                            ]
                                        }
                                    ]
                                }
                            ]
                        }
                    ]
                },
                {
                    "name": "emcareade04",
                    "source": [
                        {
                            "context": "src",
                            "element": "item",
                            "listMode": "first",
                            "variable": "item",
                            "condition": "(linkId = 'EmCare.A.DE04') or (linkId = 'EmCare.A.DE05') or (linkId = 'EmCare.A.DE06')"
                        }
                    ],
                    "target": [
                        {
                            "contextType": "variable",
                            "variable": "target",
                            "transform": "copy",
                            "parameter": [
                                {
                                    "valueId": "tgt"
                                }
                            ]
                        },
                        {
                            "context": "target",
                            "contextType": "variable",
                            "element": "name",
                            "variable": "name"
                        }
                    ],
                    "dependent": [
                        {
                            "name": "SetOfficalGivenNameemcarepatient",
                            "variable": [
                                "src",
                                "name"
                            ]
                        }
                    ]
                },
                {
                    "name": "emcareade12",
                    "source": [
                        {
                            "context": "src",
                            "element": "item",
                            "variable": "item",
                            "condition": "linkId = 'EmCare.A.DE12'"
                        }
                    ],
                    "rule": [
                        {
                            "name": "aemcareade12",
                            "source": [
                                {
                                    "context": "item",
                                    "element": "answer",
                                    "listMode": "first",
                                    "variable": "a"
                                }
                            ],
                            "rule": [
                                {
                                    "name": "aemcareade12",
                                    "source": [
                                        {
                                            "context": "a",
                                            "element": "value",
                                            "variable": "val"
                                        }
                                    ],
                                    "target": [
                                        {
                                            "context": "tgt",
                                            "contextType": "variable",
                                            "element": "extension",
                                            "variable": "ext",
                                            "transform": "create",
                                            "parameter": [
                                                {
                                                    "valueString": "Extension"
                                                }
                                            ]
                                        },
                                        {
                                            "context": "ext",
                                            "contextType": "variable",
                                            "element": "url",
                                            "transform": "copy",
                                            "parameter": [
                                                {
                                                    "valueString": "https://fhir.dk.swisstph-mis.ch/matchbox/fhir/StructureDefinition/birthDateEstimator"
                                                }
                                            ]
                                        },
                                        {
                                            "context": "ext",
                                            "contextType": "variable",
                                            "element": "value",
                                            "transform": "copy",
                                            "parameter": [
                                                {
                                                    "valueId": "val"
                                                }
                                            ]
                                        }
                                    ]
                                }
                            ]
                        }
                    ]
                },
                {
                    "name": "emcareade08",
                    "source": [
                        {
                            "context": "src",
                            "element": "item",
                            "variable": "item",
                            "condition": "linkId = 'EmCare.A.DE08'"
                        }
                    ],
                    "rule": [
                        {
                            "name": "aemcareade08",
                            "source": [
                                {
                                    "context": "item",
                                    "element": "answer",
                                    "listMode": "first",
                                    "variable": "a"
                                }
                            ],
                            "rule": [
                                {
                                    "name": "aemcareade08",
                                    "source": [
                                        {
                                            "context": "a",
                                            "element": "value",
                                            "variable": "val"
                                        }
                                    ],
                                    "target": [
                                        {
                                            "context": "tgt",
                                            "contextType": "variable",
                                            "element": "birthDate",
                                            "transform": "copy",
                                            "parameter": [
                                                {
                                                    "valueId": "val"
                                                }
                                            ]
                                        }
                                    ]
                                }
                            ]
                        }
                    ]
                },
                {
                    "name": "emcareade16",
                    "source": [
                        {
                            "context": "src",
                            "element": "item",
                            "variable": "item",
                            "condition": "linkId = 'EmCare.A.DE16'"
                        }
                    ],
                    "rule": [
                        {
                            "name": "emcareade16d",
                            "source": [
                                {
                                    "context": "item",
                                    "element": "answer",
                                    "listMode": "first",
                                    "variable": "a"
                                }
                            ],
                            "dependent": [
                                {
                                    "name": "MapValueSetExtCodeemcareade16",
                                    "variable": [
                                        "a",
                                        "tgt"
                                    ]
                                }
                            ]
                        }
                    ]
                },
                {
                    "name": "emcareade20",
                    "source": [
                        {
                            "context": "src",
                            "element": "item",
                            "variable": "item",
                            "condition": "linkId = 'EmCare.A.DE20'"
                        }
                    ],
                    "rule": [
                        {
                            "name": "aemcareade20",
                            "source": [
                                {
                                    "context": "item",
                                    "element": "answer",
                                    "listMode": "first",
                                    "variable": "a"
                                }
                            ],
                            "rule": [
                                {
                                    "name": "aemcareade20",
                                    "source": [
                                        {
                                            "context": "a",
                                            "element": "value",
                                            "variable": "val"
                                        }
                                    ],
                                    "target": [
                                        {
                                            "context": "tgt",
                                            "contextType": "variable",
                                            "element": "address",
                                            "variable": "address"
                                        },
                                        {
                                            "context": "address",
                                            "contextType": "variable",
                                            "element": "text",
                                            "transform": "copy",
                                            "parameter": [
                                                {
                                                    "valueId": "val"
                                                }
                                            ]
                                        }
                                    ]
                                }
                            ]
                        }
                    ]
                },
                {
                    "name": "emcareade47",
                    "source": [
                        {
                            "context": "src",
                            "element": "item",
                            "variable": "item",
                            "condition": "linkId = 'EmCare.A.DE47'"
                        }
                    ],
                    "rule": [
                        {
                            "name": "aemcareade47",
                            "source": [
                                {
                                    "context": "item",
                                    "element": "answer",
                                    "listMode": "first",
                                    "variable": "a"
                                }
                            ],
                            "rule": [
                                {
                                    "name": "aemcareade47",
                                    "source": [
                                        {
                                            "context": "a",
                                            "element": "value",
                                            "variable": "val"
                                        }
                                    ],
                                    "target": [
                                        {
                                            "context": "tgt",
                                            "contextType": "variable",
                                            "element": "extension",
                                            "variable": "ext",
                                            "transform": "create",
                                            "parameter": [
                                                {
                                                    "valueString": "Extension"
                                                }
                                            ]
                                        },
                                        {
                                            "context": "ext",
                                            "contextType": "variable",
                                            "element": "url",
                                            "transform": "copy",
                                            "parameter": [
                                                {
                                                    "valueString": "https://fhir.dk.swisstph-mis.ch/matchbox/fhir/StructureDefinition/caregiver"
                                                }
                                            ]
                                        },
                                        {
                                            "context": "ext",
                                            "contextType": "variable",
                                            "element": "value",
                                            "transform": "copy",
                                            "parameter": [
                                                {
                                                    "valueId": "val"
                                                }
                                            ]
                                        }
                                    ]
                                }
                            ]
                        }
                    ]
                },
                {
                    "name": "emcareade31",
                    "source": [
                        {
                            "context": "src",
                            "element": "item",
                            "variable": "item",
                            "condition": "linkId = 'EmCare.A.DE31'"
                        }
                    ],
                    "rule": [
                        {
                            "name": "aemcareade31",
                            "source": [
                                {
                                    "context": "item",
                                    "element": "answer",
                                    "listMode": "first",
                                    "variable": "a"
                                }
                            ],
                            "rule": [
                                {
                                    "name": "aemcareade31",
                                    "source": [
                                        {
                                            "context": "a",
                                            "element": "value",
                                            "variable": "val"
                                        }
                                    ],
                                    "target": [
                                        {
                                            "context": "tgt",
                                            "contextType": "variable",
                                            "element": "extension",
                                            "variable": "ext",
                                            "transform": "create",
                                            "parameter": [
                                                {
                                                    "valueString": "Extension"
                                                }
                                            ]
                                        },
                                        {
                                            "context": "ext",
                                            "contextType": "variable",
                                            "element": "url",
                                            "transform": "copy",
                                            "parameter": [
                                                {
                                                    "valueString": "https://fhir.dk.swisstph-mis.ch/matchbox/fhir/Extension/motherVitalStatus"
                                                }
                                            ]
                                        },
                                        {
                                            "context": "ext",
                                            "contextType": "variable",
                                            "element": "value",
                                            "transform": "copy",
                                            "parameter": [
                                                {
                                                    "valueId": "val"
                                                }
                                            ]
                                        }
                                    ]
                                }
                            ]
                        }
                    ]
                },
                {
                    "name": "emcareade32",
                    "source": [
                        {
                            "context": "src",
                            "element": "item",
                            "variable": "item",
                            "condition": "linkId = 'EmCare.A.DE32'"
                        }
                    ],
                    "rule": [
                        {
                            "name": "aemcareade32",
                            "source": [
                                {
                                    "context": "item",
                                    "element": "answer",
                                    "listMode": "first",
                                    "variable": "a"
                                }
                            ],
                            "rule": [
                                {
                                    "name": "aemcareade32",
                                    "source": [
                                        {
                                            "context": "a",
                                            "element": "value",
                                            "variable": "val"
                                        }
                                    ],
                                    "target": [
                                        {
                                            "context": "tgt",
                                            "contextType": "variable",
                                            "element": "extension",
                                            "variable": "ext",
                                            "transform": "create",
                                            "parameter": [
                                                {
                                                    "valueString": "Extension"
                                                }
                                            ]
                                        },
                                        {
                                            "context": "ext",
                                            "contextType": "variable",
                                            "element": "url",
                                            "transform": "copy",
                                            "parameter": [
                                                {
                                                    "valueString": "https://fhir.dk.swisstph-mis.ch/matchbox/fhir/Extension/fatherVitalStatus"
                                                }
                                            ]
                                        },
                                        {
                                            "context": "ext",
                                            "contextType": "variable",
                                            "element": "value",
                                            "transform": "copy",
                                            "parameter": [
                                                {
                                                    "valueId": "val"
                                                }
                                            ]
                                        }
                                    ]
                                }
                            ]
                        }
                    ]
                }
            ]
        },
        {
            "name": "SetOfficalGivenNameemcarepatient",
            "typeMode": "none",
            "input": [
                {
                    "name": "src",
                    "mode": "source"
                },
                {
                    "name": "tgt",
                    "mode": "target"
                }
            ],
            "rule": [
                {
                    "name": "uxgid",
                    "source": [
                        {
                            "context": "src"
                        }
                    ],
                    "target": [
                        {
                            "context": "tgt",
                            "contextType": "variable",
                            "element": "use",
                            "transform": "copy",
                            "parameter": [
                                {
                                    "valueString": "official"
                                }
                            ]
                        }
                    ],
                    "rule": [
                        {
                            "name": "ugaqc",
                            "source": [
                                {
                                    "context": "src",
                                    "element": "item",
                                    "variable": "item",
                                    "condition": "linkId = 'EmCare.A.DE04'"
                                }
                            ],
                            "target": [
                                {
                                    "contextType": "variable",
                                    "transform": "copy",
                                    "parameter": [
                                        {
                                            "valueId": "tgt"
                                        }
                                    ]
                                }
                            ],
                            "rule": [
                                {
                                    "name": "f",
                                    "source": [
                                        {
                                            "context": "item",
                                            "element": "answer",
                                            "variable": "a"
                                        }
                                    ],
                                    "target": [
                                        {
                                            "context": "tgt",
                                            "contextType": "variable",
                                            "element": "given",
                                            "transform": "copy",
                                            "parameter": [
                                                {
                                                    "valueId": "a"
                                                }
                                            ]
                                        }
                                    ]
                                }
                            ]
                        },
                        {
                            "name": "jasqq",
                            "source": [
                                {
                                    "context": "src",
                                    "element": "item",
                                    "variable": "item",
                                    "condition": "linkId = 'EmCare.A.DE05'"
                                }
                            ],
                            "target": [
                                {
                                    "contextType": "variable",
                                    "transform": "copy",
                                    "parameter": [
                                        {
                                            "valueId": "tgt"
                                        }
                                    ]
                                }
                            ],
                            "rule": [
                                {
                                    "name": "f",
                                    "source": [
                                        {
                                            "context": "item",
                                            "element": "answer",
                                            "variable": "a"
                                        }
                                    ],
                                    "target": [
                                        {
                                            "context": "tgt",
                                            "contextType": "variable",
                                            "element": "given",
                                            "transform": "copy",
                                            "parameter": [
                                                {
                                                    "valueId": "a"
                                                }
                                            ]
                                        }
                                    ]
                                }
                            ]
                        },
                        {
                            "name": "awfpx",
                            "source": [
                                {
                                    "context": "src",
                                    "element": "item",
                                    "variable": "item",
                                    "condition": "linkId = 'EmCare.A.DE06'"
                                }
                            ],
                            "target": [
                                {
                                    "contextType": "variable",
                                    "transform": "copy",
                                    "parameter": [
                                        {
                                            "valueId": "tgt"
                                        }
                                    ]
                                }
                            ],
                            "rule": [
                                {
                                    "name": "f",
                                    "source": [
                                        {
                                            "context": "item",
                                            "element": "answer",
                                            "variable": "a"
                                        }
                                    ],
                                    "target": [
                                        {
                                            "context": "tgt",
                                            "contextType": "variable",
                                            "element": "family",
                                            "transform": "copy",
                                            "parameter": [
                                                {
                                                    "valueId": "a"
                                                }
                                            ]
                                        }
                                    ]
                                }
                            ]
                        }
                    ]
                }
            ]
        },
        {
            "name": "MapValueSetExtCodeemcareade16",
            "typeMode": "none",
            "input": [
                {
                    "name": "src",
                    "mode": "source"
                },
                {
                    "name": "tgt",
                    "mode": "target"
                }
            ],
            "rule": [
                {
                    "name": "njupl",
                    "source": [
                        {
                            "context": "src"
                        }
                    ],
                    "target": [
                        {
                            "contextType": "variable",
                            "transform": "copy",
                            "parameter": [
                                {
                                    "valueId": "tgt"
                                }
                            ]
                        }
                    ],
                    "rule": [
                        {
                            "name": "mapbase",
                            "source": [
                                {
                                    "context": "src"
                                }
                            ],
                            "target": [
                                {
                                    "contextType": "variable",
                                    "transform": "copy",
                                    "parameter": [
                                        {
                                            "valueId": "tgt"
                                        }
                                    ]
                                }
                            ],
                            "rule": [
                                {
                                    "name": "ngigi",
                                    "source": [
                                        {
                                            "context": "src",
                                            "condition": "value.code = 'EmCare.A.DE17'"
                                        }
                                    ],
                                    "target": [
                                        {
                                            "context": "tgt",
                                            "contextType": "variable",
                                            "element": "gender",
                                            "transform": "copy",
                                            "parameter": [
                                                {
                                                    "valueString": "female"
                                                }
                                            ]
                                        }
                                    ]
                                },
                                {
                                    "name": "ltogs",
                                    "source": [
                                        {
                                            "context": "src",
                                            "condition": "value.code = 'EmCare.A.DE18'"
                                        }
                                    ],
                                    "target": [
                                        {
                                            "context": "tgt",
                                            "contextType": "variable",
                                            "element": "gender",
                                            "transform": "copy",
                                            "parameter": [
                                                {
                                                    "valueString": "male"
                                                }
                                            ]
                                        }
                                    ]
                                },
                                {
                                    "name": "qjlgw",
                                    "source": [
                                        {
                                            "context": "src",
                                            "condition": "value.code = 'EmCare.A.DE19'"
                                        }
                                    ],
                                    "target": [
                                        {
                                            "context": "tgt",
                                            "contextType": "variable",
                                            "element": "gender",
                                            "transform": "copy",
                                            "parameter": [
                                                {
                                                    "valueString": "unknown"
                                                }
                                            ]
                                        }
                                    ]
                                }
                            ]
                        }
                    ]
                }
            ]
        },
        {
            "name": "getIdemcarepatient",
            "typeMode": "none",
            "input": [
                {
                    "name": "src",
                    "mode": "source"
                },
                {
                    "name": "tgt",
                    "mode": "target"
                }
            ],
            "rule": [
                {
                    "name": "ftjcj",
                    "source": [
                        {
                            "context": "src",
                            "element": "item",
                            "listMode": "first",
                            "variable": "item",
                            "condition": "linkId = 'emcarepatientid'"
                        }
                    ],
                    "target": [
                        {
                            "contextType": "variable",
                            "transform": "copy",
                            "parameter": [
                                {
                                    "valueId": "tgt"
                                }
                            ]
                        }
                    ],
                    "rule": [
                        {
                            "name": "cbqcj",
                            "source": [
                                {
                                    "context": "item",
                                    "element": "answer",
                                    "listMode": "first",
                                    "variable": "a"
                                }
                            ],
                            "target": [
                                {
                                    "contextType": "variable",
                                    "transform": "copy",
                                    "parameter": [
                                        {
                                            "valueId": "tgt"
                                        }
                                    ]
                                }
                            ],
                            "rule": [
                                {
                                    "name": "rzbmr",
                                    "source": [
                                        {
                                            "context": "a",
                                            "element": "value",
                                            "variable": "val"
                                        }
                                    ],
                                    "target": [
                                        {
                                            "context": "tgt",
                                            "contextType": "variable",
                                            "element": "id",
                                            "transform": "copy",
                                            "parameter": [
                                                {
                                                    "valueId": "val"
                                                }
                                            ]
                                        }
                                    ]
                                }
                            ]
                        }
                    ]
                }
            ]
        },
        {
            "name": "getFullUrlemcarepatient",
            "typeMode": "none",
            "input": [
                {
                    "name": "src",
                    "mode": "source"
                },
                {
                    "name": "tgt",
                    "mode": "target"
                }
            ],
            "rule": [
                {
                    "name": "dtbzk",
                    "source": [
                        {
                            "context": "src",
                            "element": "item",
                            "listMode": "first",
                            "variable": "item",
                            "condition": "linkId = 'emcarepatientid'"
                        }
                    ],
                    "target": [
                        {
                            "contextType": "variable",
                            "transform": "copy",
                            "parameter": [
                                {
                                    "valueId": "tgt"
                                }
                            ]
                        }
                    ],
                    "rule": [
                        {
                            "name": "acxap",
                            "source": [
                                {
                                    "context": "item",
                                    "element": "answer",
                                    "listMode": "first",
                                    "variable": "a"
                                }
                            ],
                            "target": [
                                {
                                    "contextType": "variable",
                                    "transform": "copy",
                                    "parameter": [
                                        {
                                            "valueId": "tgt"
                                        }
                                    ]
                                }
                            ],
                            "rule": [
                                {
                                    "name": "lghyd",
                                    "source": [
                                        {
                                            "context": "a",
                                            "element": "value",
                                            "variable": "val"
                                        }
                                    ],
                                    "target": [
                                        {
                                            "context": "tgt",
                                            "contextType": "variable",
                                            "element": "fullUrl",
                                            "transform": "append",
                                            "parameter": [
                                                {
                                                    "valueString": "urn:uuid:"
                                                },
                                                {
                                                    "valueId": "val"
                                                }
                                            ]
                                        }
                                    ]
                                }
                            ]
                        }
                    ]
                }
            ]
        },
        {
            "name": "getUrlemcarepatient",
            "typeMode": "none",
            "input": [
                {
                    "name": "src",
                    "mode": "source"
                },
                {
                    "name": "tgt",
                    "mode": "target"
                }
            ],
            "rule": [
                {
                    "name": "fmheg",
                    "source": [
                        {
                            "context": "src",
                            "element": "item",
                            "listMode": "first",
                            "variable": "item",
                            "condition": "linkId = 'emcarepatientid'"
                        }
                    ],
                    "target": [
                        {
                            "contextType": "variable",
                            "transform": "copy",
                            "parameter": [
                                {
                                    "valueId": "tgt"
                                }
                            ]
                        }
                    ],
                    "rule": [
                        {
                            "name": "ajmew",
                            "source": [
                                {
                                    "context": "item",
                                    "element": "answer",
                                    "listMode": "first",
                                    "variable": "a"
                                }
                            ],
                            "target": [
                                {
                                    "contextType": "variable",
                                    "transform": "copy",
                                    "parameter": [
                                        {
                                            "valueId": "tgt"
                                        }
                                    ]
                                }
                            ],
                            "rule": [
                                {
                                    "name": "tujvi",
                                    "source": [
                                        {
                                            "context": "a",
                                            "element": "value",
                                            "variable": "val"
                                        }
                                    ],
                                    "target": [
                                        {
                                            "context": "ref",
                                            "contextType": "variable",
                                            "element": "reference",
                                            "transform": "append",
                                            "parameter": [
                                                {
                                                    "valueString": "/Patient/"
                                                },
                                                {
                                                    "valueId": "val"
                                                }
                                            ]
                                        }
                                    ]
                                }
                            ]
                        }
                    ]
                }
            ]
        },
        {
            "name": "emcarerelatedpersoncaregiver",
            "typeMode": "none",
            "input": [
                {
                    "name": "src",
                    "type": "questionnaireResponse",
                    "mode": "source"
                },
                {
                    "name": "tgt",
                    "type": "RelatedPerson",
                    "mode": "target"
                }
            ],
            "rule": [
                {
                    "name": "emcareade21",
                    "source": [
                        {
                            "context": "src",
                            "element": "item",
                            "listMode": "first",
                            "variable": "item",
                            "condition": "(linkId = 'EmCare.A.DE21') or (linkId = 'EmCare.A.DE22') or (linkId = 'EmCare.A.DE23')"
                        }
                    ],
                    "target": [
                        {
                            "contextType": "variable",
                            "variable": "target",
                            "transform": "copy",
                            "parameter": [
                                {
                                    "valueId": "tgt"
                                }
                            ]
                        },
                        {
                            "context": "target",
                            "contextType": "variable",
                            "element": "name",
                            "variable": "name"
                        }
                    ],
                    "dependent": [
                        {
                            "name": "SetOfficalGivenNameemcarerelatedpersoncaregiver",
                            "variable": [
                                "src",
                                "name"
                            ]
                        }
                    ]
                },
                {
                    "name": "emcareade35",
                    "source": [
                        {
                            "context": "src",
                            "element": "item",
                            "variable": "item",
                            "condition": "linkId = 'EmCare.A.DE35'"
                        }
                    ],
                    "rule": [
                        {
                            "name": "aemcareade35",
                            "source": [
                                {
                                    "context": "item",
                                    "element": "answer",
                                    "listMode": "first",
                                    "variable": "a"
                                }
                            ],
                            "rule": [
                                {
                                    "name": "aemcareade35",
                                    "source": [
                                        {
                                            "context": "a",
                                            "element": "value",
                                            "variable": "val"
                                        }
                                    ],
                                    "target": [
                                        {
                                            "context": "tgt",
                                            "contextType": "variable",
                                            "element": "telecom",
                                            "variable": "tel"
                                        },
                                        {
                                            "context": "tel",
                                            "contextType": "variable",
                                            "element": "system",
                                            "transform": "copy",
                                            "parameter": [
                                                {
                                                    "valueString": "phone"
                                                }
                                            ]
                                        },
                                        {
                                            "context": "tel",
                                            "contextType": "variable",
                                            "element": "use",
                                            "transform": "copy",
                                            "parameter": [
                                                {
                                                    "valueString": "mobile"
                                                }
                                            ]
                                        },
                                        {
                                            "context": "tel",
                                            "contextType": "variable",
                                            "element": "value",
                                            "transform": "copy",
                                            "parameter": [
                                                {
                                                    "valueId": "val"
                                                }
                                            ]
                                        }
                                    ]
                                }
                            ]
                        }
                    ]
                },
                {
                    "name": "emcareade36",
                    "source": [
                        {
                            "context": "src",
                            "element": "item",
                            "variable": "item",
                            "condition": "linkId = 'EmCare.A.DE36'"
                        }
                    ],
                    "rule": [
                        {
                            "name": "aemcareade36",
                            "source": [
                                {
                                    "context": "item",
                                    "element": "answer",
                                    "listMode": "first",
                                    "variable": "a"
                                }
                            ],
                            "rule": [
                                {
                                    "name": "aemcareade36",
                                    "source": [
                                        {
                                            "context": "a",
                                            "element": "value",
                                            "variable": "val"
                                        }
                                    ],
                                    "target": [
                                        {
                                            "context": "tgt",
                                            "contextType": "variable",
                                            "element": "telecom",
                                            "variable": "tel"
                                        },
                                        {
                                            "context": "tel",
                                            "contextType": "variable",
                                            "element": "system",
                                            "transform": "copy",
                                            "parameter": [
                                                {
                                                    "valueString": "phone"
                                                }
                                            ]
                                        },
                                        {
                                            "context": "tel",
                                            "contextType": "variable",
                                            "element": "use",
                                            "transform": "copy",
                                            "parameter": [
                                                {
                                                    "valueString": "home"
                                                }
                                            ]
                                        },
                                        {
                                            "context": "tel",
                                            "contextType": "variable",
                                            "element": "value",
                                            "transform": "copy",
                                            "parameter": [
                                                {
                                                    "valueId": "val"
                                                }
                                            ]
                                        }
                                    ]
                                }
                            ]
                        }
                    ]
                },
                {
                    "name": "emcareade37",
                    "source": [
                        {
                            "context": "src",
                            "element": "item",
                            "variable": "item",
                            "condition": "linkId = 'EmCare.A.DE37'"
                        }
                    ],
                    "rule": [
                        {
                            "name": "aemcareade37",
                            "source": [
                                {
                                    "context": "item",
                                    "element": "answer",
                                    "listMode": "first",
                                    "variable": "a"
                                }
                            ],
                            "rule": [
                                {
                                    "name": "aemcareade37",
                                    "source": [
                                        {
                                            "context": "a",
                                            "element": "value",
                                            "variable": "val"
                                        }
                                    ],
                                    "target": [
                                        {
                                            "context": "tgt",
                                            "contextType": "variable",
                                            "element": "telecom",
                                            "variable": "tel"
                                        },
                                        {
                                            "context": "tel",
                                            "contextType": "variable",
                                            "element": "system",
                                            "transform": "copy",
                                            "parameter": [
                                                {
                                                    "valueString": "phone"
                                                }
                                            ]
                                        },
                                        {
                                            "context": "tel",
                                            "contextType": "variable",
                                            "element": "use",
                                            "transform": "copy",
                                            "parameter": [
                                                {
                                                    "valueString": "work"
                                                }
                                            ]
                                        },
                                        {
                                            "context": "tel",
                                            "contextType": "variable",
                                            "element": "value",
                                            "transform": "copy",
                                            "parameter": [
                                                {
                                                    "valueId": "val"
                                                }
                                            ]
                                        }
                                    ]
                                }
                            ]
                        }
                    ]
                }
            ]
        },
        {
            "name": "SetOfficalGivenNameemcarerelatedpersoncaregiver",
            "typeMode": "none",
            "input": [
                {
                    "name": "src",
                    "mode": "source"
                },
                {
                    "name": "tgt",
                    "mode": "target"
                }
            ],
            "rule": [
                {
                    "name": "wglfi",
                    "source": [
                        {
                            "context": "src"
                        }
                    ],
                    "target": [
                        {
                            "context": "tgt",
                            "contextType": "variable",
                            "element": "use",
                            "transform": "copy",
                            "parameter": [
                                {
                                    "valueString": "official"
                                }
                            ]
                        }
                    ],
                    "rule": [
                        {
                            "name": "bnznk",
                            "source": [
                                {
                                    "context": "src",
                                    "element": "item",
                                    "variable": "item",
                                    "condition": "linkId = 'EmCare.A.DE21'"
                                }
                            ],
                            "target": [
                                {
                                    "contextType": "variable",
                                    "transform": "copy",
                                    "parameter": [
                                        {
                                            "valueId": "tgt"
                                        }
                                    ]
                                }
                            ],
                            "rule": [
                                {
                                    "name": "f",
                                    "source": [
                                        {
                                            "context": "item",
                                            "element": "answer",
                                            "variable": "a"
                                        }
                                    ],
                                    "target": [
                                        {
                                            "context": "tgt",
                                            "contextType": "variable",
                                            "element": "given",
                                            "transform": "copy",
                                            "parameter": [
                                                {
                                                    "valueId": "a"
                                                }
                                            ]
                                        }
                                    ]
                                }
                            ]
                        },
                        {
                            "name": "wjnzu",
                            "source": [
                                {
                                    "context": "src",
                                    "element": "item",
                                    "variable": "item",
                                    "condition": "linkId = 'EmCare.A.DE22'"
                                }
                            ],
                            "target": [
                                {
                                    "contextType": "variable",
                                    "transform": "copy",
                                    "parameter": [
                                        {
                                            "valueId": "tgt"
                                        }
                                    ]
                                }
                            ],
                            "rule": [
                                {
                                    "name": "f",
                                    "source": [
                                        {
                                            "context": "item",
                                            "element": "answer",
                                            "variable": "a"
                                        }
                                    ],
                                    "target": [
                                        {
                                            "context": "tgt",
                                            "contextType": "variable",
                                            "element": "given",
                                            "transform": "copy",
                                            "parameter": [
                                                {
                                                    "valueId": "a"
                                                }
                                            ]
                                        }
                                    ]
                                }
                            ]
                        },
                        {
                            "name": "bkskm",
                            "source": [
                                {
                                    "context": "src",
                                    "element": "item",
                                    "variable": "item",
                                    "condition": "linkId = 'EmCare.A.DE23'"
                                }
                            ],
                            "target": [
                                {
                                    "contextType": "variable",
                                    "transform": "copy",
                                    "parameter": [
                                        {
                                            "valueId": "tgt"
                                        }
                                    ]
                                }
                            ],
                            "rule": [
                                {
                                    "name": "f",
                                    "source": [
                                        {
                                            "context": "item",
                                            "element": "answer",
                                            "variable": "a"
                                        }
                                    ],
                                    "target": [
                                        {
                                            "context": "tgt",
                                            "contextType": "variable",
                                            "element": "family",
                                            "transform": "copy",
                                            "parameter": [
                                                {
                                                    "valueId": "a"
                                                }
                                            ]
                                        }
                                    ]
                                }
                            ]
                        }
                    ]
                }
            ]
        },
        {
            "name": "getIdemcarerelatedpersoncaregiver",
            "typeMode": "none",
            "input": [
                {
                    "name": "src",
                    "mode": "source"
                },
                {
                    "name": "tgt",
                    "mode": "target"
                }
            ],
            "rule": [
                {
                    "name": "eyasl",
                    "source": [
                        {
                            "context": "src",
                            "element": "item",
                            "listMode": "first",
                            "variable": "item",
                            "condition": "linkId = 'emcarerelatedpersoncaregiverid'"
                        }
                    ],
                    "target": [
                        {
                            "contextType": "variable",
                            "transform": "copy",
                            "parameter": [
                                {
                                    "valueId": "tgt"
                                }
                            ]
                        }
                    ],
                    "rule": [
                        {
                            "name": "xizvd",
                            "source": [
                                {
                                    "context": "item",
                                    "element": "answer",
                                    "listMode": "first",
                                    "variable": "a"
                                }
                            ],
                            "target": [
                                {
                                    "contextType": "variable",
                                    "transform": "copy",
                                    "parameter": [
                                        {
                                            "valueId": "tgt"
                                        }
                                    ]
                                }
                            ],
                            "rule": [
                                {
                                    "name": "tngnb",
                                    "source": [
                                        {
                                            "context": "a",
                                            "element": "value",
                                            "variable": "val"
                                        }
                                    ],
                                    "target": [
                                        {
                                            "context": "tgt",
                                            "contextType": "variable",
                                            "element": "id",
                                            "transform": "copy",
                                            "parameter": [
                                                {
                                                    "valueId": "val"
                                                }
                                            ]
                                        }
                                    ]
                                }
                            ]
                        }
                    ]
                }
            ]
        },
        {
            "name": "getFullUrlemcarerelatedpersoncaregiver",
            "typeMode": "none",
            "input": [
                {
                    "name": "src",
                    "mode": "source"
                },
                {
                    "name": "tgt",
                    "mode": "target"
                }
            ],
            "rule": [
                {
                    "name": "mosdk",
                    "source": [
                        {
                            "context": "src",
                            "element": "item",
                            "listMode": "first",
                            "variable": "item",
                            "condition": "linkId = 'emcarerelatedpersoncaregiverid'"
                        }
                    ],
                    "target": [
                        {
                            "contextType": "variable",
                            "transform": "copy",
                            "parameter": [
                                {
                                    "valueId": "tgt"
                                }
                            ]
                        }
                    ],
                    "rule": [
                        {
                            "name": "iggbx",
                            "source": [
                                {
                                    "context": "item",
                                    "element": "answer",
                                    "listMode": "first",
                                    "variable": "a"
                                }
                            ],
                            "target": [
                                {
                                    "contextType": "variable",
                                    "transform": "copy",
                                    "parameter": [
                                        {
                                            "valueId": "tgt"
                                        }
                                    ]
                                }
                            ],
                            "rule": [
                                {
                                    "name": "cuwnz",
                                    "source": [
                                        {
                                            "context": "a",
                                            "element": "value",
                                            "variable": "val"
                                        }
                                    ],
                                    "target": [
                                        {
                                            "context": "tgt",
                                            "contextType": "variable",
                                            "element": "fullUrl",
                                            "transform": "append",
                                            "parameter": [
                                                {
                                                    "valueString": "urn:uuid:"
                                                },
                                                {
                                                    "valueId": "val"
                                                }
                                            ]
                                        }
                                    ]
                                }
                            ]
                        }
                    ]
                }
            ]
        },
        {
            "name": "getUrlemcarerelatedpersoncaregiver",
            "typeMode": "none",
            "input": [
                {
                    "name": "src",
                    "mode": "source"
                },
                {
                    "name": "tgt",
                    "mode": "target"
                }
            ],
            "rule": [
                {
                    "name": "nwgrv",
                    "source": [
                        {
                            "context": "src",
                            "element": "item",
                            "listMode": "first",
                            "variable": "item",
                            "condition": "linkId = 'emcarerelatedpersoncaregiverid'"
                        }
                    ],
                    "target": [
                        {
                            "contextType": "variable",
                            "transform": "copy",
                            "parameter": [
                                {
                                    "valueId": "tgt"
                                }
                            ]
                        }
                    ],
                    "rule": [
                        {
                            "name": "zgdca",
                            "source": [
                                {
                                    "context": "item",
                                    "element": "answer",
                                    "listMode": "first",
                                    "variable": "a"
                                }
                            ],
                            "target": [
                                {
                                    "contextType": "variable",
                                    "transform": "copy",
                                    "parameter": [
                                        {
                                            "valueId": "tgt"
                                        }
                                    ]
                                }
                            ],
                            "rule": [
                                {
                                    "name": "aojir",
                                    "source": [
                                        {
                                            "context": "a",
                                            "element": "value",
                                            "variable": "val"
                                        }
                                    ],
                                    "target": [
                                        {
                                            "context": "ref",
                                            "contextType": "variable",
                                            "element": "reference",
                                            "transform": "append",
                                            "parameter": [
                                                {
                                                    "valueString": "/RelatedPerson/"
                                                },
                                                {
                                                    "valueId": "val"
                                                }
                                            ]
                                        }
                                    ]
                                }
                            ]
                        }
                    ]
                }
            ]
        },
        {
            "name": "emcarecommunicationrequestemcareade38",
            "typeMode": "none",
            "input": [
                {
                    "name": "src",
                    "mode": "source"
                },
                {
                    "name": "tgt",
                    "mode": "target"
                }
            ],
            "rule": [
                {
                    "name": "qypbh",
                    "source": [
                        {
                            "context": "src"
                        }
                    ],
                    "target": [
                        {
                            "context": "tgt",
                            "contextType": "variable",
                            "element": "category",
                            "variable": "cc",
                            "transform": "create",
                            "parameter": [
                                {
                                    "valueString": "CodeableConcept"
                                }
                            ]
                        },
                        {
                            "context": "cc",
                            "contextType": "variable",
                            "element": "coding",
                            "variable": "c",
                            "transform": "create",
                            "parameter": [
                                {
                                    "valueString": "Coding"
                                }
                            ]
                        },
                        {
                            "context": "c",
                            "contextType": "variable",
                            "element": "system",
                            "transform": "copy",
                            "parameter": [
                                {
                                    "valueString": "http://hl7.org/fhir/ValueSet/communication-category"
                                }
                            ]
                        },
                        {
                            "context": "c",
                            "contextType": "variable",
                            "element": "code",
                            "transform": "copy",
                            "parameter": [
                                {
                                    "valueString": "notification"
                                }
                            ]
                        }
                    ]
                },
                {
                    "name": "quest",
                    "source": [
                        {
                            "context": "src",
                            "element": "questionnaire",
                            "variable": "q"
                        }
                    ],
                    "target": [
                        {
                            "context": "tgt",
                            "contextType": "variable",
                            "element": "about",
                            "variable": "ref",
                            "transform": "create",
                            "parameter": [
                                {
                                    "valueString": "Reference"
                                }
                            ]
                        },
                        {
                            "context": "ref",
                            "contextType": "variable",
                            "element": "type",
                            "transform": "copy",
                            "parameter": [
                                {
                                    "valueString": "Questionnaire"
                                }
                            ]
                        },
                        {
                            "context": "ref",
                            "contextType": "variable",
                            "element": "reference",
                            "transform": "copy",
                            "parameter": [
                                {
                                    "valueId": "q"
                                }
                            ]
                        }
                    ]
                },
                {
                    "name": "ziugh",
                    "source": [
                        {
                            "context": "src",
                            "element": "subject",
                            "variable": "subject"
                        }
                    ],
                    "target": [
                        {
                            "context": "tgt",
                            "contextType": "variable",
                            "element": "subject",
                            "transform": "copy",
                            "parameter": [
                                {
                                    "valueId": "subject"
                                }
                            ]
                        }
                    ]
                },
                {
                    "name": "weelh",
                    "source": [
                        {
                            "context": "src"
                        }
                    ],
                    "target": [
                        {
                            "context": "tgt",
                            "contextType": "variable",
                            "element": "recipient",
                            "variable": "ref",
                            "transform": "create",
                            "parameter": [
                                {
                                    "valueString": "Reference"
                                }
                            ]
                        }
                    ],
                    "rule": [
                        {
                            "name": "iemvu",
                            "source": [
                                {
                                    "context": "src"
                                }
                            ],
                            "target": [
                                {
                                    "context": "ref",
                                    "contextType": "variable",
                                    "element": "type",
                                    "transform": "copy",
                                    "parameter": [
                                        {
                                            "valueString": "RelatedPerson"
                                        }
                                    ]
                                }
                            ]
                        },
                        {
                            "name": "ojtfv",
                            "source": [
                                {
                                    "context": "src",
                                    "element": "item",
                                    "listMode": "first",
                                    "variable": "item",
                                    "condition": "linkId = 'emcarerelatedpersoncaregiverid'"
                                }
                            ],
                            "target": [
                                {
                                    "contextType": "variable",
                                    "transform": "copy",
                                    "parameter": [
                                        {
                                            "valueId": "tgt"
                                        }
                                    ]
                                }
                            ],
                            "rule": [
                                {
                                    "name": "tjwsm",
                                    "source": [
                                        {
                                            "context": "item",
                                            "element": "answer",
                                            "listMode": "first",
                                            "variable": "a"
                                        }
                                    ],
                                    "target": [
                                        {
                                            "contextType": "variable",
                                            "transform": "copy",
                                            "parameter": [
                                                {
                                                    "valueId": "tgt"
                                                }
                                            ]
                                        }
                                    ],
                                    "rule": [
                                        {
                                            "name": "ndjsd",
                                            "source": [
                                                {
                                                    "context": "a",
                                                    "element": "value",
                                                    "variable": "val"
                                                }
                                            ],
                                            "target": [
                                                {
                                                    "context": "ref",
                                                    "contextType": "variable",
                                                    "element": "reference",
                                                    "transform": "append",
                                                    "parameter": [
                                                        {
                                                            "valueString": "/RelatedPerson/"
                                                        },
                                                        {
                                                            "valueId": "val"
                                                        }
                                                    ]
                                                }
                                            ]
                                        }
                                    ]
                                }
                            ]
                        }
                    ]
                }
            ]
        }
    ]
}