{
    "resourceType": "StructureMap",
    "id": "emcarea.registration.p",
    "url": "https://fhir.dk.swisstph-mis.ch/matchbox/fhir/StructureMap/emcarea.registration.p",
    "name": "emcarea.registration.p",
    "status": "draft",
    "structure": [
        {
            "url": "http://hl7.org/fhir/uv/sdc/StructureDefinition/sdc-questionnaireresponse",
            "mode": "source",
            "alias": "questionnaireResponse",
            "documentation": "emcarearegistrationp:https://fhir.dk.swisstph-mis.ch/matchbox/fhir/Questionnaire/emcarea.registration.p"
        },
        {
            "url": "http://hl7.org/fhir/StructureDefinition/Bundle",
            "mode": "target",
            "alias": "bundle",
            "documentation": "Bundle are require where there is multiple ressource to be mapped"
        },
        {
            "url": "http://hl7.org/fhir/StructureDefinition/Patient",
            "mode": "target",
            "alias": "Patient",
            "documentation": "target that will be inserted in the bundle"
        },
        {
            "url": "http://hl7.org/fhir/StructureDefinition/Encounter",
            "mode": "target",
            "alias": "Encounter",
            "documentation": "target that will be inserted in the bundle"
        },
        {
            "url": "http://hl7.org/fhir/StructureDefinition/RelatedPerson",
            "mode": "target",
            "alias": "RelatedPerson",
            "documentation": "target that will be inserted in the bundle"
        },
        {
            "url": "http://hl7.org/fhir/StructureDefinition/CommunicationRequest",
            "mode": "target",
            "alias": "CommunicationRequest",
            "documentation": "target that will be inserted in the bundle"
        }
    ],
    "group": [
        {
            "name": "emcarepatientemcarearegistrationp",
            "typeMode": "types",
            "input": [
                {
                    "name": "src",
                    "type": "questionnaireResponse",
                    "mode": "source",
                    "documentation": "EmCareA.Registration.P"
                },
                {
                    "name": "tgt",
                    "type": "Patient",
                    "mode": "target"
                }
            ],
            "rule": [
                {
                    "name": "EmCare.A.DE01",
                    "source": [
                        {
                            "context": "item"
                        }
                    ],
                    "documentation": "src.item as item where linkId  = 'EmCare.A.DE01' -> tgt then { item.answer as a -> tgt.identifier = create('Identifier' ) as identifier then {\n        a -> identifier.value = a, identifier.system = 'https://fhir.dk.swisstph-mis.ch/matchbox/fhir//CodeSystem/em-custom'  \"id\";\n    } 'set-id';   } 'EmCare.A.DE01-main';"
                },
                {
                    "name": "EmCare.A.DE02",
                    "source": [
                        {
                            "context": "item"
                        }
                    ],
                    "documentation": "src.item as item where linkId  = 'EmCare.A.DE02' -> tgt then { item.answer as a -> tgt.identifier = create('Identifier' ) as identifier then {\n        a -> identifier.value = a, identifier.system = 'https://fhir.dk.swisstph-mis.ch/matchbox/fhir//CodeSystem/em-custom'  \"idu\";\n    } 'set-id';   } 'EmCare.A.DE02-main';"
                },
                {
                    "name": "EmCare.A.DE03",
                    "source": [
                        {
                            "context": "item"
                        }
                    ],
                    "documentation": "src.item as item where linkId  = 'EmCare.A.DE03' -> tgt then { item.answer as a -> tgt.identifier = create('Identifier' ) as identifier then {\n        a -> identifier.value = 'noid', identifier.system = 'https://fhir.dk.swisstph-mis.ch/matchbox/fhir//CodeSystem/em-custom'  \"noid\";\n    } 'set-id';   } 'EmCare.A.DE03-main';"
                },
                {
                    "name": "EmCare.A.DE04",
                    "source": [
                        {
                            "context": "item"
                        }
                    ],
                    "documentation": "src.item first as item  where linkId =  'EmCare.A.DE04'  or linkId =  'EmCare.A.DE05' or linkId =  'EmCare.A.DE06' -> tgt as target,  target.name as name then SetOfficalGivenNameemcareade04(src, name) 'name-main';"
                },
                {
                    "name": "EmCare.A.DE08",
                    "source": [
                        {
                            "context": "item"
                        }
                    ],
                    "documentation": "src.item as item where linkId  = 'EmCare.A.DE08' -> tgt then { item.answer as a -> a -> tgt.birthDate = a 'EmCare.A.DE08-1';   } 'EmCare.A.DE08-main';"
                },
                {
                    "name": "EmCare.A.DE12",
                    "source": [
                        {
                            "context": "item"
                        }
                    ],
                    "documentation": "src.item as item where linkId  = 'EmCare.A.DE12' -> tgt then { item.answer as a -> tgt.extension as ext ,  ext.url ='https://fhir.dk.swisstph-mis.ch/matchbox/fhir/StructureDefinition/birthDateEstimator',  ext.valueCode = a 'EmCare.A.DE12-1';   } 'EmCare.A.DE12-main';"
                },
                {
                    "name": "EmCare.A.DE16",
                    "source": [
                        {
                            "context": "item"
                        }
                    ],
                    "documentation": "src.item as item where linkId  = 'EmCare.A.DE16' -> tgt then { item.answer as a -> tgt.gender = translate(a, 'sex-of-the-client', 'http://hl7.org/fhir/administrative-gender') 'EmCare.A.DE16-1';   } 'EmCare.A.DE16-main';"
                },
                {
                    "name": "EmCare.A.DE20",
                    "source": [
                        {
                            "context": "item"
                        }
                    ],
                    "documentation": "src.item as item where linkId  = 'EmCare.A.DE20' -> tgt then { item.answer as a -> tgt.address as address, address.text = a 'EmCare.A.DE20-1';   } 'EmCare.A.DE20-main';"
                },
                {
                    "name": "EmCare.A.DE47",
                    "source": [
                        {
                            "context": "item"
                        }
                    ],
                    "documentation": "src.item as item where linkId  = 'EmCare.A.DE47' -> tgt then { item.answer as a -> tgt.extension as ext ,  ext.url ='https://fhir.dk.swisstph-mis.ch/matchbox/fhir/StructureDefinition/caregiver', ext.valueReference= a 'EmCare.A.DE47-1';   } 'EmCare.A.DE47-main';"
                },
                {
                    "name": "EmCare.A.DE31",
                    "source": [
                        {
                            "context": "item"
                        }
                    ],
                    "documentation": "src.item as item where linkId  = 'EmCare.A.DE31' -> tgt then { item.answer as a -> tgt.extension as ext ,  ext.url ='https://fhir.dk.swisstph-mis.ch/matchbox/fhir/Extension/motherVitalStatus', ext.valueCode= a 'EmCare.A.DE31-1';   } 'EmCare.A.DE31-main';"
                },
                {
                    "name": "EmCare.A.DE32",
                    "source": [
                        {
                            "context": "item"
                        }
                    ],
                    "documentation": "src.item as item where linkId  = 'EmCare.A.DE32' -> tgt then { item.answer as a -> tgt.extension as ext ,  ext.url ='https://fhir.dk.swisstph-mis.ch/matchbox/fhir/Extension/fatherVitalStatus', ext.valueCode= a 'EmCare.A.DE32-1';   } 'EmCare.A.DE32-main';"
                }
            ]
        },
        {
            "name": "emcareade04",
            "typeMode": "types",
            "documentation": "group SetOfficalGivenNameemcareade04(source src, target tgt){\n        src -> tgt.use = 'official'  then {\n            src.item as item where linkId  =  'EmCare.A.DE04'    then {item.answer as a -> tgt.given = a 'f';} 'first';\n            src.item as item  where linkId = 'EmCare.A.DE05'   then {item.answer as a -> tgt.given = a 'm';} 'middle';\n            src.item as item  where linkId = 'EmCare.A.DE06'  then {item.answer as a -> tgt.family = a 'fa';} 'family';\n        } 'details';\n    }",
            "input": [
                {
                    "name": "src",
                    "mode": "source",
                    "documentation": "EmCare.A.DE04"
                },
                {
                    "name": "tgt",
                    "mode": "target"
                }
            ]
        },
        {
            "name": "emcareencounteremcarearegistrationp",
            "typeMode": "types",
            "input": [
                {
                    "name": "src",
                    "type": "questionnaireResponse",
                    "mode": "source",
                    "documentation": "EmCareA.Registration.P"
                },
                {
                    "name": "tgt",
                    "type": "Encounter",
                    "mode": "target"
                }
            ],
            "rule": [
                {
                    "name": "EmCare.A.DE07",
                    "source": [
                        {
                            "context": "item"
                        }
                    ],
                    "documentation": "src.item as item where linkId  = 'EmCare.A.DE07' -> tgt then { item.answer as a -> tgt.period as period , period.start = a 'EmCare.A.DE07-1';   } 'EmCare.A.DE07-main';"
                }
            ]
        },
        {
            "name": "emcarerelatedpersoncaregiveremcarearegistrationp",
            "typeMode": "types",
            "input": [
                {
                    "name": "src",
                    "type": "questionnaireResponse",
                    "mode": "source",
                    "documentation": "EmCareA.Registration.P"
                },
                {
                    "name": "tgt",
                    "type": "RelatedPerson",
                    "mode": "target"
                }
            ],
            "rule": [
                {
                    "name": "EmCare.A.DE21",
                    "source": [
                        {
                            "context": "item"
                        }
                    ],
                    "documentation": "src.item first as item  where linkId =  'EmCare.A.DE21'  or linkId =  'EmCare.A.DE22' or linkId =  'EmCare.A.DE23' -> tgt as target,  target.name as name then SetOfficalGivenNameemcareade21(src, name) 'name-main';"
                },
                {
                    "name": "EmCare.A.DE35",
                    "source": [
                        {
                            "context": "item"
                        }
                    ],
                    "documentation": "src.item as item where linkId  = 'EmCare.A.DE35' -> tgt then { item.answer as a -> tgt.telecom as tel, tel.system = 'phone', tel.use ='mobile', tel.value = a 'EmCare.A.DE35-1';   } 'EmCare.A.DE35-main';"
                },
                {
                    "name": "EmCare.A.DE36",
                    "source": [
                        {
                            "context": "item"
                        }
                    ],
                    "documentation": "src.item as item where linkId  = 'EmCare.A.DE36' -> tgt then { item.answer as a -> tgt.telecom as tel, tel.system = 'phone', tel.use ='home', tel.value = a 'EmCare.A.DE36-1';   } 'EmCare.A.DE36-main';"
                },
                {
                    "name": "EmCare.A.DE37",
                    "source": [
                        {
                            "context": "item"
                        }
                    ],
                    "documentation": "src.item as item where linkId  = 'EmCare.A.DE37' -> tgt then { item.answer as a -> tgt.telecom as tel, tel.system = 'phone', tel.use ='work', tel.value = a 'EmCare.A.DE37-1';   } 'EmCare.A.DE37-main';"
                }
            ]
        },
        {
            "name": "emcareade21",
            "typeMode": "types",
            "documentation": "group SetOfficalGivenNameemcareade21(source src, target tgt){\n        src -> tgt.use = 'official'  then {\n            src.item as item where linkId  =  'EmCare.A.DE21'    then {item.answer as a -> tgt.given = a 'f';} 'first';\n            src.item as item  where linkId = 'EmCare.A.DE22'   then {item.answer as a -> tgt.given = a 'm';} 'middle';\n            src.item as item  where linkId = 'EmCare.A.DE23'  then {item.answer as a -> tgt.family = a 'fa';} 'family';\n        } 'details';\n    }",
            "input": [
                {
                    "name": "src",
                    "mode": "source",
                    "documentation": "EmCare.A.DE21"
                },
                {
                    "name": "tgt",
                    "mode": "target"
                }
            ]
        },
        {
            "name": "emcarecommunicationrequestemcarearegistrationp",
            "typeMode": "types",
            "input": [
                {
                    "name": "src",
                    "type": "questionnaireResponse",
                    "mode": "source",
                    "documentation": "EmCareA.Registration.P"
                },
                {
                    "name": "tgt",
                    "type": "CommunicationRequest",
                    "mode": "target"
                }
            ],
            "rule": [
                {
                    "name": "EmCare.A.DE38",
                    "source": [
                        {
                            "context": "item"
                        }
                    ],
                    "documentation": "src.item as item where linkId  = 'EmCare.A.DE38' -> tgt then { item.answer as a -> tgt.medium = 'https://fhir.dk.swisstph-mis.ch/matchbox/fhir/CodeSystem/emcare-custom-codes' 'EmCare.A.DE38-1';   } 'EmCare.A.DE38-main';"
                },
                {
                    "name": "EmCare.A.DE46",
                    "source": [
                        {
                            "context": "item"
                        }
                    ],
                    "documentation": "src.item as item where linkId  = 'EmCare.A.DE46' -> tgt then { item.answer as a -> tgt.recipient = a 'EmCare.A.DE46-1';   } 'EmCare.A.DE46-main';"
                }
            ]
        }
    ]
}