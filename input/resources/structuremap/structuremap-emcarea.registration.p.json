{
  "resourceType": "StructureMap",
  "id": "emcarea.registration.p",
  "meta": {
    "versionId": "87",
    "lastUpdated": "2022-08-18T15:45:04.673000+00:00"
  },
  "text": {
    "status": "generated",
    "div": "<div xmlns=\"http://www.w3.org/1999/xhtml\"><pre>map &quot;https://fhir.dk.swisstph-mis.ch/matchbox/fhir/StructureMap/emcarea.registration.p&quot; = &quot;emcarea.registration.p&quot;\r\n\r\n\r\nuses &quot;http://hl7.org/fhir/uv/sdc/StructureDefinition/sdc-questionnaireresponse&quot; alias 'questionnaireResponse' as source\r\nuses &quot;http://hl7.org/fhir/StructureDefinition/Bundle&quot; alias 'Bundle' as target\r\nuses &quot;https://fhir.dk.swisstph-mis.ch/matchbox/fhir/StructureDefinition/patient&quot; alias 'Patient' as target\r\nuses &quot;https://fhir.dk.swisstph-mis.ch/matchbox/fhir/StructureDefinition/encounter&quot; alias 'Encounter' as target\r\nuses &quot;https://fhir.dk.swisstph-mis.ch/matchbox/fhir/StructureDefinition/relatedperson&quot; alias 'RelatedPerson' as target\r\nuses &quot;https://fhir.dk.swisstph-mis.ch/matchbox/fhir/StructureDefinition/communicationrequest&quot; alias 'CommunicationRequest' as target\r\nuses &quot;https://fhir.dk.swisstph-mis.ch/matchbox/fhir/StructureDefinition/emcarepatient&quot; alias 'EmCare Patient' as produced\r\nuses &quot;https://fhir.dk.swisstph-mis.ch/matchbox/fhir/StructureDefinition/emcareencounter&quot; alias 'EmCare Encounter' as produced\r\nuses &quot;https://fhir.dk.swisstph-mis.ch/matchbox/fhir/StructureDefinition/emcarerelatedpersoncaregiver&quot; alias 'EmCare RelatedPerson Caregiver' as produced\r\nuses &quot;https://fhir.dk.swisstph-mis.ch/matchbox/fhir/StructureDefinition/emcarecommunicationrequest&quot; alias 'EmCare CommunicationRequest' as produced\r\n\r\ngroup bundletrans(source src : questionnaireResponse, target bundle : Bundle) {\r\n  src -&gt; bundle.id = uuid() &quot;id&quot;;\r\n  src -&gt; bundle.type = 'batch' &quot;type&quot;;\r\n  src -&gt; bundle.entry as entry then {\r\n    src -&gt; entry.fullUrl as fullurl then getFullUrlemcarepatient(src, fullurl) &quot;fuemcarepatient&quot;;\r\n    src -&gt;  entry.request as request,  request.method = 'PUT',  request.url as url then getUrlemcarepatient(src, url) &quot;uemcarepatient&quot;;\r\n    src -&gt; entry.resource = create('Patient') as tgt then emcarepatient(src, tgt) &quot;cemcarepatient&quot;;\r\n  } &quot;put-emcarepatient&quot;;\r\n  src -&gt; bundle.entry as entry then {\r\n    src -&gt; entry.fullUrl as fullurl then getFullUrlemcareencounter(src, fullurl) &quot;fuemcareencounter&quot;;\r\n    src -&gt;  entry.request as request,  request.method = 'PUT',  request.url as url then getUrlemcareencounter(src, url) &quot;uemcareencounter&quot;;\r\n    src -&gt; entry.resource = create('Encounter') as tgt then emcareencounter(src, tgt) &quot;cemcareencounter&quot;;\r\n  } &quot;put-emcareencounter&quot;;\r\n  src -&gt; bundle.entry as entry then {\r\n    src -&gt; entry.fullUrl as fullurl then getFullUrlemcarerelatedpersoncaregiver(src, fullurl) &quot;fuemcarerelatedpersoncaregiver&quot;;\r\n    src -&gt;  entry.request as request,  request.method = 'PUT',  request.url as url then getUrlemcarerelatedpersoncaregiver(src, url) &quot;uemcarerelatedpersoncaregiver&quot;;\r\n    src -&gt; entry.resource = create('RelatedPerson') as tgt then emcarerelatedpersoncaregiver(src, tgt) &quot;cemcarerelatedpersoncaregiver&quot;;\r\n  } &quot;put-emcarerelatedpersoncaregiver&quot;;\r\n  src -&gt; bundle.entry as entry then {\r\n    src -&gt; entry.fullUrl as fullurl then getFullUrlemcarecommunicationrequest(src, fullurl) &quot;fuemcarecommunicationrequest&quot;;\r\n    src -&gt;  entry.request as request,  request.method = 'PUT',  request.url as url then getUrlemcarecommunicationrequest(src, url) &quot;uemcarecommunicationrequest&quot;;\r\n    src -&gt; entry.resource = create('CommunicationRequest') as tgt then emcarecommunicationrequest(src, tgt) &quot;cemcarecommunicationrequest&quot;;\r\n  } &quot;put-emcarecommunicationrequest&quot;;\r\n}\r\n\r\ngroup emcarepatient(source src : questionnaireResponse, target tgt : Patient) {\r\n  src.item as item where linkId = 'EmCare.A.DE01' -&gt; tgt then {\r\n    item.answer as a -&gt; tgt.identifier = create('Identifier') as identifier then {\r\n      a -&gt;  identifier.value = a,  identifier.system = 'https://fhir.dk.swisstph-mis.ch/matchbox/fhir//CodeSystem/em-custom' &quot;id&quot;;\r\n    } &quot;set-id&quot;;\r\n  } &quot;emcareade01&quot;;\r\n  src.item as item where linkId = 'EmCare.A.DE02' -&gt; tgt then {\r\n    item.answer as a -&gt; tgt.identifier = create('Identifier') as identifier then {\r\n      a -&gt;  identifier.value = a,  identifier.system = 'https://fhir.dk.swisstph-mis.ch/matchbox/fhir//CodeSystem/em-custom' &quot;idu&quot;;\r\n    } &quot;set-id&quot;;\r\n  } &quot;emcareade02&quot;;\r\n  src.item as item where linkId = 'EmCare.A.DE03' -&gt; tgt then {\r\n    item.answer as a -&gt; tgt.identifier = create('Identifier') as identifier then {\r\n      a -&gt;  identifier.value = 'noid',  identifier.system = 'https://fhir.dk.swisstph-mis.ch/matchbox/fhir//CodeSystem/em-custom' &quot;noid&quot;;\r\n    } &quot;set-id&quot;;\r\n  } &quot;emcareade03&quot;;\r\n  src.item first as item where (linkId = 'EmCare.A.DE04') or (linkId = 'EmCare.A.DE05') or (linkId = 'EmCare.A.DE06') -&gt;  tgt as target,  target.name as name then SetOfficalGivenNameemcareade04(src, name) &quot;emcareade04&quot;;\r\n  src.item as item where linkId = 'EmCare.A.DE08' -&gt; tgt then {\r\n    item.answer first as a, a.value as val -&gt; tgt.birthDate = val &quot;DE08-1&quot;;\r\n  } &quot;emcareade08&quot;;\r\n  src.item as item where linkId = 'EmCare.A.DE12' -&gt; tgt then {\r\n    item.answer as a -&gt;  tgt.extension as ext,  ext.url = 'https://fhir.dk.swisstph-mis.ch/matchbox/fhir/StructureDefinition/birthDateEstimator',  ext.valueCode = a &quot;DE12-1&quot;;\r\n  } &quot;emcareade12&quot;;\r\n  src.item as item where linkId = 'EmCare.A.DE16' -&gt; tgt then {\r\n    item.answer as a -&gt; tgt.gender = translate(a, 'sex-of-the-client', 'http://hl7.org/fhir/administrative-gender') &quot;DE16-1&quot;;\r\n  } &quot;emcareade16&quot;;\r\n  src.item as item where linkId = 'EmCare.A.DE20' -&gt; tgt then {\r\n    item.answer first as a, a.value as val -&gt;  tgt.address as address,  address.text = val &quot;DE20-1&quot;;\r\n  } &quot;emcareade20&quot;;\r\n  src.item as item where linkId = 'EmCare.A.DE47' -&gt; tgt then {\r\n    item.answer as a -&gt;  tgt.extension as ext,  ext.url = 'https://fhir.dk.swisstph-mis.ch/matchbox/fhir/StructureDefinition/caregiver',  ext.valueReference = a &quot;DE47-1&quot;;\r\n  } &quot;emcareade47&quot;;\r\n  src.item as item where linkId = 'EmCare.A.DE31' -&gt; tgt then {\r\n    item.answer first as a, a.value as val -&gt;  tgt.extension as ext,  ext.url = 'https://fhir.dk.swisstph-mis.ch/matchbox/fhir/Extension/motherVitalStatus',  ext.value = val &quot;DE31-1&quot;;\r\n  } &quot;emcareade31&quot;;\r\n  src.item as item where linkId = 'EmCare.A.DE32' -&gt; tgt then {\r\n    item.answer first as a, a.value as val -&gt;  tgt.extension as ext,  ext.url = 'https://fhir.dk.swisstph-mis.ch/matchbox/fhir/Extension/fatherVitalStatus',  ext.value = val &quot;DE32-1&quot;;\r\n  } &quot;emcareade32&quot;;\r\n}\r\n\r\ngroup SetOfficalGivenNameemcareade04(source src, target tgt) {\r\n  src -&gt; tgt.use = 'official' then {\r\n    src.item as item where linkId = 'EmCare.A.DE04' -&gt; tgt then {\r\n      item.answer as a -&gt; tgt.given = a &quot;f&quot;;\r\n    } &quot;femcareade04&quot;;\r\n    src.item as item where linkId = 'EmCare.A.DE05' -&gt; tgt then {\r\n      item.answer as a -&gt; tgt.given = a &quot;f&quot;;\r\n    } &quot;memcareade04&quot;;\r\n    src.item as item where linkId = 'EmCare.A.DE06' -&gt; tgt then {\r\n      item.answer as a -&gt; tgt.family = a &quot;f&quot;;\r\n    } &quot;lemcareade04&quot;;\r\n  } &quot;sgnemcareade04&quot;;\r\n}\r\n\r\ngroup getIdemcarepatient(source src, target tgt) {\r\n  src.item first as item where linkId = 'EmCare Patientid' then {\r\n    item.answer first as a, a.value as val -&gt; ressource = val &quot;idemcarepatient&quot;;\r\n  } &quot;iemcarepatient&quot;;\r\n}\r\n\r\ngroup getFullUrlemcarepatient(source src, target tgt) {\r\n  src.item first as item where linkId = 'EmCare Patientid' then {\r\n    item.answer first as a, a.value as val -&gt; ressource = append('urn:uuid:', val) &quot;fuemcarepatient&quot;;\r\n  } &quot;fuemcarepatient&quot;;\r\n}\r\n\r\ngroup getUrlemcarepatient(source src, target tgt) {\r\n  src.item first as item where linkId = 'EmCare Patientid' then {\r\n    item.answer first as a, a.value as val -&gt; ressource = append('Patient/', val) &quot;uemcarepatient&quot;;\r\n  } &quot;uemcarepatient&quot;;\r\n}\r\n\r\ngroup emcareencounter(source src : questionnaireResponse, target tgt : Encounter) {\r\n  src.item as item where linkId = 'EmCare.A.DE07' -&gt; tgt then {\r\n    item.answer first as a, a.value as val -&gt;  tgt.period as period,  period.start = val &quot;DE07-1&quot;;\r\n  } &quot;emcareade07&quot;;\r\n}\r\n\r\ngroup getIdemcareencounter(source src, target tgt) {\r\n  src.item first as item where linkId = 'EmCare Encounterid' then {\r\n    item.answer first as a, a.value as val -&gt; ressource = val &quot;idemcareencounter&quot;;\r\n  } &quot;iemcareencounter&quot;;\r\n}\r\n\r\ngroup getFullUrlemcareencounter(source src, target tgt) {\r\n  src.item first as item where linkId = 'EmCare Encounterid' then {\r\n    item.answer first as a, a.value as val -&gt; ressource = append('urn:uuid:', val) &quot;fuemcareencounter&quot;;\r\n  } &quot;fuemcareencounter&quot;;\r\n}\r\n\r\ngroup getUrlemcareencounter(source src, target tgt) {\r\n  src.item first as item where linkId = 'EmCare Encounterid' then {\r\n    item.answer first as a, a.value as val -&gt; ressource = append('Encounter/', val) &quot;uemcareencounter&quot;;\r\n  } &quot;uemcareencounter&quot;;\r\n}\r\n\r\ngroup emcarerelatedpersoncaregiver(source src : questionnaireResponse, target tgt : RelatedPerson) {\r\n  src.item first as item where (linkId = 'EmCare.A.DE21') or (linkId = 'EmCare.A.DE22') or (linkId = 'EmCare.A.DE23') -&gt;  tgt as target,  target.name as name then SetOfficalGivenNameemcareade21(src, name) &quot;emcareade21&quot;;\r\n  src.item as item where linkId = 'EmCare.A.DE35' -&gt; tgt then {\r\n    item.answer first as a, a.value as val -&gt;  tgt.telecom as tel,  tel.system = 'phone',  tel.use = 'mobile',  tel.value = val &quot;DE35-1&quot;;\r\n  } &quot;emcareade35&quot;;\r\n  src.item as item where linkId = 'EmCare.A.DE36' -&gt; tgt then {\r\n    item.answer first as a, a.value as val -&gt;  tgt.telecom as tel,  tel.system = 'phone',  tel.use = 'home',  tel.value = val &quot;DE36-1&quot;;\r\n  } &quot;emcareade36&quot;;\r\n  src.item as item where linkId = 'EmCare.A.DE37' -&gt; tgt then {\r\n    item.answer first as a, a.value as val -&gt;  tgt.telecom as tel,  tel.system = 'phone',  tel.use = 'work',  tel.value = val &quot;DE37-1&quot;;\r\n  } &quot;emcareade37&quot;;\r\n}\r\n\r\ngroup SetOfficalGivenNameemcareade21(source src, target tgt) {\r\n  src -&gt; tgt.use = 'official' then {\r\n    src.item as item where linkId = 'EmCare.A.DE21' -&gt; tgt then {\r\n      item.answer as a -&gt; tgt.given = a &quot;f&quot;;\r\n    } &quot;femcareade21&quot;;\r\n    src.item as item where linkId = 'EmCare.A.DE22' -&gt; tgt then {\r\n      item.answer as a -&gt; tgt.given = a &quot;f&quot;;\r\n    } &quot;memcareade21&quot;;\r\n    src.item as item where linkId = 'EmCare.A.DE23' -&gt; tgt then {\r\n      item.answer as a -&gt; tgt.family = a &quot;f&quot;;\r\n    } &quot;lemcareade21&quot;;\r\n  } &quot;sgnemcareade21&quot;;\r\n}\r\n\r\ngroup getIdemcarerelatedpersoncaregiver(source src, target tgt) {\r\n  src.item first as item where linkId = 'EmCare RelatedPerson Caregiverid' then {\r\n    item.answer first as a, a.value as val -&gt; ressource = val &quot;idemcarerelatedpersoncaregiver&quot;;\r\n  } &quot;iemcarerelatedpersoncaregiver&quot;;\r\n}\r\n\r\ngroup getFullUrlemcarerelatedpersoncaregiver(source src, target tgt) {\r\n  src.item first as item where linkId = 'EmCare RelatedPerson Caregiverid' then {\r\n    item.answer first as a, a.value as val -&gt; ressource = append('urn:uuid:', val) &quot;fuemcarerelatedpersoncaregiver&quot;;\r\n  } &quot;fuemcarerelatedpersoncaregiver&quot;;\r\n}\r\n\r\ngroup getUrlemcarerelatedpersoncaregiver(source src, target tgt) {\r\n  src.item first as item where linkId = 'EmCare RelatedPerson Caregiverid' then {\r\n    item.answer first as a, a.value as val -&gt; ressource = append('RelatedPerson/', val) &quot;uemcarerelatedpersoncaregiver&quot;;\r\n  } &quot;uemcarerelatedpersoncaregiver&quot;;\r\n}\r\n\r\ngroup emcarecommunicationrequest(source src : questionnaireResponse, target tgt : CommunicationRequest) {\r\n  src.item as item where linkId = 'EmCare.A.DE38' -&gt; tgt then {\r\n    item.answer first as a, a.value as val -&gt;  tgt.medium = 'https://fhir.dk.swisstph-mis.ch/matchbox/fhir/CodeSystem/emcare-custom-codes',  tgt.recipient as recipient then {\r\n      src.item as item where linkId = 'emcarecommunicationrequestid', item.answer first as a, a.value as val -&gt; recipient = val &quot;r1&quot;;\r\n    } &quot;DE38-1&quot;;\r\n  } &quot;emcareade38&quot;;\r\n}\r\n\r\ngroup getIdemcarecommunicationrequest(source src, target tgt) {\r\n  src.item first as item where linkId = 'EmCare CommunicationRequestid' then {\r\n    item.answer first as a, a.value as val -&gt; ressource = val &quot;idemcarecommunicationrequest&quot;;\r\n  } &quot;iemcarecommunicationrequest&quot;;\r\n}\r\n\r\ngroup getFullUrlemcarecommunicationrequest(source src, target tgt) {\r\n  src.item first as item where linkId = 'EmCare CommunicationRequestid' then {\r\n    item.answer first as a, a.value as val -&gt; ressource = append('urn:uuid:', val) &quot;fuemcarecommunicationrequest&quot;;\r\n  } &quot;fuemcarecommunicationrequest&quot;;\r\n}\r\n\r\ngroup getUrlemcarecommunicationrequest(source src, target tgt) {\r\n  src.item first as item where linkId = 'EmCare CommunicationRequestid' then {\r\n    item.answer first as a, a.value as val -&gt; ressource = append('CommunicationRequest/', val) &quot;uemcarecommunicationrequest&quot;;\r\n  } &quot;uemcarecommunicationrequest&quot;;\r\n}\r\n\r\n</pre></div>"
  },
  "url": "https://fhir.dk.swisstph-mis.ch/matchbox/fhir/StructureMap/emcarea.registration.p",
  "name": "emcarea.registration.p",
  "status": "active",
  "structure": [
    {
      "url": "http://hl7.org/fhir/uv/sdc/StructureDefinition/sdc-questionnaireresponse",
      "mode": "source",
      "alias": "'questionnaireResponse'"
    },
    {
      "url": "http://hl7.org/fhir/StructureDefinition/Bundle",
      "mode": "target",
      "alias": "'Bundle'"
    },
    {
      "url": "https://fhir.dk.swisstph-mis.ch/matchbox/fhir/StructureDefinition/patient",
      "mode": "target",
      "alias": "'Patient'"
    },
    {
      "url": "https://fhir.dk.swisstph-mis.ch/matchbox/fhir/StructureDefinition/encounter",
      "mode": "target",
      "alias": "'Encounter'"
    },
    {
      "url": "https://fhir.dk.swisstph-mis.ch/matchbox/fhir/StructureDefinition/relatedperson",
      "mode": "target",
      "alias": "'RelatedPerson'"
    },
    {
      "url": "https://fhir.dk.swisstph-mis.ch/matchbox/fhir/StructureDefinition/communicationrequest",
      "mode": "target",
      "alias": "'CommunicationRequest'"
    },
    {
      "url": "https://fhir.dk.swisstph-mis.ch/matchbox/fhir/StructureDefinition/emcarepatient",
      "mode": "produced",
      "alias": "'EmCare Patient'"
    },
    {
      "url": "https://fhir.dk.swisstph-mis.ch/matchbox/fhir/StructureDefinition/emcareencounter",
      "mode": "produced",
      "alias": "'EmCare Encounter'"
    },
    {
      "url": "https://fhir.dk.swisstph-mis.ch/matchbox/fhir/StructureDefinition/emcarerelatedpersoncaregiver",
      "mode": "produced",
      "alias": "'EmCare RelatedPerson Caregiver'"
    },
    {
      "url": "https://fhir.dk.swisstph-mis.ch/matchbox/fhir/StructureDefinition/emcarecommunicationrequest",
      "mode": "produced",
      "alias": "'EmCare CommunicationRequest'"
    }
  ],
  "group": [
    {
      "name": "bundletrans",
      "typeMode": "none",
      "input": [
        {
          "name": "src",
          "type": "questionnaireResponse",
          "mode": "source"
        },
        {
          "name": "bundle",
          "type": "Bundle",
          "mode": "target"
        }
      ],
      "rule": [
        {
          "name": "id",
          "source": [
            {
              "context": "src"
            }
          ],
          "target": [
            {
              "context": "bundle",
              "contextType": "variable",
              "element": "id",
              "transform": "uuid"
            }
          ]
        },
        {
          "name": "type",
          "source": [
            {
              "context": "src"
            }
          ],
          "target": [
            {
              "context": "bundle",
              "contextType": "variable",
              "element": "type",
              "transform": "copy",
              "parameter": [
                {
                  "valueString": "batch"
                }
              ]
            }
          ]
        },
        {
          "name": "put-emcarepatient",
          "source": [
            {
              "context": "src"
            }
          ],
          "target": [
            {
              "context": "bundle",
              "contextType": "variable",
              "element": "entry",
              "variable": "entry"
            }
          ],
          "rule": [
            {
              "name": "fuemcarepatient",
              "source": [
                {
                  "context": "src"
                }
              ],
              "target": [
                {
                  "context": "entry",
                  "contextType": "variable",
                  "element": "fullUrl",
                  "variable": "fullurl"
                }
              ],
              "dependent": [
                {
                  "name": "getFullUrlemcarepatient",
                  "variable": [
                    "src",
                    "fullurl"
                  ]
                }
              ]
            },
            {
              "name": "uemcarepatient",
              "source": [
                {
                  "context": "src"
                }
              ],
              "target": [
                {
                  "context": "entry",
                  "contextType": "variable",
                  "element": "request",
                  "variable": "request"
                },
                {
                  "context": "request",
                  "contextType": "variable",
                  "element": "method",
                  "transform": "copy",
                  "parameter": [
                    {
                      "valueString": "PUT"
                    }
                  ]
                },
                {
                  "context": "request",
                  "contextType": "variable",
                  "element": "url",
                  "variable": "url"
                }
              ],
              "dependent": [
                {
                  "name": "getUrlemcarepatient",
                  "variable": [
                    "src",
                    "url"
                  ]
                }
              ]
            },
            {
              "name": "cemcarepatient",
              "source": [
                {
                  "context": "src"
                }
              ],
              "target": [
                {
                  "context": "entry",
                  "contextType": "variable",
                  "element": "resource",
                  "variable": "tgt",
                  "transform": "create",
                  "parameter": [
                    {
                      "valueString": "Patient"
                    }
                  ]
                }
              ],
              "dependent": [
                {
                  "name": "emcarepatient",
                  "variable": [
                    "src",
                    "tgt"
                  ]
                }
              ]
            }
          ]
        },
        {
          "name": "put-emcareencounter",
          "source": [
            {
              "context": "src"
            }
          ],
          "target": [
            {
              "context": "bundle",
              "contextType": "variable",
              "element": "entry",
              "variable": "entry"
            }
          ],
          "rule": [
            {
              "name": "fuemcareencounter",
              "source": [
                {
                  "context": "src"
                }
              ],
              "target": [
                {
                  "context": "entry",
                  "contextType": "variable",
                  "element": "fullUrl",
                  "variable": "fullurl"
                }
              ],
              "dependent": [
                {
                  "name": "getFullUrlemcareencounter",
                  "variable": [
                    "src",
                    "fullurl"
                  ]
                }
              ]
            },
            {
              "name": "uemcareencounter",
              "source": [
                {
                  "context": "src"
                }
              ],
              "target": [
                {
                  "context": "entry",
                  "contextType": "variable",
                  "element": "request",
                  "variable": "request"
                },
                {
                  "context": "request",
                  "contextType": "variable",
                  "element": "method",
                  "transform": "copy",
                  "parameter": [
                    {
                      "valueString": "PUT"
                    }
                  ]
                },
                {
                  "context": "request",
                  "contextType": "variable",
                  "element": "url",
                  "variable": "url"
                }
              ],
              "dependent": [
                {
                  "name": "getUrlemcareencounter",
                  "variable": [
                    "src",
                    "url"
                  ]
                }
              ]
            },
            {
              "name": "cemcareencounter",
              "source": [
                {
                  "context": "src"
                }
              ],
              "target": [
                {
                  "context": "entry",
                  "contextType": "variable",
                  "element": "resource",
                  "variable": "tgt",
                  "transform": "create",
                  "parameter": [
                    {
                      "valueString": "Encounter"
                    }
                  ]
                }
              ],
              "dependent": [
                {
                  "name": "emcareencounter",
                  "variable": [
                    "src",
                    "tgt"
                  ]
                }
              ]
            }
          ]
        },
        {
          "name": "put-emcarerelatedpersoncaregiver",
          "source": [
            {
              "context": "src"
            }
          ],
          "target": [
            {
              "context": "bundle",
              "contextType": "variable",
              "element": "entry",
              "variable": "entry"
            }
          ],
          "rule": [
            {
              "name": "fuemcarerelatedpersoncaregiver",
              "source": [
                {
                  "context": "src"
                }
              ],
              "target": [
                {
                  "context": "entry",
                  "contextType": "variable",
                  "element": "fullUrl",
                  "variable": "fullurl"
                }
              ],
              "dependent": [
                {
                  "name": "getFullUrlemcarerelatedpersoncaregiver",
                  "variable": [
                    "src",
                    "fullurl"
                  ]
                }
              ]
            },
            {
              "name": "uemcarerelatedpersoncaregiver",
              "source": [
                {
                  "context": "src"
                }
              ],
              "target": [
                {
                  "context": "entry",
                  "contextType": "variable",
                  "element": "request",
                  "variable": "request"
                },
                {
                  "context": "request",
                  "contextType": "variable",
                  "element": "method",
                  "transform": "copy",
                  "parameter": [
                    {
                      "valueString": "PUT"
                    }
                  ]
                },
                {
                  "context": "request",
                  "contextType": "variable",
                  "element": "url",
                  "variable": "url"
                }
              ],
              "dependent": [
                {
                  "name": "getUrlemcarerelatedpersoncaregiver",
                  "variable": [
                    "src",
                    "url"
                  ]
                }
              ]
            },
            {
              "name": "cemcarerelatedpersoncaregiver",
              "source": [
                {
                  "context": "src"
                }
              ],
              "target": [
                {
                  "context": "entry",
                  "contextType": "variable",
                  "element": "resource",
                  "variable": "tgt",
                  "transform": "create",
                  "parameter": [
                    {
                      "valueString": "RelatedPerson"
                    }
                  ]
                }
              ],
              "dependent": [
                {
                  "name": "emcarerelatedpersoncaregiver",
                  "variable": [
                    "src",
                    "tgt"
                  ]
                }
              ]
            }
          ]
        },
        {
          "name": "put-emcarecommunicationrequest",
          "source": [
            {
              "context": "src"
            }
          ],
          "target": [
            {
              "context": "bundle",
              "contextType": "variable",
              "element": "entry",
              "variable": "entry"
            }
          ],
          "rule": [
            {
              "name": "fuemcarecommunicationrequest",
              "source": [
                {
                  "context": "src"
                }
              ],
              "target": [
                {
                  "context": "entry",
                  "contextType": "variable",
                  "element": "fullUrl",
                  "variable": "fullurl"
                }
              ],
              "dependent": [
                {
                  "name": "getFullUrlemcarecommunicationrequest",
                  "variable": [
                    "src",
                    "fullurl"
                  ]
                }
              ]
            },
            {
              "name": "uemcarecommunicationrequest",
              "source": [
                {
                  "context": "src"
                }
              ],
              "target": [
                {
                  "context": "entry",
                  "contextType": "variable",
                  "element": "request",
                  "variable": "request"
                },
                {
                  "context": "request",
                  "contextType": "variable",
                  "element": "method",
                  "transform": "copy",
                  "parameter": [
                    {
                      "valueString": "PUT"
                    }
                  ]
                },
                {
                  "context": "request",
                  "contextType": "variable",
                  "element": "url",
                  "variable": "url"
                }
              ],
              "dependent": [
                {
                  "name": "getUrlemcarecommunicationrequest",
                  "variable": [
                    "src",
                    "url"
                  ]
                }
              ]
            },
            {
              "name": "cemcarecommunicationrequest",
              "source": [
                {
                  "context": "src"
                }
              ],
              "target": [
                {
                  "context": "entry",
                  "contextType": "variable",
                  "element": "resource",
                  "variable": "tgt",
                  "transform": "create",
                  "parameter": [
                    {
                      "valueString": "CommunicationRequest"
                    }
                  ]
                }
              ],
              "dependent": [
                {
                  "name": "emcarecommunicationrequest",
                  "variable": [
                    "src",
                    "tgt"
                  ]
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "name": "emcarepatient",
      "typeMode": "none",
      "input": [
        {
          "name": "src",
          "type": "questionnaireResponse",
          "mode": "source"
        },
        {
          "name": "tgt",
          "type": "Patient",
          "mode": "target"
        }
      ],
      "rule": [
        {
          "name": "emcareade01",
          "source": [
            {
              "context": "src",
              "element": "item",
              "variable": "item",
              "condition": "linkId = 'EmCare.A.DE01'"
            }
          ],
          "target": [
            {
              "contextType": "variable",
              "transform": "copy",
              "parameter": [
                {
                  "valueId": "tgt"
                }
              ]
            }
          ],
          "rule": [
            {
              "name": "set-id",
              "source": [
                {
                  "context": "item",
                  "element": "answer",
                  "variable": "a"
                }
              ],
              "target": [
                {
                  "context": "tgt",
                  "contextType": "variable",
                  "element": "identifier",
                  "variable": "identifier",
                  "transform": "create",
                  "parameter": [
                    {
                      "valueString": "Identifier"
                    }
                  ]
                }
              ],
              "rule": [
                {
                  "name": "id",
                  "source": [
                    {
                      "context": "a"
                    }
                  ],
                  "target": [
                    {
                      "context": "identifier",
                      "contextType": "variable",
                      "element": "value",
                      "transform": "copy",
                      "parameter": [
                        {
                          "valueId": "a"
                        }
                      ]
                    },
                    {
                      "context": "identifier",
                      "contextType": "variable",
                      "element": "system",
                      "transform": "copy",
                      "parameter": [
                        {
                          "valueString": "https://fhir.dk.swisstph-mis.ch/matchbox/fhir//CodeSystem/em-custom"
                        }
                      ]
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "name": "emcareade02",
          "source": [
            {
              "context": "src",
              "element": "item",
              "variable": "item",
              "condition": "linkId = 'EmCare.A.DE02'"
            }
          ],
          "target": [
            {
              "contextType": "variable",
              "transform": "copy",
              "parameter": [
                {
                  "valueId": "tgt"
                }
              ]
            }
          ],
          "rule": [
            {
              "name": "set-id",
              "source": [
                {
                  "context": "item",
                  "element": "answer",
                  "variable": "a"
                }
              ],
              "target": [
                {
                  "context": "tgt",
                  "contextType": "variable",
                  "element": "identifier",
                  "variable": "identifier",
                  "transform": "create",
                  "parameter": [
                    {
                      "valueString": "Identifier"
                    }
                  ]
                }
              ],
              "rule": [
                {
                  "name": "idu",
                  "source": [
                    {
                      "context": "a"
                    }
                  ],
                  "target": [
                    {
                      "context": "identifier",
                      "contextType": "variable",
                      "element": "value",
                      "transform": "copy",
                      "parameter": [
                        {
                          "valueId": "a"
                        }
                      ]
                    },
                    {
                      "context": "identifier",
                      "contextType": "variable",
                      "element": "system",
                      "transform": "copy",
                      "parameter": [
                        {
                          "valueString": "https://fhir.dk.swisstph-mis.ch/matchbox/fhir//CodeSystem/em-custom"
                        }
                      ]
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "name": "emcareade03",
          "source": [
            {
              "context": "src",
              "element": "item",
              "variable": "item",
              "condition": "linkId = 'EmCare.A.DE03'"
            }
          ],
          "target": [
            {
              "contextType": "variable",
              "transform": "copy",
              "parameter": [
                {
                  "valueId": "tgt"
                }
              ]
            }
          ],
          "rule": [
            {
              "name": "set-id",
              "source": [
                {
                  "context": "item",
                  "element": "answer",
                  "variable": "a"
                }
              ],
              "target": [
                {
                  "context": "tgt",
                  "contextType": "variable",
                  "element": "identifier",
                  "variable": "identifier",
                  "transform": "create",
                  "parameter": [
                    {
                      "valueString": "Identifier"
                    }
                  ]
                }
              ],
              "rule": [
                {
                  "name": "noid",
                  "source": [
                    {
                      "context": "a"
                    }
                  ],
                  "target": [
                    {
                      "context": "identifier",
                      "contextType": "variable",
                      "element": "value",
                      "transform": "copy",
                      "parameter": [
                        {
                          "valueString": "noid"
                        }
                      ]
                    },
                    {
                      "context": "identifier",
                      "contextType": "variable",
                      "element": "system",
                      "transform": "copy",
                      "parameter": [
                        {
                          "valueString": "https://fhir.dk.swisstph-mis.ch/matchbox/fhir//CodeSystem/em-custom"
                        }
                      ]
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "name": "emcareade04",
          "source": [
            {
              "context": "src",
              "element": "item",
              "listMode": "first",
              "variable": "item",
              "condition": "(linkId = 'EmCare.A.DE04') or (linkId = 'EmCare.A.DE05') or (linkId = 'EmCare.A.DE06')"
            }
          ],
          "target": [
            {
              "contextType": "variable",
              "variable": "target",
              "transform": "copy",
              "parameter": [
                {
                  "valueId": "tgt"
                }
              ]
            },
            {
              "context": "target",
              "contextType": "variable",
              "element": "name",
              "variable": "name"
            }
          ],
          "dependent": [
            {
              "name": "SetOfficalGivenNameemcareade04",
              "variable": [
                "src",
                "name"
              ]
            }
          ]
        },
        {
          "name": "emcareade08",
          "source": [
            {
              "context": "src",
              "element": "item",
              "variable": "item",
              "condition": "linkId = 'EmCare.A.DE08'"
            }
          ],
          "target": [
            {
              "contextType": "variable",
              "transform": "copy",
              "parameter": [
                {
                  "valueId": "tgt"
                }
              ]
            }
          ],
          "rule": [
            {
              "name": "EmCare.A.DE08-1",
              "source": [
                {
                  "context": "item",
                  "element": "answer",
                  "listMode": "first",
                  "variable": "a"
                },
                {
                  "context": "a",
                  "element": "value",
                  "variable": "val"
                }
              ],
              "target": [
                {
                  "context": "tgt",
                  "contextType": "variable",
                  "element": "birthDate",
                  "transform": "copy",
                  "parameter": [
                    {
                      "valueId": "val"
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "name": "emcareade12",
          "source": [
            {
              "context": "src",
              "element": "item",
              "variable": "item",
              "condition": "linkId = 'EmCare.A.DE12'"
            }
          ],
          "target": [
            {
              "contextType": "variable",
              "transform": "copy",
              "parameter": [
                {
                  "valueId": "tgt"
                }
              ]
            }
          ],
          "rule": [
            {
              "name": "EmCare.A.DE12-1",
              "source": [
                {
                  "context": "item",
                  "element": "answer",
                  "variable": "a"
                }
              ],
              "target": [
                {
                  "context": "tgt",
                  "contextType": "variable",
                  "element": "extension",
                  "variable": "ext"
                },
                {
                  "context": "ext",
                  "contextType": "variable",
                  "element": "url",
                  "transform": "copy",
                  "parameter": [
                    {
                      "valueString": "https://fhir.dk.swisstph-mis.ch/matchbox/fhir/StructureDefinition/birthDateEstimator"
                    }
                  ]
                },
                {
                  "context": "ext",
                  "contextType": "variable",
                  "element": "valueCode",
                  "transform": "copy",
                  "parameter": [
                    {
                      "valueId": "a"
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "name": "emcareade16",
          "source": [
            {
              "context": "src",
              "element": "item",
              "variable": "item",
              "condition": "linkId = 'EmCare.A.DE16'"
            }
          ],
          "target": [
            {
              "contextType": "variable",
              "transform": "copy",
              "parameter": [
                {
                  "valueId": "tgt"
                }
              ]
            }
          ],
          "rule": [
            {
              "name": "EmCare.A.DE16-1",
              "source": [
                {
                  "context": "item",
                  "element": "answer",
                  "variable": "a"
                }
              ],
              "target": [
                {
                  "context": "tgt",
                  "contextType": "variable",
                  "element": "gender",
                  "transform": "translate",
                  "parameter": [
                    {
                      "valueId": "a"
                    },
                    {
                      "valueString": "sex-of-the-client"
                    },
                    {
                      "valueString": "http://hl7.org/fhir/administrative-gender"
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "name": "emcareade20",
          "source": [
            {
              "context": "src",
              "element": "item",
              "variable": "item",
              "condition": "linkId = 'EmCare.A.DE20'"
            }
          ],
          "target": [
            {
              "contextType": "variable",
              "transform": "copy",
              "parameter": [
                {
                  "valueId": "tgt"
                }
              ]
            }
          ],
          "rule": [
            {
              "name": "EmCare.A.DE20-1",
              "source": [
                {
                  "context": "item",
                  "element": "answer",
                  "listMode": "first",
                  "variable": "a"
                },
                {
                  "context": "a",
                  "element": "value",
                  "variable": "val"
                }
              ],
              "target": [
                {
                  "context": "tgt",
                  "contextType": "variable",
                  "element": "address",
                  "variable": "address"
                },
                {
                  "context": "address",
                  "contextType": "variable",
                  "element": "text",
                  "transform": "copy",
                  "parameter": [
                    {
                      "valueId": "val"
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "name": "emcareade47",
          "source": [
            {
              "context": "src",
              "element": "item",
              "variable": "item",
              "condition": "linkId = 'EmCare.A.DE47'"
            }
          ],
          "target": [
            {
              "contextType": "variable",
              "transform": "copy",
              "parameter": [
                {
                  "valueId": "tgt"
                }
              ]
            }
          ],
          "rule": [
            {
              "name": "EmCare.A.DE47-1",
              "source": [
                {
                  "context": "item",
                  "element": "answer",
                  "variable": "a"
                }
              ],
              "target": [
                {
                  "context": "tgt",
                  "contextType": "variable",
                  "element": "extension",
                  "variable": "ext"
                },
                {
                  "context": "ext",
                  "contextType": "variable",
                  "element": "url",
                  "transform": "copy",
                  "parameter": [
                    {
                      "valueString": "https://fhir.dk.swisstph-mis.ch/matchbox/fhir/StructureDefinition/caregiver"
                    }
                  ]
                },
                {
                  "context": "ext",
                  "contextType": "variable",
                  "element": "valueReference",
                  "transform": "copy",
                  "parameter": [
                    {
                      "valueId": "a"
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "name": "emcareade31",
          "source": [
            {
              "context": "src",
              "element": "item",
              "variable": "item",
              "condition": "linkId = 'EmCare.A.DE31'"
            }
          ],
          "target": [
            {
              "contextType": "variable",
              "transform": "copy",
              "parameter": [
                {
                  "valueId": "tgt"
                }
              ]
            }
          ],
          "rule": [
            {
              "name": "EmCare.A.DE31-1",
              "source": [
                {
                  "context": "item",
                  "element": "answer",
                  "listMode": "first",
                  "variable": "a"
                },
                {
                  "context": "a",
                  "element": "value",
                  "variable": "val"
                }
              ],
              "target": [
                {
                  "context": "tgt",
                  "contextType": "variable",
                  "element": "extension",
                  "variable": "ext"
                },
                {
                  "context": "ext",
                  "contextType": "variable",
                  "element": "url",
                  "transform": "copy",
                  "parameter": [
                    {
                      "valueString": "https://fhir.dk.swisstph-mis.ch/matchbox/fhir/Extension/motherVitalStatus"
                    }
                  ]
                },
                {
                  "context": "ext",
                  "contextType": "variable",
                  "element": "value",
                  "transform": "copy",
                  "parameter": [
                    {
                      "valueId": "val"
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "name": "emcareade32",
          "source": [
            {
              "context": "src",
              "element": "item",
              "variable": "item",
              "condition": "linkId = 'EmCare.A.DE32'"
            }
          ],
          "target": [
            {
              "contextType": "variable",
              "transform": "copy",
              "parameter": [
                {
                  "valueId": "tgt"
                }
              ]
            }
          ],
          "rule": [
            {
              "name": "EmCare.A.DE32-1",
              "source": [
                {
                  "context": "item",
                  "element": "answer",
                  "listMode": "first",
                  "variable": "a"
                },
                {
                  "context": "a",
                  "element": "value",
                  "variable": "val"
                }
              ],
              "target": [
                {
                  "context": "tgt",
                  "contextType": "variable",
                  "element": "extension",
                  "variable": "ext"
                },
                {
                  "context": "ext",
                  "contextType": "variable",
                  "element": "url",
                  "transform": "copy",
                  "parameter": [
                    {
                      "valueString": "https://fhir.dk.swisstph-mis.ch/matchbox/fhir/Extension/fatherVitalStatus"
                    }
                  ]
                },
                {
                  "context": "ext",
                  "contextType": "variable",
                  "element": "value",
                  "transform": "copy",
                  "parameter": [
                    {
                      "valueId": "val"
                    }
                  ]
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "name": "SetOfficalGivenNameemcareade04",
      "typeMode": "none",
      "input": [
        {
          "name": "src",
          "mode": "source"
        },
        {
          "name": "tgt",
          "mode": "target"
        }
      ],
      "rule": [
        {
          "name": "sgnemcareade04",
          "source": [
            {
              "context": "src"
            }
          ],
          "target": [
            {
              "context": "tgt",
              "contextType": "variable",
              "element": "use",
              "transform": "copy",
              "parameter": [
                {
                  "valueString": "official"
                }
              ]
            }
          ],
          "rule": [
            {
              "name": "femcareade04",
              "source": [
                {
                  "context": "src",
                  "element": "item",
                  "variable": "item",
                  "condition": "linkId = 'EmCare.A.DE04'"
                }
              ],
              "target": [
                {
                  "contextType": "variable",
                  "transform": "copy",
                  "parameter": [
                    {
                      "valueId": "tgt"
                    }
                  ]
                }
              ],
              "rule": [
                {
                  "name": "f",
                  "source": [
                    {
                      "context": "item",
                      "element": "answer",
                      "variable": "a"
                    }
                  ],
                  "target": [
                    {
                      "context": "tgt",
                      "contextType": "variable",
                      "element": "given",
                      "transform": "copy",
                      "parameter": [
                        {
                          "valueId": "a"
                        }
                      ]
                    }
                  ]
                }
              ]
            },
            {
              "name": "memcareade04",
              "source": [
                {
                  "context": "src",
                  "element": "item",
                  "variable": "item",
                  "condition": "linkId = 'EmCare.A.DE05'"
                }
              ],
              "target": [
                {
                  "contextType": "variable",
                  "transform": "copy",
                  "parameter": [
                    {
                      "valueId": "tgt"
                    }
                  ]
                }
              ],
              "rule": [
                {
                  "name": "f",
                  "source": [
                    {
                      "context": "item",
                      "element": "answer",
                      "variable": "a"
                    }
                  ],
                  "target": [
                    {
                      "context": "tgt",
                      "contextType": "variable",
                      "element": "given",
                      "transform": "copy",
                      "parameter": [
                        {
                          "valueId": "a"
                        }
                      ]
                    }
                  ]
                }
              ]
            },
            {
              "name": "lemcareade04",
              "source": [
                {
                  "context": "src",
                  "element": "item",
                  "variable": "item",
                  "condition": "linkId = 'EmCare.A.DE06'"
                }
              ],
              "target": [
                {
                  "contextType": "variable",
                  "transform": "copy",
                  "parameter": [
                    {
                      "valueId": "tgt"
                    }
                  ]
                }
              ],
              "rule": [
                {
                  "name": "f",
                  "source": [
                    {
                      "context": "item",
                      "element": "answer",
                      "variable": "a"
                    }
                  ],
                  "target": [
                    {
                      "context": "tgt",
                      "contextType": "variable",
                      "element": "family",
                      "transform": "copy",
                      "parameter": [
                        {
                          "valueId": "a"
                        }
                      ]
                    }
                  ]
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "name": "getIdemcarepatient",
      "typeMode": "none",
      "input": [
        {
          "name": "src",
          "mode": "source"
        },
        {
          "name": "tgt",
          "mode": "target"
        }
      ],
      "rule": [
        {
          "name": "iemcarepatient",
          "source": [
            {
              "context": "src",
              "element": "item",
              "listMode": "first",
              "variable": "item",
              "condition": "linkId = 'EmCare Patientid'"
            }
          ],
          "rule": [
            {
              "name": "idemcarepatient",
              "source": [
                {
                  "context": "item",
                  "element": "answer",
                  "listMode": "first",
                  "variable": "a"
                },
                {
                  "context": "a",
                  "element": "value",
                  "variable": "val"
                }
              ],
              "target": [
                {
                  "context": "ressource",
                  "contextType": "variable",
                  "transform": "copy",
                  "parameter": [
                    {
                      "valueId": "val"
                    }
                  ]
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "name": "getFullUrlemcarepatient",
      "typeMode": "none",
      "input": [
        {
          "name": "src",
          "mode": "source"
        },
        {
          "name": "tgt",
          "mode": "target"
        }
      ],
      "rule": [
        {
          "name": "fuemcarepatient",
          "source": [
            {
              "context": "src",
              "element": "item",
              "listMode": "first",
              "variable": "item",
              "condition": "linkId = 'EmCare Patientid'"
            }
          ],
          "rule": [
            {
              "name": "fuemcarepatient",
              "source": [
                {
                  "context": "item",
                  "element": "answer",
                  "listMode": "first",
                  "variable": "a"
                },
                {
                  "context": "a",
                  "element": "value",
                  "variable": "val"
                }
              ],
              "target": [
                {
                  "context": "ressource",
                  "contextType": "variable",
                  "transform": "append",
                  "parameter": [
                    {
                      "valueString": "urn:uuid:"
                    },
                    {
                      "valueId": "val"
                    }
                  ]
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "name": "getUrlemcarepatient",
      "typeMode": "none",
      "input": [
        {
          "name": "src",
          "mode": "source"
        },
        {
          "name": "tgt",
          "mode": "target"
        }
      ],
      "rule": [
        {
          "name": "uemcarepatient",
          "source": [
            {
              "context": "src",
              "element": "item",
              "listMode": "first",
              "variable": "item",
              "condition": "linkId = 'EmCare Patientid'"
            }
          ],
          "rule": [
            {
              "name": "uemcarepatient",
              "source": [
                {
                  "context": "item",
                  "element": "answer",
                  "listMode": "first",
                  "variable": "a"
                },
                {
                  "context": "a",
                  "element": "value",
                  "variable": "val"
                }
              ],
              "target": [
                {
                  "context": "ressource",
                  "contextType": "variable",
                  "transform": "append",
                  "parameter": [
                    {
                      "valueString": "Patient/"
                    },
                    {
                      "valueId": "val"
                    }
                  ]
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "name": "emcareencounter",
      "typeMode": "none",
      "input": [
        {
          "name": "src",
          "type": "questionnaireResponse",
          "mode": "source"
        },
        {
          "name": "tgt",
          "type": "Encounter",
          "mode": "target"
        }
      ],
      "rule": [
        {
          "name": "emcareade07",
          "source": [
            {
              "context": "src",
              "element": "item",
              "variable": "item",
              "condition": "linkId = 'EmCare.A.DE07'"
            }
          ],
          "target": [
            {
              "contextType": "variable",
              "transform": "copy",
              "parameter": [
                {
                  "valueId": "tgt"
                }
              ]
            }
          ],
          "rule": [
            {
              "name": "EmCare.A.DE07-1",
              "source": [
                {
                  "context": "item",
                  "element": "answer",
                  "listMode": "first",
                  "variable": "a"
                },
                {
                  "context": "a",
                  "element": "value",
                  "variable": "val"
                }
              ],
              "target": [
                {
                  "context": "tgt",
                  "contextType": "variable",
                  "element": "period",
                  "variable": "period"
                },
                {
                  "context": "period",
                  "contextType": "variable",
                  "element": "start",
                  "transform": "copy",
                  "parameter": [
                    {
                      "valueId": "val"
                    }
                  ]
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "name": "getIdemcareencounter",
      "typeMode": "none",
      "input": [
        {
          "name": "src",
          "mode": "source"
        },
        {
          "name": "tgt",
          "mode": "target"
        }
      ],
      "rule": [
        {
          "name": "iemcareencounter",
          "source": [
            {
              "context": "src",
              "element": "item",
              "listMode": "first",
              "variable": "item",
              "condition": "linkId = 'EmCare Encounterid'"
            }
          ],
          "rule": [
            {
              "name": "idemcareencounter",
              "source": [
                {
                  "context": "item",
                  "element": "answer",
                  "listMode": "first",
                  "variable": "a"
                },
                {
                  "context": "a",
                  "element": "value",
                  "variable": "val"
                }
              ],
              "target": [
                {
                  "context": "ressource",
                  "contextType": "variable",
                  "transform": "copy",
                  "parameter": [
                    {
                      "valueId": "val"
                    }
                  ]
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "name": "getFullUrlemcareencounter",
      "typeMode": "none",
      "input": [
        {
          "name": "src",
          "mode": "source"
        },
        {
          "name": "tgt",
          "mode": "target"
        }
      ],
      "rule": [
        {
          "name": "fuemcareencounter",
          "source": [
            {
              "context": "src",
              "element": "item",
              "listMode": "first",
              "variable": "item",
              "condition": "linkId = 'EmCare Encounterid'"
            }
          ],
          "rule": [
            {
              "name": "fuemcareencounter",
              "source": [
                {
                  "context": "item",
                  "element": "answer",
                  "listMode": "first",
                  "variable": "a"
                },
                {
                  "context": "a",
                  "element": "value",
                  "variable": "val"
                }
              ],
              "target": [
                {
                  "context": "ressource",
                  "contextType": "variable",
                  "transform": "append",
                  "parameter": [
                    {
                      "valueString": "urn:uuid:"
                    },
                    {
                      "valueId": "val"
                    }
                  ]
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "name": "getUrlemcareencounter",
      "typeMode": "none",
      "input": [
        {
          "name": "src",
          "mode": "source"
        },
        {
          "name": "tgt",
          "mode": "target"
        }
      ],
      "rule": [
        {
          "name": "uemcareencounter",
          "source": [
            {
              "context": "src",
              "element": "item",
              "listMode": "first",
              "variable": "item",
              "condition": "linkId = 'EmCare Encounterid'"
            }
          ],
          "rule": [
            {
              "name": "uemcareencounter",
              "source": [
                {
                  "context": "item",
                  "element": "answer",
                  "listMode": "first",
                  "variable": "a"
                },
                {
                  "context": "a",
                  "element": "value",
                  "variable": "val"
                }
              ],
              "target": [
                {
                  "context": "ressource",
                  "contextType": "variable",
                  "transform": "append",
                  "parameter": [
                    {
                      "valueString": "Encounter/"
                    },
                    {
                      "valueId": "val"
                    }
                  ]
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "name": "emcarerelatedpersoncaregiver",
      "typeMode": "none",
      "input": [
        {
          "name": "src",
          "type": "questionnaireResponse",
          "mode": "source"
        },
        {
          "name": "tgt",
          "type": "RelatedPerson",
          "mode": "target"
        }
      ],
      "rule": [
        {
          "name": "emcareade21",
          "source": [
            {
              "context": "src",
              "element": "item",
              "listMode": "first",
              "variable": "item",
              "condition": "(linkId = 'EmCare.A.DE21') or (linkId = 'EmCare.A.DE22') or (linkId = 'EmCare.A.DE23')"
            }
          ],
          "target": [
            {
              "contextType": "variable",
              "variable": "target",
              "transform": "copy",
              "parameter": [
                {
                  "valueId": "tgt"
                }
              ]
            },
            {
              "context": "target",
              "contextType": "variable",
              "element": "name",
              "variable": "name"
            }
          ],
          "dependent": [
            {
              "name": "SetOfficalGivenNameemcareade21",
              "variable": [
                "src",
                "name"
              ]
            }
          ]
        },
        {
          "name": "emcareade35",
          "source": [
            {
              "context": "src",
              "element": "item",
              "variable": "item",
              "condition": "linkId = 'EmCare.A.DE35'"
            }
          ],
          "target": [
            {
              "contextType": "variable",
              "transform": "copy",
              "parameter": [
                {
                  "valueId": "tgt"
                }
              ]
            }
          ],
          "rule": [
            {
              "name": "EmCare.A.DE35-1",
              "source": [
                {
                  "context": "item",
                  "element": "answer",
                  "listMode": "first",
                  "variable": "a"
                },
                {
                  "context": "a",
                  "element": "value",
                  "variable": "val"
                }
              ],
              "target": [
                {
                  "context": "tgt",
                  "contextType": "variable",
                  "element": "telecom",
                  "variable": "tel"
                },
                {
                  "context": "tel",
                  "contextType": "variable",
                  "element": "system",
                  "transform": "copy",
                  "parameter": [
                    {
                      "valueString": "phone"
                    }
                  ]
                },
                {
                  "context": "tel",
                  "contextType": "variable",
                  "element": "use",
                  "transform": "copy",
                  "parameter": [
                    {
                      "valueString": "mobile"
                    }
                  ]
                },
                {
                  "context": "tel",
                  "contextType": "variable",
                  "element": "value",
                  "transform": "copy",
                  "parameter": [
                    {
                      "valueId": "val"
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "name": "emcareade36",
          "source": [
            {
              "context": "src",
              "element": "item",
              "variable": "item",
              "condition": "linkId = 'EmCare.A.DE36'"
            }
          ],
          "target": [
            {
              "contextType": "variable",
              "transform": "copy",
              "parameter": [
                {
                  "valueId": "tgt"
                }
              ]
            }
          ],
          "rule": [
            {
              "name": "EmCare.A.DE36-1",
              "source": [
                {
                  "context": "item",
                  "element": "answer",
                  "listMode": "first",
                  "variable": "a"
                },
                {
                  "context": "a",
                  "element": "value",
                  "variable": "val"
                }
              ],
              "target": [
                {
                  "context": "tgt",
                  "contextType": "variable",
                  "element": "telecom",
                  "variable": "tel"
                },
                {
                  "context": "tel",
                  "contextType": "variable",
                  "element": "system",
                  "transform": "copy",
                  "parameter": [
                    {
                      "valueString": "phone"
                    }
                  ]
                },
                {
                  "context": "tel",
                  "contextType": "variable",
                  "element": "use",
                  "transform": "copy",
                  "parameter": [
                    {
                      "valueString": "home"
                    }
                  ]
                },
                {
                  "context": "tel",
                  "contextType": "variable",
                  "element": "value",
                  "transform": "copy",
                  "parameter": [
                    {
                      "valueId": "val"
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "name": "emcareade37",
          "source": [
            {
              "context": "src",
              "element": "item",
              "variable": "item",
              "condition": "linkId = 'EmCare.A.DE37'"
            }
          ],
          "target": [
            {
              "contextType": "variable",
              "transform": "copy",
              "parameter": [
                {
                  "valueId": "tgt"
                }
              ]
            }
          ],
          "rule": [
            {
              "name": "EmCare.A.DE37-1",
              "source": [
                {
                  "context": "item",
                  "element": "answer",
                  "listMode": "first",
                  "variable": "a"
                },
                {
                  "context": "a",
                  "element": "value",
                  "variable": "val"
                }
              ],
              "target": [
                {
                  "context": "tgt",
                  "contextType": "variable",
                  "element": "telecom",
                  "variable": "tel"
                },
                {
                  "context": "tel",
                  "contextType": "variable",
                  "element": "system",
                  "transform": "copy",
                  "parameter": [
                    {
                      "valueString": "phone"
                    }
                  ]
                },
                {
                  "context": "tel",
                  "contextType": "variable",
                  "element": "use",
                  "transform": "copy",
                  "parameter": [
                    {
                      "valueString": "work"
                    }
                  ]
                },
                {
                  "context": "tel",
                  "contextType": "variable",
                  "element": "value",
                  "transform": "copy",
                  "parameter": [
                    {
                      "valueId": "val"
                    }
                  ]
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "name": "SetOfficalGivenNameemcareade21",
      "typeMode": "none",
      "input": [
        {
          "name": "src",
          "mode": "source"
        },
        {
          "name": "tgt",
          "mode": "target"
        }
      ],
      "rule": [
        {
          "name": "sgnemcareade21",
          "source": [
            {
              "context": "src"
            }
          ],
          "target": [
            {
              "context": "tgt",
              "contextType": "variable",
              "element": "use",
              "transform": "copy",
              "parameter": [
                {
                  "valueString": "official"
                }
              ]
            }
          ],
          "rule": [
            {
              "name": "femcareade21",
              "source": [
                {
                  "context": "src",
                  "element": "item",
                  "variable": "item",
                  "condition": "linkId = 'EmCare.A.DE21'"
                }
              ],
              "target": [
                {
                  "contextType": "variable",
                  "transform": "copy",
                  "parameter": [
                    {
                      "valueId": "tgt"
                    }
                  ]
                }
              ],
              "rule": [
                {
                  "name": "f",
                  "source": [
                    {
                      "context": "item",
                      "element": "answer",
                      "variable": "a"
                    }
                  ],
                  "target": [
                    {
                      "context": "tgt",
                      "contextType": "variable",
                      "element": "given",
                      "transform": "copy",
                      "parameter": [
                        {
                          "valueId": "a"
                        }
                      ]
                    }
                  ]
                }
              ]
            },
            {
              "name": "memcareade21",
              "source": [
                {
                  "context": "src",
                  "element": "item",
                  "variable": "item",
                  "condition": "linkId = 'EmCare.A.DE22'"
                }
              ],
              "target": [
                {
                  "contextType": "variable",
                  "transform": "copy",
                  "parameter": [
                    {
                      "valueId": "tgt"
                    }
                  ]
                }
              ],
              "rule": [
                {
                  "name": "f",
                  "source": [
                    {
                      "context": "item",
                      "element": "answer",
                      "variable": "a"
                    }
                  ],
                  "target": [
                    {
                      "context": "tgt",
                      "contextType": "variable",
                      "element": "given",
                      "transform": "copy",
                      "parameter": [
                        {
                          "valueId": "a"
                        }
                      ]
                    }
                  ]
                }
              ]
            },
            {
              "name": "lemcareade21",
              "source": [
                {
                  "context": "src",
                  "element": "item",
                  "variable": "item",
                  "condition": "linkId = 'EmCare.A.DE23'"
                }
              ],
              "target": [
                {
                  "contextType": "variable",
                  "transform": "copy",
                  "parameter": [
                    {
                      "valueId": "tgt"
                    }
                  ]
                }
              ],
              "rule": [
                {
                  "name": "f",
                  "source": [
                    {
                      "context": "item",
                      "element": "answer",
                      "variable": "a"
                    }
                  ],
                  "target": [
                    {
                      "context": "tgt",
                      "contextType": "variable",
                      "element": "family",
                      "transform": "copy",
                      "parameter": [
                        {
                          "valueId": "a"
                        }
                      ]
                    }
                  ]
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "name": "getIdemcarerelatedpersoncaregiver",
      "typeMode": "none",
      "input": [
        {
          "name": "src",
          "mode": "source"
        },
        {
          "name": "tgt",
          "mode": "target"
        }
      ],
      "rule": [
        {
          "name": "iemcarerelatedpersoncaregiver",
          "source": [
            {
              "context": "src",
              "element": "item",
              "listMode": "first",
              "variable": "item",
              "condition": "linkId = 'EmCare RelatedPerson Caregiverid'"
            }
          ],
          "rule": [
            {
              "name": "idemcarerelatedpersoncaregiver",
              "source": [
                {
                  "context": "item",
                  "element": "answer",
                  "listMode": "first",
                  "variable": "a"
                },
                {
                  "context": "a",
                  "element": "value",
                  "variable": "val"
                }
              ],
              "target": [
                {
                  "context": "ressource",
                  "contextType": "variable",
                  "transform": "copy",
                  "parameter": [
                    {
                      "valueId": "val"
                    }
                  ]
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "name": "getFullUrlemcarerelatedpersoncaregiver",
      "typeMode": "none",
      "input": [
        {
          "name": "src",
          "mode": "source"
        },
        {
          "name": "tgt",
          "mode": "target"
        }
      ],
      "rule": [
        {
          "name": "fuemcarerelatedpersoncaregiver",
          "source": [
            {
              "context": "src",
              "element": "item",
              "listMode": "first",
              "variable": "item",
              "condition": "linkId = 'EmCare RelatedPerson Caregiverid'"
            }
          ],
          "rule": [
            {
              "name": "fuemcarerelatedpersoncaregiver",
              "source": [
                {
                  "context": "item",
                  "element": "answer",
                  "listMode": "first",
                  "variable": "a"
                },
                {
                  "context": "a",
                  "element": "value",
                  "variable": "val"
                }
              ],
              "target": [
                {
                  "context": "ressource",
                  "contextType": "variable",
                  "transform": "append",
                  "parameter": [
                    {
                      "valueString": "urn:uuid:"
                    },
                    {
                      "valueId": "val"
                    }
                  ]
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "name": "getUrlemcarerelatedpersoncaregiver",
      "typeMode": "none",
      "input": [
        {
          "name": "src",
          "mode": "source"
        },
        {
          "name": "tgt",
          "mode": "target"
        }
      ],
      "rule": [
        {
          "name": "uemcarerelatedpersoncaregiver",
          "source": [
            {
              "context": "src",
              "element": "item",
              "listMode": "first",
              "variable": "item",
              "condition": "linkId = 'EmCare RelatedPerson Caregiverid'"
            }
          ],
          "rule": [
            {
              "name": "uemcarerelatedpersoncaregiver",
              "source": [
                {
                  "context": "item",
                  "element": "answer",
                  "listMode": "first",
                  "variable": "a"
                },
                {
                  "context": "a",
                  "element": "value",
                  "variable": "val"
                }
              ],
              "target": [
                {
                  "context": "ressource",
                  "contextType": "variable",
                  "transform": "append",
                  "parameter": [
                    {
                      "valueString": "RelatedPerson/"
                    },
                    {
                      "valueId": "val"
                    }
                  ]
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "name": "emcarecommunicationrequest",
      "typeMode": "none",
      "input": [
        {
          "name": "src",
          "type": "questionnaireResponse",
          "mode": "source"
        },
        {
          "name": "tgt",
          "type": "CommunicationRequest",
          "mode": "target"
        }
      ],
      "rule": [
        {
          "name": "emcareade38",
          "source": [
            {
              "context": "src",
              "element": "item",
              "variable": "item",
              "condition": "linkId = 'EmCare.A.DE38'"
            }
          ],
          "target": [
            {
              "contextType": "variable",
              "transform": "copy",
              "parameter": [
                {
                  "valueId": "tgt"
                }
              ]
            }
          ],
          "rule": [
            {
              "name": "EmCare.A.DE38-1",
              "source": [
                {
                  "context": "item",
                  "element": "answer",
                  "listMode": "first",
                  "variable": "a"
                },
                {
                  "context": "a",
                  "element": "value",
                  "variable": "val"
                }
              ],
              "target": [
                {
                  "context": "tgt",
                  "contextType": "variable",
                  "element": "medium",
                  "transform": "copy",
                  "parameter": [
                    {
                      "valueString": "https://fhir.dk.swisstph-mis.ch/matchbox/fhir/CodeSystem/emcare-custom-codes"
                    }
                  ]
                },
                {
                  "context": "tgt",
                  "contextType": "variable",
                  "element": "recipient",
                  "variable": "recipient"
                }
              ],
              "rule": [
                {
                  "name": "r1",
                  "source": [
                    {
                      "context": "src",
                      "element": "item",
                      "variable": "item",
                      "condition": "linkId = 'emcarecommunicationrequestid'"
                    },
                    {
                      "context": "item",
                      "element": "answer",
                      "listMode": "first",
                      "variable": "a"
                    },
                    {
                      "context": "a",
                      "element": "value",
                      "variable": "val"
                    }
                  ],
                  "target": [
                    {
                      "context": "recipient",
                      "contextType": "variable",
                      "transform": "copy",
                      "parameter": [
                        {
                          "valueId": "val"
                        }
                      ]
                    }
                  ]
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "name": "getIdemcarecommunicationrequest",
      "typeMode": "none",
      "input": [
        {
          "name": "src",
          "mode": "source"
        },
        {
          "name": "tgt",
          "mode": "target"
        }
      ],
      "rule": [
        {
          "name": "iemcarecommunicationrequest",
          "source": [
            {
              "context": "src",
              "element": "item",
              "listMode": "first",
              "variable": "item",
              "condition": "linkId = 'EmCare CommunicationRequestid'"
            }
          ],
          "rule": [
            {
              "name": "idemcarecommunicationrequest",
              "source": [
                {
                  "context": "item",
                  "element": "answer",
                  "listMode": "first",
                  "variable": "a"
                },
                {
                  "context": "a",
                  "element": "value",
                  "variable": "val"
                }
              ],
              "target": [
                {
                  "context": "ressource",
                  "contextType": "variable",
                  "transform": "copy",
                  "parameter": [
                    {
                      "valueId": "val"
                    }
                  ]
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "name": "getFullUrlemcarecommunicationrequest",
      "typeMode": "none",
      "input": [
        {
          "name": "src",
          "mode": "source"
        },
        {
          "name": "tgt",
          "mode": "target"
        }
      ],
      "rule": [
        {
          "name": "fuemcarecommunicationrequest",
          "source": [
            {
              "context": "src",
              "element": "item",
              "listMode": "first",
              "variable": "item",
              "condition": "linkId = 'EmCare CommunicationRequestid'"
            }
          ],
          "rule": [
            {
              "name": "fuemcarecommunicationrequest",
              "source": [
                {
                  "context": "item",
                  "element": "answer",
                  "listMode": "first",
                  "variable": "a"
                },
                {
                  "context": "a",
                  "element": "value",
                  "variable": "val"
                }
              ],
              "target": [
                {
                  "context": "ressource",
                  "contextType": "variable",
                  "transform": "append",
                  "parameter": [
                    {
                      "valueString": "urn:uuid:"
                    },
                    {
                      "valueId": "val"
                    }
                  ]
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "name": "getUrlemcarecommunicationrequest",
      "typeMode": "none",
      "input": [
        {
          "name": "src",
          "mode": "source"
        },
        {
          "name": "tgt",
          "mode": "target"
        }
      ],
      "rule": [
        {
          "name": "uemcarecommunicationrequest",
          "source": [
            {
              "context": "src",
              "element": "item",
              "listMode": "first",
              "variable": "item",
              "condition": "linkId = 'EmCare CommunicationRequestid'"
            }
          ],
          "rule": [
            {
              "name": "uemcarecommunicationrequest",
              "source": [
                {
                  "context": "item",
                  "element": "answer",
                  "listMode": "first",
                  "variable": "a"
                },
                {
                  "context": "a",
                  "element": "value",
                  "variable": "val"
                }
              ],
              "target": [
                {
                  "context": "ressource",
                  "contextType": "variable",
                  "transform": "append",
                  "parameter": [
                    {
                      "valueString": "CommunicationRequest/"
                    },
                    {
                      "valueId": "val"
                    }
                  ]
                }
              ]
            }
          ]
        }
      ]
    }
  ]
}